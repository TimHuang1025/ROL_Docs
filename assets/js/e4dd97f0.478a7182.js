"use strict";(self.webpackChunkgame_docs=self.webpackChunkgame_docs||[]).push([[242],{220:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>i,contentTitle:()=>s,default:()=>o,frontMatter:()=>t,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"\u5361\u724c/card-upgrade-system","title":"\u5361\u724c\u5347\u7ea7\u7cfb\u7edf","description":"\u7cfb\u7edf\u6982\u8ff0","source":"@site/docs/\u5361\u724c/card-upgrade-system.md","sourceDirName":"\u5361\u724c","slug":"/\u5361\u724c/card-upgrade-system","permalink":"/ROL_Docs/docs/\u5361\u724c/card-upgrade-system","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"card-upgrade-system","title":"\u5361\u724c\u5347\u7ea7\u7cfb\u7edf","sidebar_label":"\u5347\u7ea7\u7cfb\u7edf","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"\u6570\u636e\u6a21\u578b","permalink":"/ROL_Docs/docs/\u5361\u724c/card-data-model"},"next":{"title":"\u5c01\u8d4f\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/card-gift-system"}}');var d=n(4848),a=n(8453);const t={id:"card-upgrade-system",title:"\u5361\u724c\u5347\u7ea7\u7cfb\u7edf",sidebar_label:"\u5347\u7ea7\u7cfb\u7edf",sidebar_position:3},s="\u5361\u724c\u5347\u7ea7\u7cfb\u7edf",i={},c=[{value:"\u7cfb\u7edf\u6982\u8ff0",id:"\u7cfb\u7edf\u6982\u8ff0",level:2},{value:"\u7b49\u7ea7\u8ba1\u7b97\u5668",id:"\u7b49\u7ea7\u8ba1\u7b97\u5668",level:2},{value:"LevelStatCalculator",id:"levelstatcalculator",level:3},{value:"\u5c5e\u6027\u6210\u957f\u516c\u5f0f",id:"\u5c5e\u6027\u6210\u957f\u516c\u5f0f",level:2},{value:"\u57fa\u7840\u5c5e\u6027\u66f2\u7ebf",id:"\u57fa\u7840\u5c5e\u6027\u66f2\u7ebf",level:3},{value:"\u7edf\u5fa1\u5c5e\u6027\u66f2\u7ebf",id:"\u7edf\u5fa1\u5c5e\u6027\u66f2\u7ebf",level:3},{value:"\u6700\u7ec8\u5c5e\u6027\u8ba1\u7b97",id:"\u6700\u7ec8\u5c5e\u6027\u8ba1\u7b97",level:3},{value:"\u5347\u7ea7\u6d88\u8017",id:"\u5347\u7ea7\u6d88\u8017",level:2},{value:"\u529f\u52cb\u6d88\u8017\u516c\u5f0f",id:"\u529f\u52cb\u6d88\u8017\u516c\u5f0f",level:3},{value:"\u6d88\u8017\u8868\u683c",id:"\u6d88\u8017\u8868\u683c",level:3},{value:"UI\u5b9e\u73b0",id:"ui\u5b9e\u73b0",level:2},{value:"UpgradePanel\u7ec4\u4ef6",id:"upgradepanel\u7ec4\u4ef6",level:3},{value:"\u5347\u7ea7\u6d41\u7a0b",id:"\u5347\u7ea7\u6d41\u7a0b",level:3},{value:"\u7279\u6b8a\u89c4\u5219",id:"\u7279\u6b8a\u89c4\u5219",level:2},{value:"\u5e7b\u5f71\u5361\u9650\u5236",id:"\u5e7b\u5f71\u5361\u9650\u5236",level:3},{value:"\u4e3b\u516c\u5361\u7279\u6b8a\u5904\u7406",id:"\u4e3b\u516c\u5361\u7279\u6b8a\u5904\u7406",level:3},{value:"\u5c5e\u6027\u6210\u957f\u793a\u4f8b",id:"\u5c5e\u6027\u6210\u957f\u793a\u4f8b",level:2},{value:"\u7f51\u7edc\u534f\u8bae",id:"\u7f51\u7edc\u534f\u8bae",level:2},{value:"\u5347\u7ea7\u8bf7\u6c42",id:"\u5347\u7ea7\u8bf7\u6c42",level:3},{value:"\u5347\u7ea7\u54cd\u5e94",id:"\u5347\u7ea7\u54cd\u5e94",level:3},{value:"\u9519\u8bef\u54cd\u5e94",id:"\u9519\u8bef\u54cd\u5e94",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"\u5c5e\u6027\u7f13\u5b58",id:"\u5c5e\u6027\u7f13\u5b58",level:3},{value:"UI\u4f18\u5316",id:"ui\u4f18\u5316",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function h(r){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...r.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.header,{children:(0,d.jsx)(e.h1,{id:"\u5361\u724c\u5347\u7ea7\u7cfb\u7edf",children:"\u5361\u724c\u5347\u7ea7\u7cfb\u7edf"})}),"\n",(0,d.jsx)(e.h2,{id:"\u7cfb\u7edf\u6982\u8ff0",children:"\u7cfb\u7edf\u6982\u8ff0"}),"\n",(0,d.jsx)(e.p,{children:"\u5347\u7ea7\u7cfb\u7edf\u5141\u8bb8\u73a9\u5bb6\u6d88\u8017\u529f\u52cb\uff08Merit\uff09\u63d0\u5347\u5361\u724c\u7b49\u7ea7\uff0c\u589e\u5f3a\u56db\u7ef4\u5c5e\u6027\u3002\u7cfb\u7edf\u652f\u63011-999\u7ea7\uff0c200\u7ea7\u540e\u5c5e\u6027\u589e\u957f\u9012\u51cf\u4f46\u4ecd\u53ef\u7ee7\u7eed\u5347\u7ea7\u3002"}),"\n",(0,d.jsx)(e.h2,{id:"\u7b49\u7ea7\u8ba1\u7b97\u5668",children:"\u7b49\u7ea7\u8ba1\u7b97\u5668"}),"\n",(0,d.jsx)(e.h3,{id:"levelstatcalculator",children:"LevelStatCalculator"}),"\n",(0,d.jsx)(e.p,{children:"\u6838\u5fc3\u8ba1\u7b97\u7c7b\uff0c\u8d1f\u8d23\u6240\u6709\u7b49\u7ea7\u76f8\u5173\u7684\u6570\u503c\u8ba1\u7b97\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"public static class LevelStatCalculator\r\n{\r\n    // \u8f6f\u4e0a\u9650\uff08\u8bbe\u8ba1\u53c2\u8003\u503c\uff09\r\n    public const int MaxLevel = 200;\r\n    \r\n    // \u6838\u5fc3\u65b9\u6cd5\r\n    public static Stats4 CalculateStats(CardInfoStatic info, PlayerCard dyn);\r\n    public static Stats4 CalculateDeltaNextLevel(CardInfoStatic info, PlayerCard dyn);\r\n    public static (int exp, int extraMat) GetUpgradeCost(int lv);\r\n    public static int CalculateCommand(CardInfoStatic info, PlayerCard dyn);\r\n    public static int CalculateBattlePower(CardInfoStatic info, PlayerCard dyn);\r\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u5c5e\u6027\u6210\u957f\u516c\u5f0f",children:"\u5c5e\u6027\u6210\u957f\u516c\u5f0f"}),"\n",(0,d.jsx)(e.h3,{id:"\u57fa\u7840\u5c5e\u6027\u66f2\u7ebf",children:"\u57fa\u7840\u5c5e\u6027\u66f2\u7ebf"}),"\n",(0,d.jsx)(e.p,{children:"\u653b\u51fb\u3001\u9632\u5fa1\u3001\u667a\u529b\u4f7f\u7528\u76f8\u540c\u7684\u57fa\u7840\u66f2\u7ebf\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"static double BaseStatCurve(int lv)\r\n{\r\n    if (lv <= 100)\r\n    {\r\n        // 1-100\u7ea7\uff1a\u4e09\u6b21\u65b9\u66f2\u7ebf\r\n        return Math.Ceiling(0.2 * Math.Pow(lv, 3));\r\n    }\r\n    else\r\n    {\r\n        // 100\u7ea7\u540e\uff1a\u6307\u6570\u8870\u51cf\u66f2\u7ebf\r\n        return 200_000 + Math.Ceiling(\r\n            650 * lv + 81_250 - 7_984_980 * Math.Exp(-0.04 * lv)\r\n        );\r\n    }\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u7edf\u5fa1\u5c5e\u6027\u66f2\u7ebf",children:"\u7edf\u5fa1\u5c5e\u6027\u66f2\u7ebf"}),"\n",(0,d.jsx)(e.p,{children:"\u5e26\u5175\u91cf\u4f7f\u7528\u72ec\u7acb\u7684\u6210\u957f\u66f2\u7ebf\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"static double CommandCurve(int lv)\r\n{\r\n    if (lv <= 100)\r\n    {\r\n        return Math.Ceiling(\r\n            0.09333 * Math.Pow(lv, 3) + \r\n            0.14 * Math.Pow(lv, 2) + \r\n            0.04667 * lv\r\n        );\r\n    }\r\n    else\r\n    {\r\n        return Math.Ceiling(\r\n            130 * lv + 150_450 - 68_750 * Math.Exp(-0.04 * lv) + 4\r\n        );\r\n    }\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u6700\u7ec8\u5c5e\u6027\u8ba1\u7b97",children:"\u6700\u7ec8\u5c5e\u6027\u8ba1\u7b97"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"static Stats4 CalcStatsCore(int lv, Tier tier, float[] mul, int star)\r\n{\r\n    // \u57fa\u7840\u503c\r\n    var baseVal = BaseStatCurve(lv);\r\n    var cmdBaseVal = CommandCurve(lv);\r\n    \r\n    // \u54c1\u8d28\u500d\u7387\r\n    var tierMul = GetTierMul(tier);  // S=1.0, A=0.8, B=0.5\r\n    \r\n    // \u661f\u7ea7\u52a0\u6210\r\n    var starBonus = GetStarBonus(star);\r\n    \r\n    // \u8ba1\u7b97\u6700\u7ec8\u5c5e\u6027\r\n    int atk = starBonus + (baseVal * mul[0] * tierMul);\r\n    int def = starBonus + (baseVal * mul[1] * tierMul);\r\n    int iq  = starBonus + (baseVal * mul[2] * tierMul);\r\n    int cmd = cmdBaseVal * mul[3] * tierMul;  // \u7edf\u5fa1\u65e0\u661f\u7ea7\u52a0\u6210\r\n    \r\n    return new Stats4(atk, def, iq, cmd);\r\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u5347\u7ea7\u6d88\u8017",children:"\u5347\u7ea7\u6d88\u8017"}),"\n",(0,d.jsx)(e.h3,{id:"\u529f\u52cb\u6d88\u8017\u516c\u5f0f",children:"\u529f\u52cb\u6d88\u8017\u516c\u5f0f"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"public static (int exp, int extraMat) GetUpgradeCost(int lv)\r\n{\r\n    int exp;\r\n    \r\n    if (lv <= 99)\r\n    {\r\n        // 1-99\u7ea7\uff1a\u4e8c\u6b21\u65b9\u589e\u957f\r\n        exp = Mathf.CeilToInt(0.6f * lv * lv);\r\n    }\r\n    else\r\n    {\r\n        // 100\u7ea7\u540e\uff1a\u9636\u68af\u5f0f\u589e\u957f\r\n        exp = 60_000 + Mathf.CeilToInt((lv - 100) / 10f) * 5_000;\r\n    }\r\n    \r\n    // \u6bcf10\u7ea7\u9700\u8981\u989d\u5916\u6750\u6599\r\n    int extraMat = (lv % 10 == 0) ? lv * 2 : 0;\r\n    \r\n    return (exp, extraMat);\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u6d88\u8017\u8868\u683c",children:"\u6d88\u8017\u8868\u683c"}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u7b49\u7ea7\u8303\u56f4"}),(0,d.jsx)(e.th,{children:"\u529f\u52cb\u516c\u5f0f"}),(0,d.jsx)(e.th,{children:"\u793a\u4f8b"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"1-99"}),(0,d.jsx)(e.td,{children:"0.6 \xd7 lv\xb2"}),(0,d.jsx)(e.td,{children:"Lv50: 1500\u529f\u52cb"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"100-109"}),(0,d.jsx)(e.td,{children:"60000"}),(0,d.jsx)(e.td,{children:"Lv105: 60000\u529f\u52cb"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"110-119"}),(0,d.jsx)(e.td,{children:"65000"}),(0,d.jsx)(e.td,{children:"Lv115: 65000\u529f\u52cb"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"120-129"}),(0,d.jsx)(e.td,{children:"70000"}),(0,d.jsx)(e.td,{children:"Lv125: 70000\u529f\u52cb"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"200+"}),(0,d.jsx)(e.td,{children:"110000+"}),(0,d.jsx)(e.td,{children:"Lv300: 160000\u529f\u52cb"})]})]})]}),"\n",(0,d.jsx)(e.h2,{id:"ui\u5b9e\u73b0",children:"UI\u5b9e\u73b0"}),"\n",(0,d.jsx)(e.h3,{id:"upgradepanel\u7ec4\u4ef6",children:"UpgradePanel\u7ec4\u4ef6"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"public class UpgradePanelController : MonoBehaviour, IUIPanelController\r\n{\r\n    // UI\u5143\u7d20\r\n    Label curLevelLabel;      // \u5f53\u524d\u7b49\u7ea7\r\n    Label nextLevelLabel;     // \u4e0b\u4e00\u7b49\u7ea7\r\n    Label costLabel;          // \u6d88\u8017\u663e\u793a\r\n    Button upgradeBtn;        // \u5347\u7ea7\u6309\u94ae\r\n    Button upgradeMaxBtn;     // \u5347\u6ee1\u6309\u94ae\r\n    \r\n    // \u5c5e\u6027\u589e\u957f\u9884\u89c8\r\n    Label atkDeltaLabel;      // \u653b\u51fb\u589e\u957f\r\n    Label defDeltaLabel;      // \u9632\u5fa1\u589e\u957f\r\n    Label intDeltaLabel;      // \u667a\u529b\u589e\u957f\r\n    Label cmdDeltaLabel;      // \u7edf\u5fa1\u589e\u957f\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u5347\u7ea7\u6d41\u7a0b",children:"\u5347\u7ea7\u6d41\u7a0b"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'void OnUpgradeClicked()\r\n{\r\n    // 1. \u68c0\u67e5\u6761\u4ef6\r\n    var (expNeed, matNeed) = LevelStatCalculator.GetUpgradeCost(card.level);\r\n    \r\n    bool hasExp = PlayerResourceBank.I[ResourceType.Merit] >= expNeed;\r\n    bool hasMat = PlayerResourceBank.I[ResourceType.AdvanceScroll] >= matNeed;\r\n    \r\n    if (!hasExp || !hasMat)\r\n    {\r\n        PopupManager.Show("\u6750\u6599\u4e0d\u8db3");\r\n        return;\r\n    }\r\n    \r\n    // 2. \u53d1\u9001\u8bf7\u6c42\r\n    var request = new CardUpgradeRequest \r\n    { \r\n        card_id = card.id \r\n    };\r\n    \r\n    MessageHub.I.Request("card/upgrade_level", request, OnResponse, 10f);\r\n}\r\n\r\nvoid OnUpgradeResponse(MessageHub.Response resp)\r\n{\r\n    if (resp.code == 0)\r\n    {\r\n        // \u89e3\u6790\u54cd\u5e94\r\n        var data = JsonConvert.DeserializeObject<CardUpgradeResponse>(resp.dataJson);\r\n        \r\n        // \u66f4\u65b0\u5361\u724c\u7b49\u7ea7\r\n        if (data.new_card_level != null)\r\n        {\r\n            foreach (var kvp in data.new_card_level)\r\n            {\r\n                var card = PlayerCardBank.I.Get(kvp.Key);\r\n                if (card != null)\r\n                {\r\n                    card.level = kvp.Value;\r\n                    PlayerCardBankMgr.I.BroadcastCardUpdated(kvp.Key);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // \u5237\u65b0UI\r\n        RefreshUI();\r\n    }\r\n}\n'})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:'\r\n## \u5c5e\u6027\u9884\u89c8\r\n\r\n\u663e\u793a\u5347\u7ea7\u540e\u7684\u5c5e\u6027\u53d8\u5316\uff1a\r\n\r\n```csharp\r\nvoid RefreshStatPreview()\r\n{\r\n    // \u4f7f\u7528\u589e\u91cf\u65b9\u6cd5\u8ba1\u7b97\r\n    var delta = LevelStatCalculator.CalculateDeltaNextLevel(info, dyn);\r\n    \r\n    // \u66f4\u65b0UI\u6807\u7b7e\r\n    addAtkLbl.text = $"+{delta.Atk}";\r\n    addDefLbl.text = $"+{delta.Def}";\r\n    addIntLbl.text = $"+{delta.Int}";\r\n    addCmdLbl.text = $"+{delta.Cmd}";\r\n    \r\n    // \u989c\u8272\u6807\u8bb0\uff08\u589e\u91cf\u5927\u4e8e0\u663e\u793a\u7eff\u8272\uff09\r\n    Color okColor = new Color(0.25882354f, 0.41176471f, 0.04313726f, 1f);\r\n    Color grayColor = Color.gray;\r\n    \r\n    addAtkLbl.style.color = delta.Atk > 0 ? okColor : grayColor;\r\n    addDefLbl.style.color = delta.Def > 0 ? okColor : grayColor;\r\n    addIntLbl.style.color = delta.Int > 0 ? okColor : grayColor;\r\n    addCmdLbl.style.color = delta.Cmd > 0 ? okColor : grayColor;\r\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"\u7279\u6b8a\u89c4\u5219",children:"\u7279\u6b8a\u89c4\u5219"}),"\n",(0,d.jsx)(e.h3,{id:"\u5e7b\u5f71\u5361\u9650\u5236",children:"\u5e7b\u5f71\u5361\u9650\u5236"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'public void AddLevel(string id, int delta)\r\n{\r\n    var card = PlayerCardBank.I.Get(id);\r\n    \r\n    // \u5e7b\u5f71\u5361\u4e0d\u80fd\u5347\u7ea7\r\n    if (card.isPhantom)\r\n    {\r\n        Debug.LogWarning($"Cannot level up phantom card {id}");\r\n        return;\r\n    }\r\n    \r\n    // \u6b63\u5e38\u5347\u7ea7\u903b\u8f91\r\n    card.level = Mathf.Clamp(card.level + delta, 1, 999);\r\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u4e3b\u516c\u5361\u7279\u6b8a\u5904\u7406",children:"\u4e3b\u516c\u5361\u7279\u6b8a\u5904\u7406"}),"\n",(0,d.jsx)(e.p,{children:"\u4e3b\u516c\u5361\uff08LORD\uff09\u4f7f\u7528\u72ec\u7acb\u7684\u5347\u7ea7\u7cfb\u7edf\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'// \u4e3b\u516c\u5347\u7ea7\u6d88\u8017\u58f0\u671b\u800c\u975e\u529f\u52cb\r\n// \u901a\u8fc7 LordCardService \u5904\u7406\r\nvoid OnUpgradeLordCard()\r\n{\r\n    // \u68c0\u67e5\u58f0\u671b\r\n    long currentFame = PlayerResourceBank.I[ResourceType.Fame];\r\n    var lordStatic = PlayerLordBank.I?.StaticData;\r\n    var lordData = PlayerLordBank.I?.LordData;\r\n    \r\n    var nextLevel = lordStatic.GetLevel(lordData.currentLevel + 1);\r\n    if (currentFame < nextLevel.requiredFame)\r\n    {\r\n        PopupManager.Show("\u58f0\u671b\u4e0d\u8db3");\r\n        return;\r\n    }\r\n    \r\n    // \u8c03\u7528\u4e3b\u516c\u5347\u7ea7\u670d\u52a1\r\n    LordCardService.I.UpgradeLevel(\r\n        onSuccess: () => {\r\n            // \u5347\u7ea7\u6210\u529f\uff0c\u83b7\u5f97\u6280\u80fd\u70b9\r\n            RefreshUI();\r\n        },\r\n        onError: (msg) => {\r\n            PopupManager.Show("\u5347\u7ea7\u5931\u8d25", msg);\r\n        }\r\n    );\r\n}\r\n\r\n// \u4e3b\u516c\u5347\u7ea7\u8bf7\u6c42\u8def\u5f84\uff1a"card/lordcard_upgrade_level"\r\n// \u666e\u901a\u5361\u724c\u5347\u7ea7\u8def\u5f84\uff1a"card/upgrade_level"\n'})}),"\n",(0,d.jsx)(e.h2,{id:"\u5c5e\u6027\u6210\u957f\u793a\u4f8b",children:"\u5c5e\u6027\u6210\u957f\u793a\u4f8b"}),"\n",(0,d.jsx)(e.p,{children:"\u4ee5S\u7ea7\u5361\u724c\uff08\u500d\u7387[1.3, 1.3, 0.4, 1.0]\uff09\u4e3a\u4f8b\uff1a"}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u7b49\u7ea7"}),(0,d.jsx)(e.th,{children:"\u653b\u51fb\u529b"}),(0,d.jsx)(e.th,{children:"\u9632\u5fa1\u529b"}),(0,d.jsx)(e.th,{children:"\u667a\u529b"}),(0,d.jsx)(e.th,{children:"\u7edf\u5fa1"}),(0,d.jsx)(e.th,{children:"\u603b\u6218\u529b"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"1"}),(0,d.jsx)(e.td,{children:"0"}),(0,d.jsx)(e.td,{children:"0"}),(0,d.jsx)(e.td,{children:"0"}),(0,d.jsx)(e.td,{children:"0"}),(0,d.jsx)(e.td,{children:"0"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"10"}),(0,d.jsx)(e.td,{children:"260"}),(0,d.jsx)(e.td,{children:"260"}),(0,d.jsx)(e.td,{children:"80"}),(0,d.jsx)(e.td,{children:"10"}),(0,d.jsx)(e.td,{children:"610"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"50"}),(0,d.jsx)(e.td,{children:"32,500"}),(0,d.jsx)(e.td,{children:"32,500"}),(0,d.jsx)(e.td,{children:"10,000"}),(0,d.jsx)(e.td,{children:"610"}),(0,d.jsx)(e.td,{children:"75,610"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"100"}),(0,d.jsx)(e.td,{children:"260,000"}),(0,d.jsx)(e.td,{children:"260,000"}),(0,d.jsx)(e.td,{children:"80,000"}),(0,d.jsx)(e.td,{children:"9,330"}),(0,d.jsx)(e.td,{children:"609,330"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"200"}),(0,d.jsx)(e.td,{children:"423,280"}),(0,d.jsx)(e.td,{children:"423,280"}),(0,d.jsx)(e.td,{children:"130,240"}),(0,d.jsx)(e.td,{children:"42,780"}),(0,d.jsx)(e.td,{children:"1,019,580"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"500"}),(0,d.jsx)(e.td,{children:"797,780"}),(0,d.jsx)(e.td,{children:"797,780"}),(0,d.jsx)(e.td,{children:"245,540"}),(0,d.jsx)(e.td,{children:"81,780"}),(0,d.jsx)(e.td,{children:"1,922,880"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"999"}),(0,d.jsx)(e.td,{children:"1,446,860"}),(0,d.jsx)(e.td,{children:"1,446,860"}),(0,d.jsx)(e.td,{children:"445,340"}),(0,d.jsx)(e.td,{children:"148,680"}),(0,d.jsx)(e.td,{children:"3,487,740"})]})]})]}),"\n",(0,d.jsx)(e.h2,{id:"\u7f51\u7edc\u534f\u8bae",children:"\u7f51\u7edc\u534f\u8bae"}),"\n",(0,d.jsx)(e.h3,{id:"\u5347\u7ea7\u8bf7\u6c42",children:"\u5347\u7ea7\u8bf7\u6c42"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"// \u666e\u901a\u5361\u724c\u5347\u7ea7\r\n[Serializable]\r\npublic class CardUpgradeRequest\r\n{\r\n    public string card_id;         // \u5361\u724cID\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u5347\u7ea7\u54cd\u5e94",children:"\u5347\u7ea7\u54cd\u5e94"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class CardUpgradeResponse\r\n{\r\n    public Dictionary<string, int> new_card_level;    // \u65b0\u7b49\u7ea7\r\n    public Dictionary<string, int> current_balance;   // \u8d44\u6e90\u4f59\u989d\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u9519\u8bef\u54cd\u5e94",children:"\u9519\u8bef\u54cd\u5e94"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class CardUpgradeErrorData\r\n{\r\n    public int required_merit;           // \u9700\u8981\u7684\u529f\u52cb\r\n    public int current_merit;            // \u5f53\u524d\u529f\u52cb\r\n    public int required_advance_scroll;  // \u9700\u8981\u7684\u8fdb\u4fee\u518c\r\n    public int current_advance_scroll;   // \u5f53\u524d\u8fdb\u4fee\u518c\r\n    public int current_level;            // \u5f53\u524d\u7b49\u7ea7\r\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,d.jsx)(e.h3,{id:"\u5c5e\u6027\u7f13\u5b58",children:"\u5c5e\u6027\u7f13\u5b58"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'private static Dictionary<string, Stats4> _statsCache = new();\r\n\r\npublic static Stats4 GetCachedStats(string cardId, int level)\r\n{\r\n    var key = $"{cardId}_{level}";\r\n    \r\n    if (!_statsCache.ContainsKey(key))\r\n    {\r\n        var info = CardDatabaseStatic.Instance.GetCard(cardId);\r\n        var tempCard = new PlayerCard { id = cardId, level = level };\r\n        _statsCache[key] = CalculateStats(info, tempCard);\r\n    }\r\n    \r\n    return _statsCache[key];\r\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"ui\u4f18\u5316",children:"UI\u4f18\u5316"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"// \u907f\u514d\u9891\u7e41\u5237\u65b0\r\nprivate float _lastRefreshTime;\r\nprivate const float RefreshCooldown = 0.5f;\r\n\r\nvoid RefreshUI()\r\n{\r\n    if (Time.time - _lastRefreshTime < RefreshCooldown) return;\r\n    _lastRefreshTime = Time.time;\r\n    \r\n    // \u6267\u884cUI\u66f4\u65b0...\r\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u7b49\u7ea7\u9650\u5236"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4ee3\u7801\u9650\u5236\uff1a1-999\u7ea7\uff08\u4f7f\u7528",(0,d.jsx)(e.code,{children:"Mathf.Clamp(level, 1, 999)"}),"\uff09"]}),"\n",(0,d.jsx)(e.li,{children:"\u8bbe\u8ba1\u8f6f\u4e0a\u9650\uff1a200\u7ea7"}),"\n",(0,d.jsx)(e.li,{children:"200\u7ea7\u540e\u6536\u76ca\u9012\u51cf\u4f46\u53ef\u7ee7\u7eed\u5347\u7ea7"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6d88\u8017\u589e\u957f"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"100\u7ea7\u524d\uff1a\u4e8c\u6b21\u65b9\u589e\u957f\uff080.6 \xd7 lv\xb2\uff09"}),"\n",(0,d.jsx)(e.li,{children:"100\u7ea7\u540e\uff1a\u9636\u68af\u5f0f\u8df3\u8dc3\uff0860000\u57fa\u7840 + \u6bcf10\u7ea7\u589e\u52a05000\uff09"}),"\n",(0,d.jsx)(e.li,{children:"\u6bcf10\u7ea7\u9700\u8981\u989d\u5916\u7684\u8fdb\u4fee\u518c\uff08\u6570\u91cf = \u7b49\u7ea7 \xd7 2\uff09"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u5e7b\u5f71\u5361\u540c\u6b65"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u539f\u5361\u5347\u7ea7\u540e\u81ea\u52a8\u540c\u6b65\u6240\u6709\u5e7b\u5f71\u5361"}),"\n",(0,d.jsxs)(e.li,{children:["\u4f7f\u7528",(0,d.jsx)(e.code,{children:"SyncPhantomsForCard"}),"\u65b9\u6cd5"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u4e3b\u516c\u5361\u5dee\u5f02"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4f7f\u7528\u72ec\u7acb\u7684",(0,d.jsx)(e.code,{children:"LordCardService"})]}),"\n",(0,d.jsx)(e.li,{children:"\u6d88\u8017\u58f0\u671b\uff08Fame\uff09\u800c\u975e\u529f\u52cb\uff08Merit\uff09"}),"\n",(0,d.jsx)(e.li,{children:"\u5347\u7ea7\u83b7\u5f97\u6280\u80fd\u70b9"}),"\n",(0,d.jsxs)(e.li,{children:["\u8bf7\u6c42\u8def\u5f84\uff1a",(0,d.jsx)(e.code,{children:"card/lordcard_upgrade_level"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"UI\u66f4\u65b0"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u5347\u7ea7\u6210\u529f\u540e\u5237\u65b0\u6240\u6709\u76f8\u5173UI"}),"\n",(0,d.jsxs)(e.li,{children:["\u5e7f\u64ad",(0,d.jsx)(e.code,{children:"onCardUpdated"}),"\u4e8b\u4ef6"]}),"\n",(0,d.jsx)(e.li,{children:"\u8d44\u6e90\u7531MessageHub\u81ea\u52a8\u5904\u7406"}),"\n"]}),"\n"]}),"\n"]})]})}function o(r={}){const{wrapper:e}={...(0,a.R)(),...r.components};return e?(0,d.jsx)(e,{...r,children:(0,d.jsx)(h,{...r})}):h(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>t,x:()=>s});var l=n(6540);const d={},a=l.createContext(d);function t(r){const e=l.useContext(a);return l.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function s(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(d):r.components||d:t(r.components),l.createElement(a.Provider,{value:e},r.children)}}}]);