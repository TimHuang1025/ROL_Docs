"use strict";(self.webpackChunkgame_docs=self.webpackChunkgame_docs||[]).push([[652],{2805:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>s,default:()=>c,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"\u5361\u724c/card-equipment-system","title":"\u88c5\u5907\u7cfb\u7edf","description":"\u7cfb\u7edf\u6982\u8ff0","source":"@site/docs/\u5361\u724c/card-equipment-system.md","sourceDirName":"\u5361\u724c","slug":"/\u5361\u724c/card-equipment-system","permalink":"/ROL_Docs/docs/\u5361\u724c/card-equipment-system","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"card-equipment-system","title":"\u88c5\u5907\u7cfb\u7edf","sidebar_label":"\u88c5\u5907\u7cfb\u7edf","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"\u5e7b\u5f71\u5361\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/phantom-card-system"},"next":{"title":"\u6280\u80fd\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/card-skill-system"}}');var a=n(4848),l=n(8453);const t={id:"card-equipment-system",title:"\u88c5\u5907\u7cfb\u7edf",sidebar_label:"\u88c5\u5907\u7cfb\u7edf",sidebar_position:6},s="\u88c5\u5907\u7cfb\u7edf",d={},o=[{value:"\u7cfb\u7edf\u6982\u8ff0",id:"\u7cfb\u7edf\u6982\u8ff0",level:2},{value:"\u88c5\u5907\u69fd\u4f4d",id:"\u88c5\u5907\u69fd\u4f4d",level:2},{value:"\u69fd\u4f4d\u7c7b\u578b",id:"\u69fd\u4f4d\u7c7b\u578b",level:3},{value:"\u89e3\u9501\u673a\u5236",id:"\u89e3\u9501\u673a\u5236",level:3},{value:"\u88c5\u5907\u6570\u636e\u6a21\u578b",id:"\u88c5\u5907\u6570\u636e\u6a21\u578b",level:2},{value:"\u6b66\u5668/\u62a4\u7532 - PlayerGear",id:"\u6b66\u5668\u62a4\u7532---playergear",level:3},{value:"\u5750\u9a91 - PlayerHorse",id:"\u5750\u9a91---playerhorse",level:3},{value:"\u9759\u6001\u914d\u7f6e - GearStatic",id:"\u9759\u6001\u914d\u7f6e---gearstatic",level:3},{value:"\u9759\u6001\u914d\u7f6e - HorseStatic",id:"\u9759\u6001\u914d\u7f6e---horsestatic",level:3},{value:"\u88c5\u5907\u7ba1\u7406\u5668",id:"\u88c5\u5907\u7ba1\u7406\u5668",level:2},{value:"PlayerGearBank - \u88c5\u5907\u4ed3\u5e93",id:"playergearbank---\u88c5\u5907\u4ed3\u5e93",level:3},{value:"PlayerHorseBank - \u6218\u9a6c\u4ed3\u5e93",id:"playerhorsebank---\u6218\u9a6c\u4ed3\u5e93",level:3},{value:"\u88c5\u5907\u64cd\u4f5c",id:"\u88c5\u5907\u64cd\u4f5c",level:2},{value:"EquipmentManager - \u7edf\u4e00\u7ba1\u7406\u5668",id:"equipmentmanager---\u7edf\u4e00\u7ba1\u7406\u5668",level:3},{value:"UI\u5b9e\u73b0",id:"ui\u5b9e\u73b0",level:2},{value:"CardEquipmentManager - \u5361\u724c\u88c5\u5907\u7ba1\u7406UI",id:"cardequipmentmanager---\u5361\u724c\u88c5\u5907\u7ba1\u7406ui",level:3},{value:"\u88c5\u5907\u9009\u62e9\u9762\u677f",id:"\u88c5\u5907\u9009\u62e9\u9762\u677f",level:3},{value:"\u88c5\u5907\u5347\u7ea7",id:"\u88c5\u5907\u5347\u7ea7",level:2},{value:"\u5347\u7ea7\u6750\u6599\u9700\u6c42",id:"\u5347\u7ea7\u6750\u6599\u9700\u6c42",level:3},{value:"\u5347\u7ea7\u6d41\u7a0b",id:"\u5347\u7ea7\u6d41\u7a0b",level:3},{value:"\u7f51\u7edc\u540c\u6b65",id:"\u7f51\u7edc\u540c\u6b65",level:2},{value:"\u88c5\u5907/\u5378\u8f7d\u8bf7\u6c42",id:"\u88c5\u5907\u5378\u8f7d\u8bf7\u6c42",level:3},{value:"\u88c5\u5907/\u5378\u8f7d\u54cd\u5e94",id:"\u88c5\u5907\u5378\u8f7d\u54cd\u5e94",level:3},{value:"\u5347\u7ea7\u8bf7\u6c42",id:"\u5347\u7ea7\u8bf7\u6c42",level:3},{value:"\u5347\u7ea7\u54cd\u5e94",id:"\u5347\u7ea7\u54cd\u5e94",level:3},{value:"\u6570\u636e\u540c\u6b65\u670d\u52a1",id:"\u6570\u636e\u540c\u6b65\u670d\u52a1",level:2},{value:"GearService - \u88c5\u5907\u6570\u636e\u670d\u52a1",id:"gearservice---\u88c5\u5907\u6570\u636e\u670d\u52a1",level:3},{value:"CardService\u4e2d\u7684\u88c5\u5907\u5904\u7406",id:"cardservice\u4e2d\u7684\u88c5\u5907\u5904\u7406",level:3},{value:"\u7279\u6b8a\u89c4\u5219",id:"\u7279\u6b8a\u89c4\u5219",level:2},{value:"1. \u4e3b\u516c\u5361\u88c5\u5907",id:"1-\u4e3b\u516c\u5361\u88c5\u5907",level:3},{value:"2. \u5e7b\u5f71\u5361\u9650\u5236",id:"2-\u5e7b\u5f71\u5361\u9650\u5236",level:3},{value:"3. \u88c5\u5907\u552f\u4e00\u6027",id:"3-\u88c5\u5907\u552f\u4e00\u6027",level:3},{value:"4. UUID\u7ba1\u7406",id:"4-uuid\u7ba1\u7406",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function u(r){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...r.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"\u88c5\u5907\u7cfb\u7edf",children:"\u88c5\u5907\u7cfb\u7edf"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7cfb\u7edf\u6982\u8ff0",children:"\u7cfb\u7edf\u6982\u8ff0"}),"\n",(0,a.jsx)(e.p,{children:"\u88c5\u5907\u7cfb\u7edf\u5141\u8bb8\u5361\u724c\u7a7f\u6234\u6b66\u5668\u3001\u62a4\u7532\u548c\u5750\u9a91\u4e09\u79cd\u88c5\u5907\uff0c\u63d0\u5347\u6218\u6597\u5c5e\u6027\u3002\u88c5\u5907\u69fd\u4f4d\u901a\u8fc7\u5c01\u8d4f\u7b49\u7ea7\u89e3\u9501\uff0c\u6bcf\u4e2a\u88c5\u5907\u90fd\u53ef\u4ee5\u72ec\u7acb\u5347\u7ea7\u5f3a\u5316\u3002\u7cfb\u7edf\u4f7f\u7528UUID\u7ba1\u7406\u88c5\u5907\u5b9e\u4f8b\uff0c\u652f\u6301\u88c5\u5907\u5728\u4e0d\u540c\u5361\u724c\u95f4\u5207\u6362\u3002"}),"\n",(0,a.jsx)(e.h2,{id:"\u88c5\u5907\u69fd\u4f4d",children:"\u88c5\u5907\u69fd\u4f4d"}),"\n",(0,a.jsx)(e.h3,{id:"\u69fd\u4f4d\u7c7b\u578b",children:"\u69fd\u4f4d\u7c7b\u578b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"public enum EquipSlotType \r\n{ \r\n    Weapon,   // \u6b66\u5668\u69fd\uff08\u5c01\u8d4f1\u7ea7\u89e3\u9501\uff09\r\n    Armor,    // \u62a4\u7532\u69fd\uff08\u5c01\u8d4f2\u7ea7\u89e3\u9501\uff09\r\n    Mount     // \u5750\u9a91\u69fd\uff08\u5c01\u8d4f3\u7ea7\u89e3\u9501\uff09\r\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u89e3\u9501\u673a\u5236",children:"\u89e3\u9501\u673a\u5236"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'// EquipStatus.cs\r\n[Serializable]\r\npublic class EquipStatus\r\n{\r\n    // \u88c5\u5907UUID\r\n    public string weaponUuid = "";      // \u6b66\u5668\u7684UUID\r\n    public string armorUuid = "";       // \u62a4\u7532\u7684UUID\r\n    public string accessoryUuid = "";   // \u5750\u9a91\u7684UUID\r\n    \r\n    // \u69fd\u4f4d\u89e3\u9501\u72b6\u6001\r\n    public bool weaponUnlocked = false;   // \u6b66\u5668\u69fd\u662f\u5426\u89e3\u9501\uff08\u5c01\u8d4f1\u7ea7\uff09\r\n    public bool armorUnlocked = false;    // \u62a4\u7532\u69fd\u662f\u5426\u89e3\u9501\uff08\u5c01\u8d4f2\u7ea7\uff09\r\n    public bool mountUnlocked = false;    // \u5750\u9a91\u69fd\u662f\u5426\u89e3\u9501\uff08\u5c01\u8d4f3\u7ea7\uff09\r\n    \r\n    // \u6839\u636e\u5c01\u8d4f\u7b49\u7ea7\u66f4\u65b0\u69fd\u4f4d\u89e3\u9501\u72b6\u6001\r\n    public void UpdateUnlockStatus(int giftLevel)\r\n    {\r\n        weaponUnlocked = giftLevel >= 1;\r\n        armorUnlocked = giftLevel >= 2;\r\n        mountUnlocked = giftLevel >= 3;\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u88c5\u5907\u6570\u636e\u6a21\u578b",children:"\u88c5\u5907\u6570\u636e\u6a21\u578b"}),"\n",(0,a.jsx)(e.h3,{id:"\u6b66\u5668\u62a4\u7532---playergear",children:"\u6b66\u5668/\u62a4\u7532 - PlayerGear"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'// GearDefinitions.cs\r\n[Serializable]\r\npublic class PlayerGear\r\n{\r\n    public string uuid = "";         // \u552f\u4e00\u6807\u8bc6\u7b26\uff08UUID\u683c\u5f0f\uff09\r\n    public string staticId;          // \u9759\u6001\u914d\u7f6eID\uff08\u5982"weapon1"\uff09\r\n    public int level = 1;            // \u5f3a\u5316\u7b49\u7ea7\r\n    public bool unlocked = true;     // \u662f\u5426\u5df2\u89e3\u9501\r\n    public string equippedById = ""; // \u88c5\u5907\u5728\u54ea\u4e2a\u5361\u724c\u4e0a\r\n    \r\n    // \u751f\u6210UUID\r\n    public void EnsureUuid()\r\n    {\r\n        if (string.IsNullOrEmpty(uuid))\r\n            uuid = Guid.NewGuid().ToString("N");\r\n    }\r\n    \r\n    // \u83b7\u53d6\u9759\u6001\u914d\u7f6e\r\n    public GearStatic Static => GearDatabaseStatic.Instance.Get(staticId);\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"\u5750\u9a91---playerhorse",children:"\u5750\u9a91 - PlayerHorse"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'[Serializable]\r\npublic class PlayerHorse\r\n{\r\n    public string uuid = "";         // \u552f\u4e00\u6807\u8bc6\u7b26\r\n    public string staticId;          // \u9759\u6001\u914d\u7f6eID\uff08\u5982"horse1"\uff09\r\n    public int level = 1;            // \u5f3a\u5316\u7b49\u7ea7\r\n    public bool unlocked = true;     // \u662f\u5426\u5df2\u89e3\u9501\r\n    public string equippedById = ""; // \u88c5\u5907\u5728\u54ea\u4e2a\u5361\u724c\u4e0a\r\n    \r\n    // \u83b7\u53d6\u9759\u6001\u914d\u7f6e\r\n    public HorseStatic Static => HorseDatabaseStatic.Instance.Get(staticId);\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"\u9759\u6001\u914d\u7f6e---gearstatic",children:"\u9759\u6001\u914d\u7f6e - GearStatic"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'[Serializable]\r\npublic class GearStatic\r\n{\r\n    [Header("\u6807\u8bc6")]\r\n    public string id;               // \u88c5\u5907ID\r\n    public string name;             // \u88c5\u5907\u540d\u79f0\r\n    public GearKind kind;           // \u7c7b\u578b\uff08\u6b66\u5668/\u62a4\u7532\uff09\r\n    public Tier tier;               // \u54c1\u8d28\u7b49\u7ea7\uff08S/A/B\uff09\r\n    \r\n    [Header("\u6570\u503c\u500d\u7387 (Atk / Def)")]\r\n    public float[] valueMultiplier = new float[2];\r\n    \r\n    [Header("\u56fe\u6807")]\r\n    public Sprite iconSprite;       // \u88c5\u5907\u56fe\u6807\r\n    \r\n    // \u8ba1\u7b97\u5f53\u524d\u7b49\u7ea7\u7684\u5c5e\u6027\r\n    public (float atk, float def) CalcStats(int level)\r\n    {\r\n        float coe = DB.GetValueCoe(tier);\r\n        float pow = DB.GetValuePow(tier);\r\n        float statBase = coe * Mathf.Pow(level, pow);\r\n        \r\n        return (statBase * valueMultiplier[0],\r\n                statBase * valueMultiplier[1]);\r\n    }\r\n    \r\n    // \u8ba1\u7b97\u5347\u7ea7\u6750\u6599\u9700\u6c42\r\n    public (int iron, int fineWood, int steel) CalcUpgradeCost(int level)\r\n    {\r\n        float iron = DB.GetIronCostCoe(tier) * Mathf.Pow(level, DB.GetIronCostPow(tier));\r\n        float wood = level >= 10 \r\n            ? DB.GetFineWoodCoe(tier) * Mathf.Pow(level, DB.GetFineWoodPow(tier))\r\n            : 0;\r\n        float steel = level >= 20\r\n            ? DB.GetSteelCoe(tier) * Mathf.Pow(level, DB.GetSteelPow(tier))\r\n            : 0;\r\n            \r\n        return (Mathf.CeilToInt(iron),\r\n                Mathf.CeilToInt(wood),\r\n                Mathf.CeilToInt(steel));\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"\u9759\u6001\u914d\u7f6e---horsestatic",children:"\u9759\u6001\u914d\u7f6e - HorseStatic"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'[Serializable]\r\npublic class HorseStatic\r\n{\r\n    public string id;               // \u6218\u9a6cID\r\n    public string name;             // \u6218\u9a6c\u540d\u79f0\r\n    public Tier tier;               // \u54c1\u8d28\u7b49\u7ea7\r\n    public Sprite iconSprite;       // \u6218\u9a6c\u56fe\u6807\r\n    \r\n    [Header("\u5c5e\u6027\u52a0\u6210\u767e\u5206\u6bd4")]\r\n    public float[] valueMultiplier = new float[4]; // [\u653b\u51fb%, \u9632\u5fa1%, \u667a\u529b%, \u7edf\u7387%]\r\n    \r\n    // \u8ba1\u7b97\u5f53\u524d\u7b49\u7ea7\u7684\u5c5e\u6027\u52a0\u6210\r\n    public (float atk, float def, float intel, float cmd) CalcStats(int level)\r\n    {\r\n        float coe = DB.GetValueCoe(tier);\r\n        float pow = DB.GetValuePow(tier);\r\n        float statBase = coe * Mathf.Pow(level, pow);\r\n        \r\n        return (statBase * valueMultiplier[0],\r\n                statBase * valueMultiplier[1],\r\n                statBase * valueMultiplier[2],\r\n                statBase * valueMultiplier[3]);\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u88c5\u5907\u7ba1\u7406\u5668",children:"\u88c5\u5907\u7ba1\u7406\u5668"}),"\n",(0,a.jsx)(e.h3,{id:"playergearbank---\u88c5\u5907\u4ed3\u5e93",children:"PlayerGearBank - \u88c5\u5907\u4ed3\u5e93"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"public class PlayerGearBank : SingletonMono<PlayerGearBank>\r\n{\r\n    // \u88c5\u5907\u5217\u8868\r\n    private readonly List<PlayerGear> gears = new();\r\n    private Dictionary<string, PlayerGear> uuid2Gear;\r\n    \r\n    // \u4e8b\u4ef6\r\n    public Action<string> onGearChanged;\r\n    public Action<string> onGearUpdated;\r\n    \r\n    // \u6838\u5fc3\u65b9\u6cd5\r\n    public PlayerGear Get(string uuid);              // \u901a\u8fc7UUID\u83b7\u53d6\r\n    public PlayerGear GetByStatic(string staticId);  // \u901a\u8fc7\u9759\u6001ID\u83b7\u53d6\r\n    public PlayerGear Add(string staticId, int level = 1);\r\n    public PlayerGear AddWithUuid(string uuid, string staticId, int level = 1);\r\n    public void Remove(string uuid);\r\n    public void UpdateLevel(string uuid, int newLevel);\r\n    public void MarkDirty(string uuid);\r\n    public void Clear();\r\n    \r\n    // \u5c5e\u6027\r\n    public IEnumerable<PlayerGear> All => uuid2Gear?.Values ?? gears;\r\n    public int Count => uuid2Gear?.Count ?? gears.Count;\r\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"playerhorsebank---\u6218\u9a6c\u4ed3\u5e93",children:"PlayerHorseBank - \u6218\u9a6c\u4ed3\u5e93"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"public class PlayerHorseBank : SingletonMono<PlayerHorseBank>\r\n{\r\n    private readonly List<PlayerHorse> horses = new();\r\n    private Dictionary<string, PlayerHorse> uuid2Horse;\r\n    \r\n    // \u7c7b\u4f3cPlayerGearBank\u7684\u63a5\u53e3\r\n    public PlayerHorse Get(string uuid);\r\n    public void Add(PlayerHorse horse);\r\n    public void Remove(string uuid);\r\n    public void MarkDirty(string uuid);\r\n    public void Clear();\r\n    \r\n    public IEnumerable<PlayerHorse> All => horses;\r\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u88c5\u5907\u64cd\u4f5c",children:"\u88c5\u5907\u64cd\u4f5c"}),"\n",(0,a.jsx)(e.h3,{id:"equipmentmanager---\u7edf\u4e00\u7ba1\u7406\u5668",children:"EquipmentManager - \u7edf\u4e00\u7ba1\u7406\u5668"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'public static class EquipmentManager\r\n{\r\n    // \u88c5\u5907\u6b66\u5668/\u62a4\u7532\r\n    public static void Equip(\r\n        PlayerCard hero,\r\n        PlayerGear gear,\r\n        EquipSlotType slot,\r\n        PlayerCardBank cardBank,\r\n        PlayerGearBank gearBank)\r\n    {\r\n        if (hero == null || gear == null) return;\r\n        \r\n        // 1. \u5982\u679c\u88c5\u5907\u5728\u522b\u4eba\u8eab\u4e0a\uff0c\u5148\u5378\u4e0b\r\n        if (!string.IsNullOrEmpty(gear.equippedById) && \r\n            gear.equippedById != hero.id)\r\n        {\r\n            var oldHero = cardBank.Get(gear.equippedById);\r\n            if (oldHero != null)\r\n                ClearSlot(oldHero, slot, gearBank);\r\n        }\r\n        \r\n        // 2. \u5378\u4e0b\u82f1\u96c4\u5f53\u524d\u88c5\u5907\r\n        ClearSlot(hero, slot, gearBank);\r\n        \r\n        // 3. \u7a7f\u4e0a\u65b0\u88c5\u5907\r\n        switch (slot)\r\n        {\r\n            case EquipSlotType.Weapon:\r\n                hero.equip.weaponUuid = gear.uuid;\r\n                break;\r\n            case EquipSlotType.Armor:\r\n                hero.equip.armorUuid = gear.uuid;\r\n                break;\r\n            case EquipSlotType.Mount:\r\n                hero.equip.accessoryUuid = gear.uuid;\r\n                break;\r\n        }\r\n        gear.equippedById = hero.id;\r\n        \r\n        // 4. \u89e6\u53d1\u66f4\u65b0\r\n        gearBank.MarkDirty(gear.uuid);\r\n        PlayerCardBankMgr.I?.RaiseCardUpdated(hero.id);\r\n    }\r\n    \r\n    // \u88c5\u5907\u6218\u9a6c\r\n    public static void Equip(\r\n        PlayerCard hero,\r\n        PlayerHorse horse,\r\n        EquipSlotType slot,  // \u5fc5\u987b\u662fMount\r\n        PlayerCardBank cardBank,\r\n        PlayerHorseBank horseBank)\r\n    {\r\n        if (hero == null || horse == null || slot != EquipSlotType.Mount) \r\n            return;\r\n        \r\n        // \u7c7b\u4f3c\u6d41\u7a0b...\r\n        hero.equip.accessoryUuid = horse.uuid;\r\n        horse.equippedById = hero.id;\r\n        horseBank.MarkDirty(horse.uuid);\r\n        PlayerCardBankMgr.I?.RaiseCardUpdated(hero.id);\r\n    }\r\n    \r\n    // \u5378\u4e0b\u88c5\u5907\r\n    public static void ClearSlot(\r\n        PlayerCard hero,\r\n        EquipSlotType slot,\r\n        PlayerGearBank gearBank = null)\r\n    {\r\n        if (hero == null) return;\r\n        \r\n        string oldUuid = "";\r\n        switch (slot)\r\n        {\r\n            case EquipSlotType.Weapon:\r\n                oldUuid = hero.equip.weaponUuid;\r\n                hero.equip.weaponUuid = "";\r\n                break;\r\n            case EquipSlotType.Armor:\r\n                oldUuid = hero.equip.armorUuid;\r\n                hero.equip.armorUuid = "";\r\n                break;\r\n            case EquipSlotType.Mount:\r\n                oldUuid = hero.equip.accessoryUuid;\r\n                hero.equip.accessoryUuid = "";\r\n                break;\r\n        }\r\n        \r\n        if (gearBank != null && !string.IsNullOrEmpty(oldUuid))\r\n        {\r\n            var g = gearBank.Get(oldUuid);\r\n            if (g != null)\r\n            {\r\n                g.equippedById = "";\r\n                gearBank.MarkDirty(oldUuid);\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"ui\u5b9e\u73b0",children:"UI\u5b9e\u73b0"}),"\n",(0,a.jsx)(e.h3,{id:"cardequipmentmanager---\u5361\u724c\u88c5\u5907\u7ba1\u7406ui",children:"CardEquipmentManager - \u5361\u724c\u88c5\u5907\u7ba1\u7406UI"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'public class CardEquipmentManager : MonoBehaviour\r\n{\r\n    // UI\u5143\u7d20\r\n    private Button weaponSlot;\r\n    private Button armorSlot;\r\n    private Button mountSlot;\r\n    \r\n    // \u6570\u636e\r\n    private CardInfoStatic currentStatic;\r\n    private PlayerCard currentDynamic;\r\n    \r\n    // \u5237\u65b0\u88c5\u5907\u663e\u793a\r\n    public void RefreshEquipment()\r\n    {\r\n        if (currentDynamic == null) return;\r\n        \r\n        // \u83b7\u53d6\u88c5\u5907\u6570\u636e\r\n        var weaponData = GetEquipmentData(currentDynamic.equip.weaponUuid, EquipSlotType.Weapon);\r\n        var armorData = GetEquipmentData(currentDynamic.equip.armorUuid, EquipSlotType.Armor);\r\n        var mountData = GetEquipmentData(currentDynamic.equip.accessoryUuid, EquipSlotType.Mount);\r\n        \r\n        // \u66f4\u65b0\u69fd\u4f4d\u663e\u793a\r\n        UpdateEquipSlotVisual(0, weaponData, currentDynamic.equip.weaponUnlocked);\r\n        UpdateEquipSlotVisual(1, armorData, currentDynamic.equip.armorUnlocked);\r\n        UpdateEquipSlotVisual(2, mountData, currentDynamic.equip.mountUnlocked);\r\n    }\r\n    \r\n    // \u5904\u7406\u69fd\u4f4d\u70b9\u51fb\r\n    private void HandleSlotClick(EquipSlotType slot)\r\n    {\r\n        if (currentDynamic == null)\r\n        {\r\n            PopupManager.Show("\u63d0\u793a", "\u5c1a\u672a\u62e5\u6709\u8be5\u6b66\u5c06");\r\n            return;\r\n        }\r\n        \r\n        // \u68c0\u67e5\u69fd\u4f4d\u662f\u5426\u89e3\u9501\r\n        bool unlocked = IsSlotUnlocked(slot);\r\n        if (!unlocked)\r\n        {\r\n            PopupManager.Show("\u63d0\u793a", "\u8be5\u88c5\u5907\u69fd\u672a\u89e3\u9501");\r\n            return;\r\n        }\r\n        \r\n        // \u6253\u5f00\u88c5\u5907\u9009\u62e9\u9762\u677f\r\n        if (slot == EquipSlotType.Mount)\r\n        {\r\n            horsePanel?.Open(currentDynamic);\r\n        }\r\n        else\r\n        {\r\n            gearPanel?.Open(currentDynamic, slot);\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"\u88c5\u5907\u9009\u62e9\u9762\u677f",children:"\u88c5\u5907\u9009\u62e9\u9762\u677f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"public class GearSelectionPanel : MonoBehaviour\r\n{\r\n    // \u7b5b\u9009\u53ef\u88c5\u5907\u7684\u88c5\u5907\r\n    private List<PlayerGear> GetAvailableGears(EquipSlotType slot)\r\n    {\r\n        var allGears = PlayerGearBank.I.All;\r\n        var filtered = new List<PlayerGear>();\r\n        \r\n        foreach (var gear in allGears)\r\n        {\r\n            var gearStatic = gear.Static;\r\n            if (gearStatic == null) continue;\r\n            \r\n            // \u6839\u636e\u69fd\u4f4d\u7b5b\u9009\u7c7b\u578b\r\n            bool matchesSlot = slot switch\r\n            {\r\n                EquipSlotType.Weapon => gearStatic.kind == GearKind.Weapon,\r\n                EquipSlotType.Armor => gearStatic.kind == GearKind.Armor,\r\n                _ => false\r\n            };\r\n            \r\n            if (matchesSlot)\r\n            {\r\n                filtered.Add(gear);\r\n            }\r\n        }\r\n        \r\n        // \u6392\u5e8f\uff1a\u672a\u88c5\u5907\u7684\u4f18\u5148\uff0c\u54c1\u8d28\u9ad8\u7684\u4f18\u5148\r\n        filtered.Sort((a, b) =>\r\n        {\r\n            // \u672a\u88c5\u5907\u7684\u6392\u524d\u9762\r\n            bool aEquipped = !string.IsNullOrEmpty(a.equippedById);\r\n            bool bEquipped = !string.IsNullOrEmpty(b.equippedById);\r\n            if (aEquipped != bEquipped)\r\n                return aEquipped ? 1 : -1;\r\n            \r\n            // \u54c1\u8d28\u9ad8\u7684\u6392\u524d\u9762\r\n            return b.Static.tier.CompareTo(a.Static.tier);\r\n        });\r\n        \r\n        return filtered;\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u88c5\u5907\u5347\u7ea7",children:"\u88c5\u5907\u5347\u7ea7"}),"\n",(0,a.jsx)(e.h3,{id:"\u5347\u7ea7\u6750\u6599\u9700\u6c42",children:"\u5347\u7ea7\u6750\u6599\u9700\u6c42"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"// \u8ba1\u7b97\u5347\u7ea7\u6750\u6599\r\npublic (int iron, int fineWood, int steel) CalcUpgradeCost(int level)\r\n{\r\n    // \u57fa\u7840\u6750\u6599\uff1a\u94c1\uff08\u4efb\u4f55\u7b49\u7ea7\u90fd\u9700\u8981\uff09\r\n    float iron = DB.GetIronCostCoe(tier) * Mathf.Pow(level, DB.GetIronCostPow(tier));\r\n    \r\n    // 10\u7ea7\u4ee5\u4e0a\u9700\u8981\u7cbe\u6728\r\n    float wood = level >= 10\r\n        ? DB.GetFineWoodCoe(tier) * Mathf.Pow(level, DB.GetFineWoodPow(tier))\r\n        : 0;\r\n    \r\n    // 20\u7ea7\u4ee5\u4e0a\u9700\u8981\u7cbe\u94a2\r\n    float steel = level >= 20\r\n        ? DB.GetSteelCoe(tier) * Mathf.Pow(level, DB.GetSteelPow(tier))\r\n        : 0;\r\n    \r\n    return (Mathf.CeilToInt(iron),\r\n            Mathf.CeilToInt(wood),\r\n            Mathf.CeilToInt(steel));\r\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u5347\u7ea7\u6d41\u7a0b",children:"\u5347\u7ea7\u6d41\u7a0b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'void OnUpgradeClicked()\r\n{\r\n    if (selectedGear == null) return;\r\n    \r\n    // 1. \u8ba1\u7b97\u6750\u6599\u9700\u6c42\r\n    var (iron, wood, steel) = selectedGear.Static.CalcUpgradeCost(selectedGear.level + 1);\r\n    \r\n    // 2. \u68c0\u67e5\u6750\u6599\r\n    long currentIron = InventoryService.I.GetItemCount("RawIron");\r\n    long currentWood = InventoryService.I.GetItemCount("Firmwood");\r\n    long currentSteel = InventoryService.I.GetItemCount("IronIngot");\r\n    \r\n    if (currentIron < iron || currentWood < wood || currentSteel < steel)\r\n    {\r\n        PopupManager.Show("\u6750\u6599\u4e0d\u8db3", "\u5347\u7ea7\u6240\u9700\u6750\u6599\u4e0d\u8db3");\r\n        return;\r\n    }\r\n    \r\n    // 3. \u53d1\u9001\u5347\u7ea7\u8bf7\u6c42\r\n    var request = new UpgradeGearRequest(selectedGear.uuid);\r\n    MessageHub.I.Request("gear/upgrade", request, OnUpgradeResponse, 10f);\r\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u7f51\u7edc\u540c\u6b65",children:"\u7f51\u7edc\u540c\u6b65"}),"\n",(0,a.jsx)(e.h3,{id:"\u88c5\u5907\u5378\u8f7d\u8bf7\u6c42",children:"\u88c5\u5907/\u5378\u8f7d\u8bf7\u6c42"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class ChangeGearRequest\r\n{\r\n    public string gear_uuid;      // \u88c5\u5907UUID\r\n    public string equip_on_card;  // \u76ee\u6807\u5361\u724cID\uff08\u7a7a\u5b57\u7b26\u4e32\u8868\u793a\u5378\u8f7d\uff09\r\n    public int unload;           // 1=\u5378\u8f7d\uff0c0=\u88c5\u5907\r\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u88c5\u5907\u5378\u8f7d\u54cd\u5e94",children:"\u88c5\u5907/\u5378\u8f7d\u54cd\u5e94"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class ChangeGearResponse\r\n{\r\n    public string target_gear_unequip_from;    // \u88c5\u5907\u4ece\u54ea\u4e2a\u5361\u724c\u5378\u4e0b\r\n    public string target_gear_equip_on;        // \u88c5\u5907\u5230\u54ea\u4e2a\u5361\u724c\r\n    public string new_card_old_gear_removed;   // \u65b0\u5361\u724c\u7684\u65e7\u88c5\u5907UUID\r\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u5347\u7ea7\u8bf7\u6c42",children:"\u5347\u7ea7\u8bf7\u6c42"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class UpgradeGearRequest\r\n{\r\n    public string gear_uuid;\r\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u5347\u7ea7\u54cd\u5e94",children:"\u5347\u7ea7\u54cd\u5e94"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class UpgradeResponse\r\n{\r\n    public GearInfo gear_info;                    // \u88c5\u5907\u65b0\u4fe1\u606f\r\n    public Dictionary<string, long> current_balance; // \u6750\u6599\u4f59\u989d\r\n}\r\n\r\n[Serializable]\r\npublic class GearInfo\r\n{\r\n    public string gear_uuid;\r\n    public int gear_level;\r\n    public string on_card;\r\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u6570\u636e\u540c\u6b65\u670d\u52a1",children:"\u6570\u636e\u540c\u6b65\u670d\u52a1"}),"\n",(0,a.jsx)(e.h3,{id:"gearservice---\u88c5\u5907\u6570\u636e\u670d\u52a1",children:"GearService - \u88c5\u5907\u6570\u636e\u670d\u52a1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'public class GearService : SingletonMono<GearService>\r\n{\r\n    public bool IsInited { get; private set; }\r\n    public Action OnGearDataReady;\r\n    \r\n    // \u521d\u59cb\u5316\u83b7\u53d6\u6240\u6709\u88c5\u5907\r\n    public void Init()\r\n    {\r\n        MessageHub.I.Request("gear/get_gear", null, OnGetGearResp, 10f);\r\n    }\r\n    \r\n    // \u5904\u7406\u670d\u52a1\u5668\u6570\u636e\r\n    void ProcessGearData(List<GearItem> gearList)\r\n    {\r\n        // \u6e05\u7a7a\u73b0\u6709\u6570\u636e\r\n        PlayerGearBank.I?.Clear();\r\n        PlayerHorseBank.I?.Clear();\r\n        \r\n        // \u5206\u7c7b\u5904\u7406\r\n        foreach (var item in gearList)\r\n        {\r\n            if (item.gear_id.StartsWith("horse"))\r\n            {\r\n                // \u6dfb\u52a0\u5230\u6218\u9a6c\u5e93\r\n                var horse = new PlayerHorse\r\n                {\r\n                    uuid = item.gear_uuid,\r\n                    staticId = item.gear_id,\r\n                    level = item.gear_level,\r\n                    equippedById = item.on_card\r\n                };\r\n                PlayerHorseBank.I.Add(horse);\r\n            }\r\n            else if (item.gear_id.StartsWith("weapon") || \r\n                     item.gear_id.StartsWith("armor"))\r\n            {\r\n                // \u6dfb\u52a0\u5230\u88c5\u5907\u5e93\r\n                var gear = PlayerGearBank.I.AddWithUuid(\r\n                    item.gear_uuid, \r\n                    item.gear_id, \r\n                    item.gear_level\r\n                );\r\n                gear.equippedById = item.on_card;\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"cardservice\u4e2d\u7684\u88c5\u5907\u5904\u7406",children:"CardService\u4e2d\u7684\u88c5\u5907\u5904\u7406"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'// \u4ece\u670d\u52a1\u5668\u5361\u724c\u6570\u636e\u8f6c\u6362\u88c5\u5907UUID\r\nprivate string FindGearUuid(string gearId, string cardId, string gearType)\r\n{\r\n    if (string.IsNullOrEmpty(gearId)) return "";\r\n    \r\n    // \u5982\u679c\u5df2\u7ecf\u662fUUID\u683c\u5f0f\uff0c\u76f4\u63a5\u8fd4\u56de\r\n    if (gearId.Contains("-")) return gearId;\r\n    \r\n    // \u6839\u636e\u7c7b\u578b\u67e5\u627e\u5bf9\u5e94\u7684\u88c5\u5907\r\n    if (gearType == "weapon" || gearType == "armor")\r\n    {\r\n        // \u67e5\u627e\u88c5\u5907\u5728\u8be5\u5361\u724c\u4e0a\u7684\u88c5\u5907\r\n        var gear = PlayerGearBank.I?.All.FirstOrDefault(g => \r\n            g.staticId == gearId && g.equippedById == cardId);\r\n        \r\n        // \u5982\u679c\u627e\u4e0d\u5230\uff0c\u5c1d\u8bd5\u627e\u672a\u88c5\u5907\u7684\r\n        if (gear == null)\r\n        {\r\n            gear = PlayerGearBank.I?.All.FirstOrDefault(g => \r\n                g.staticId == gearId && string.IsNullOrEmpty(g.equippedById));\r\n            \r\n            if (gear != null)\r\n            {\r\n                // \u6807\u8bb0\u4e3a\u5df2\u88c5\u5907\r\n                gear.equippedById = cardId;\r\n                PlayerGearBank.I?.MarkDirty(gear.uuid);\r\n            }\r\n        }\r\n        \r\n        return gear?.uuid ?? "";\r\n    }\r\n    else if (gearType == "horse")\r\n    {\r\n        // \u7c7b\u4f3c\u5904\u7406\u6218\u9a6c\r\n        var horse = PlayerHorseBank.I?.All.FirstOrDefault(h => \r\n            h.staticId == gearId && h.equippedById == cardId);\r\n        return horse?.uuid ?? "";\r\n    }\r\n    \r\n    return "";\r\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u7279\u6b8a\u89c4\u5219",children:"\u7279\u6b8a\u89c4\u5219"}),"\n",(0,a.jsx)(e.h3,{id:"1-\u4e3b\u516c\u5361\u88c5\u5907",children:"1. \u4e3b\u516c\u5361\u88c5\u5907"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'// \u4e3b\u516c\u5361\u7684\u88c5\u5907\u69fd\u9ed8\u8ba4\u5168\u90e8\u89e3\u9501\r\nif (cardId == "LORD")\r\n{\r\n    lordCard.equip.weaponUnlocked = true;\r\n    lordCard.equip.armorUnlocked = true;\r\n    lordCard.equip.mountUnlocked = true;\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"2-\u5e7b\u5f71\u5361\u9650\u5236",children:"2. \u5e7b\u5f71\u5361\u9650\u5236"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-csharp",children:'// \u5e7b\u5f71\u5361\u4e0d\u80fd\u88c5\u5907\u9053\u5177\r\nif (pc.isPhantom)\r\n{\r\n    Debug.LogWarning($"Cannot equip on phantom card {id}");\r\n    return;\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"3-\u88c5\u5907\u552f\u4e00\u6027",children:"3. \u88c5\u5907\u552f\u4e00\u6027"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u4e00\u4ef6\u88c5\u5907\u540c\u65f6\u53ea\u80fd\u88c5\u5907\u5728\u4e00\u4e2a\u5361\u724c\u4e0a"}),"\n",(0,a.jsx)(e.li,{children:"\u5207\u6362\u88c5\u5907\u65f6\u81ea\u52a8\u4ece\u539f\u5361\u724c\u5378\u4e0b"}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"4-uuid\u7ba1\u7406",children:"4. UUID\u7ba1\u7406"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u6bcf\u4ef6\u88c5\u5907\u6709\u552f\u4e00\u7684UUID\u6807\u8bc6"}),"\n",(0,a.jsx)(e.li,{children:"\u670d\u52a1\u5668\u8fd4\u56de\u7684\u88c5\u5907\u4f7f\u7528UUID\u800c\u975e\u9759\u6001ID"}),"\n",(0,a.jsx)(e.li,{children:"\u672c\u5730\u7f13\u5b58UUID\u4e0e\u88c5\u5907\u5b9e\u4f8b\u7684\u6620\u5c04\u5173\u7cfb"}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"UUID\u8f6c\u6362"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u670d\u52a1\u5668\u53ef\u80fd\u8fd4\u56de\u9759\u6001ID\u6216UUID"}),"\n",(0,a.jsx)(e.li,{children:"\u9700\u8981\u6b63\u786e\u8f6c\u6362\u548c\u67e5\u627e\u5bf9\u5e94\u88c5\u5907\u5b9e\u4f8b"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u88c5\u5907\u72b6\u6001\u540c\u6b65"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u88c5\u5907/\u5378\u8f7d\u64cd\u4f5c\u9700\u8981\u540c\u6b65\u5230\u670d\u52a1\u5668"}),"\n",(0,a.jsx)(e.li,{children:"\u672c\u5730\u7acb\u5373\u66f4\u65b0\uff0c\u670d\u52a1\u5668\u786e\u8ba4\u540e\u6700\u7ec8\u751f\u6548"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"UI\u5237\u65b0"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u88c5\u5907\u53d8\u5316\u540e\u89e6\u53d1onGearUpdated\u4e8b\u4ef6"}),"\n",(0,a.jsx)(e.li,{children:"\u5361\u724c\u88c5\u5907\u53d8\u5316\u89e6\u53d1onCardUpdated\u4e8b\u4ef6"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6750\u6599\u6d88\u8017"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u5347\u7ea7\u6750\u6599\u4eceInventoryService\u83b7\u53d6"}),"\n",(0,a.jsx)(e.li,{children:"\u6839\u636e\u7b49\u7ea7\u9636\u6bb5\u9700\u8981\u4e0d\u540c\u6750\u6599"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6027\u80fd\u4f18\u5316"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u4f7f\u7528Dictionary\u7f13\u5b58UUID\u6620\u5c04"}),"\n",(0,a.jsx)(e.li,{children:"\u6279\u91cf\u66f4\u65b0\u51cf\u5c11UI\u5237\u65b0\u6b21\u6570"}),"\n"]}),"\n"]}),"\n"]})]})}function c(r={}){const{wrapper:e}={...(0,l.R)(),...r.components};return e?(0,a.jsx)(e,{...r,children:(0,a.jsx)(u,{...r})}):u(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>t,x:()=>s});var i=n(6540);const a={},l=i.createContext(a);function t(r){const e=i.useContext(l);return i.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function s(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(a):r.components||a:t(r.components),i.createElement(l.Provider,{value:e},r.children)}}}]);