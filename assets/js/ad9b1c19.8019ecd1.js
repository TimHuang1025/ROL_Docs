"use strict";(self.webpackChunkgame_docs=self.webpackChunkgame_docs||[]).push([[555],{6219:(r,n,e)=>{e.r(n),e.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>u,frontMatter:()=>l,metadata:()=>a,toc:()=>s});const a=JSON.parse('{"id":"\u5361\u724c/card-inventory","title":"\u5361\u724c\u5217\u8868UI\u7cfb\u7edf","description":"\u7cfb\u7edf\u6982\u8ff0","source":"@site/docs/\u5361\u724c/card-inventory.md","sourceDirName":"\u5361\u724c","slug":"/\u5361\u724c/card-inventory","permalink":"/ROL_Docs/docs/\u5361\u724c/card-inventory","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"id":"card-inventory","title":"\u5361\u724c\u5217\u8868UI\u7cfb\u7edf","sidebar_label":"\u5361\u724c\u5e93","sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"\u62bd\u5361\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/gacha-system"},"next":{"title":"\u4e3b\u516c\u5361\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/lord-card-system"}}');var t=e(4848),i=e(8453);const l={id:"card-inventory",title:"\u5361\u724c\u5217\u8868UI\u7cfb\u7edf",sidebar_label:"\u5361\u724c\u5e93",sidebar_position:9},d="\u5361\u724c\u5217\u8868UI\u7cfb\u7edf (CardInventory)",o={},s=[{value:"\u7cfb\u7edf\u6982\u8ff0",id:"\u7cfb\u7edf\u6982\u8ff0",level:2},{value:"\u7cfb\u7edf\u67b6\u6784",id:"\u7cfb\u7edf\u67b6\u6784",level:2},{value:"\u6838\u5fc3\u7ec4\u4ef6",id:"\u6838\u5fc3\u7ec4\u4ef6",level:2},{value:"CardGridController - \u7f51\u683c\u63a7\u5236\u5668",id:"cardgridcontroller---\u7f51\u683c\u63a7\u5236\u5668",level:3},{value:"\u521d\u59cb\u5316\u6d41\u7a0b",id:"\u521d\u59cb\u5316\u6d41\u7a0b",level:3},{value:"\u7b5b\u9009\u7cfb\u7edf",id:"\u7b5b\u9009\u7cfb\u7edf",level:2},{value:"\u54c1\u8d28\u7b5b\u9009",id:"\u54c1\u8d28\u7b5b\u9009",level:3},{value:"\u6392\u5e8f\u7cfb\u7edf",id:"\u6392\u5e8f\u7cfb\u7edf",level:2},{value:"\u6392\u5e8f\u6a21\u5f0f",id:"\u6392\u5e8f\u6a21\u5f0f",level:3},{value:"\u6392\u5e8f\u5b9e\u73b0",id:"\u6392\u5e8f\u5b9e\u73b0",level:3},{value:"\u7f51\u683c\u5e03\u5c40",id:"\u7f51\u683c\u5e03\u5c40",level:2},{value:"\u52a8\u6001\u5217\u6570\u8ba1\u7b97",id:"\u52a8\u6001\u5217\u6570\u8ba1\u7b97",level:3},{value:"\u7f51\u683c\u6784\u5efa",id:"\u7f51\u683c\u6784\u5efa",level:3},{value:"\u9009\u4e2d\u72b6\u6001\u7ba1\u7406",id:"\u9009\u4e2d\u72b6\u6001\u7ba1\u7406",level:2},{value:"\u5361\u7247\u9009\u4e2d",id:"\u5361\u7247\u9009\u4e2d",level:3},{value:"\u5de6\u4fa7\u8be6\u60c5\u663e\u793a",id:"\u5de6\u4fa7\u8be6\u60c5\u663e\u793a",level:2},{value:"\u663e\u793a\u9009\u4e2d\u5361\u7247",id:"\u663e\u793a\u9009\u4e2d\u5361\u7247",level:3},{value:"\u5b9e\u65f6\u66f4\u65b0",id:"\u5b9e\u65f6\u66f4\u65b0",level:2},{value:"\u5361\u7247\u6570\u636e\u66f4\u65b0",id:"\u5361\u7247\u6570\u636e\u66f4\u65b0",level:3},{value:"\u516c\u5171\u65b9\u6cd5",id:"\u516c\u5171\u65b9\u6cd5",level:2},{value:"\u5bfc\u822a\u652f\u6301",id:"\u5bfc\u822a\u652f\u6301",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"\u865a\u62df\u5316\u6eda\u52a8",id:"\u865a\u62df\u5316\u6eda\u52a8",level:3},{value:"\u7f13\u5b58\u7b56\u7565",id:"\u7f13\u5b58\u7b56\u7565",level:3},{value:"\u914d\u7f6e\u6587\u4ef6",id:"\u914d\u7f6e\u6587\u4ef6",level:2},{value:"CardSystemConfig",id:"cardsystemconfig",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function c(r){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...r.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u5361\u724c\u5217\u8868ui\u7cfb\u7edf-cardinventory",children:"\u5361\u724c\u5217\u8868UI\u7cfb\u7edf (CardInventory)"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7cfb\u7edf\u6982\u8ff0",children:"\u7cfb\u7edf\u6982\u8ff0"}),"\n",(0,t.jsx)(n.p,{children:"CardInventory \u662f\u6e38\u620f\u4e2d\u5c55\u793a\u548c\u7ba1\u7406\u6240\u6709\u5361\u724c\u7684\u6838\u5fc3UI\u7cfb\u7edf\u3002\u7cfb\u7edf\u4f7f\u7528 UIToolkit \u548c ScrollViewPro \u5b9e\u73b0\u865a\u62df\u5316\u6eda\u52a8\uff0c\u652f\u6301\u5361\u724c\u7b5b\u9009\u3001\u6392\u5e8f\u3001\u9009\u4e2d\u5c55\u793a\u7b49\u529f\u80fd\u3002\u7cfb\u7edf\u91c7\u7528\u7eb5\u5411\u7f51\u683c\u5e03\u5c40\uff0c\u5de6\u4fa7\u663e\u793a\u9009\u4e2d\u5361\u724c\u8be6\u60c5\uff0c\u53f3\u4fa7\u5c55\u793a\u6240\u6709\u5361\u724c\u5217\u8868\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u7cfb\u7edf\u67b6\u6784",children:"\u7cfb\u7edf\u67b6\u6784"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mermaid",children:'graph TB\r\n    subgraph "UI\u5c42"\r\n        A[CardInventory] --\x3e B[CardGridController]\r\n        B --\x3e C[ScrollViewPro]\r\n        B --\x3e D[\u5de6\u4fa7\u8be6\u60c5\u9762\u677f]\r\n        B --\x3e E[\u53f3\u4fa7\u5361\u724c\u7f51\u683c]\r\n    end\r\n    \r\n    subgraph "\u914d\u7f6e\u5c42"\r\n        F[CardSystemConfig] --\x3e B\r\n        G[CardSystemManager] --\x3e B\r\n    end\r\n    \r\n    subgraph "\u6570\u636e\u5c42"\r\n        H[PlayerCardBank] --\x3e B\r\n        I[CardDatabaseStatic] --\x3e B\r\n        J[CardService] --\x3e B\r\n    end\r\n    \r\n    subgraph "\u4e8b\u4ef6\u7cfb\u7edf"\r\n        K[PlayerCardBankMgr] --\x3e |onCardUpdated| B\r\n        B --\x3e |OnCardClicked| L[\u5916\u90e8\u76d1\u542c\u5668]\r\n    end\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u6838\u5fc3\u7ec4\u4ef6",children:"\u6838\u5fc3\u7ec4\u4ef6"}),"\n",(0,t.jsx)(n.h3,{id:"cardgridcontroller---\u7f51\u683c\u63a7\u5236\u5668",children:"CardGridController - \u7f51\u683c\u63a7\u5236\u5668"}),"\n",(0,t.jsx)(n.p,{children:"\u4e3b\u8981\u7684\u5361\u724c\u5217\u8868\u63a7\u5236\u5668\uff0c\u8d1f\u8d23\u7ba1\u7406\u6574\u4e2a\u5361\u724c\u663e\u793a\u903b\u8f91\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'public class CardGridController : MonoBehaviour\r\n{\r\n    #region \u4e8b\u4ef6\r\n    /// <summary>\r\n    /// \u5361\u7247\u70b9\u51fb\u4e8b\u4ef6\r\n    /// </summary>\r\n    public static event Action<CardInfoStatic, PlayerCard> OnCardClicked;\r\n    #endregion\r\n\r\n    #region \u79c1\u6709\u5b57\u6bb5\r\n    // \u6838\u5fc3\u5f15\u7528\r\n    private CardSystemManager manager;\r\n    private CardSystemConfig config => manager?.Config;\r\n    private ScrollViewPro scrollView;\r\n    private VisualElement gridRoot;\r\n    private Button sortButton;\r\n    private Label loadingLabel;\r\n\r\n    // \u5de6\u4fa7\u663e\u793a\u5143\u7d20\u7f13\u5b58\r\n    private VisualElement selectedCardVE;\r\n    private Label cardNameLabel;\r\n    private VisualElement tierDisplay;\r\n    private VisualElement starPanelDisplay;\r\n    private readonly VisualElement[] starElements = new VisualElement[5];\r\n\r\n    // \u54c1\u8d28\u7b5b\u9009\u76f8\u5173\r\n    private VisualElement allGroup, sTierGroup, aTierGroup, bTierGroup;\r\n    private VisualElement allClickBg, sClickBg, aClickBg, bClickBg;\r\n\r\n    // \u6392\u5e8f\r\n    private int sortModeIndex = 0;\r\n    private string[] sortModes => config?.layoutSettings?.sortModeNames ?? \r\n        new[] { "\u7a00\u6709\u5ea6", "\u661f\u7ea7", "\u7b49\u7ea7" };\r\n\r\n    // \u7b5b\u9009\r\n    public enum TierFilter { All, S, A, B }\r\n    private TierFilter currentTierFilter = TierFilter.All;\r\n\r\n    // \u9009\u4e2d\u72b6\u6001\r\n    private string selectedCardId;\r\n    private VisualElement currentSelectedContainer;\r\n\r\n    // \u7f13\u5b58\r\n    private readonly Dictionary<string, VisualElement> cardElements = new();\r\n    private readonly Dictionary<string, Button> cardBtnMap = new();\r\n\r\n    // \u6570\u636e\u72b6\u6001\r\n    private bool isDataLoaded = false;\r\n\r\n    // \u5e03\u5c40\u8ba1\u7b97\r\n    private int currentColumns = 4;\r\n    private float lastGlobalScale = 1f;\r\n    #endregion\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u521d\u59cb\u5316\u6d41\u7a0b",children:"\u521d\u59cb\u5316\u6d41\u7a0b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'public void Initialize(CardSystemManager manager)\r\n{\r\n    this.manager = manager;\r\n    SetupUI();\r\n    CheckDataReady();\r\n}\r\n\r\nprivate void SetupUI()\r\n{\r\n    var root = manager.UIDoc.rootVisualElement;\r\n    \r\n    // \u67e5\u627e\u5e76\u7f13\u5b58\u5de6\u4fa7\u663e\u793a\u5143\u7d20\r\n    CacheLeftPanelElements(root);\r\n    \r\n    // \u8bbe\u7f6e\u54c1\u8d28\u7b5b\u9009\r\n    SetupTierFilter(root);\r\n    \r\n    // \u67e5\u627e Cards \u9762\u677f\r\n    var cardsPanel = root.Q<VisualElement>("Cards");\r\n    \r\n    // \u5728 Cards \u4e2d\u67e5\u627e ScrollView\r\n    scrollView = cardsPanel.Q<ScrollViewPro>("CardScrollView");\r\n    \r\n    // \u8bbe\u7f6e\u7f51\u683c\u6839\u5bb9\u5668\r\n    gridRoot = scrollView.contentContainer;\r\n    \r\n    // \u8bbe\u7f6e\u6392\u5e8f\u6309\u94ae\r\n    SetupSortButton(root);\r\n    \r\n    // \u76d1\u542c\u5361\u7247\u66f4\u65b0\r\n    if (PlayerCardBankMgr.I != null)\r\n    {\r\n        PlayerCardBankMgr.I.onCardChanged += OnCardStatChanged;\r\n        PlayerCardBankMgr.I.onCardUpdated += OnCardUpdated;\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u7b5b\u9009\u7cfb\u7edf",children:"\u7b5b\u9009\u7cfb\u7edf"}),"\n",(0,t.jsx)(n.h3,{id:"\u54c1\u8d28\u7b5b\u9009",children:"\u54c1\u8d28\u7b5b\u9009"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"private void OnTierFilterClicked(TierFilter filter)\r\n{\r\n    currentTierFilter = filter;\r\n    UpdateTierFilterVisual();\r\n    RefreshDisplay();\r\n}\r\n\r\nprivate bool FilterByTier(CardInfoStatic card)\r\n{\r\n    return currentTierFilter switch\r\n    {\r\n        TierFilter.S => card.tier == Tier.S,\r\n        TierFilter.A => card.tier == Tier.A,\r\n        TierFilter.B => card.tier == Tier.B,\r\n        _ => true // All\r\n    };\r\n}\r\n\r\nprivate void UpdateTierFilterVisual()\r\n{\r\n    // \u9690\u85cf\u6240\u6709\u9009\u4e2d\u80cc\u666f\r\n    allClickBg?.SetDisplay(DisplayStyle.None);\r\n    sClickBg?.SetDisplay(DisplayStyle.None);\r\n    aClickBg?.SetDisplay(DisplayStyle.None);\r\n    bClickBg?.SetDisplay(DisplayStyle.None);\r\n    \r\n    // \u663e\u793a\u5f53\u524d\u9009\u4e2d\u7684\u80cc\u666f\r\n    switch (currentTierFilter)\r\n    {\r\n        case TierFilter.All:\r\n            allClickBg?.SetDisplay(DisplayStyle.Flex);\r\n            break;\r\n        case TierFilter.S:\r\n            sClickBg?.SetDisplay(DisplayStyle.Flex);\r\n            break;\r\n        case TierFilter.A:\r\n            aClickBg?.SetDisplay(DisplayStyle.Flex);\r\n            break;\r\n        case TierFilter.B:\r\n            bClickBg?.SetDisplay(DisplayStyle.Flex);\r\n            break;\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6392\u5e8f\u7cfb\u7edf",children:"\u6392\u5e8f\u7cfb\u7edf"}),"\n",(0,t.jsx)(n.h3,{id:"\u6392\u5e8f\u6a21\u5f0f",children:"\u6392\u5e8f\u6a21\u5f0f"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'// CardSystemConfig.cs\r\npublic string[] sortModeNames = { \r\n    "<u>\u7a00\u6709\u5ea6</u>\u6392\u5e8f", \r\n    "<u>\u661f\u7ea7</u>\u6392\u5e8f", \r\n    "<u>\u7b49\u7ea7</u>\u6392\u5e8f" \r\n};\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u6392\u5e8f\u5b9e\u73b0",children:"\u6392\u5e8f\u5b9e\u73b0"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"private void OnSortButtonClicked()\r\n{\r\n    if (!isDataLoaded) return;\r\n    \r\n    sortModeIndex = (sortModeIndex + 1) % sortModes.Length;\r\n    UpdateSortButtonText();\r\n    ApplySort();\r\n}\r\n\r\nprivate List<CardInfoStatic> GetSortedCards()\r\n{\r\n    if (config?.cardDatabase == null) return new List<CardInfoStatic>();\r\n    \r\n    var cards = config.cardDatabase.AllCards.ToList();\r\n    \r\n    // \u5148\u5e94\u7528\u54c1\u8d28\u7b5b\u9009\r\n    if (currentTierFilter != TierFilter.All)\r\n    {\r\n        cards = cards.Where(c => FilterByTier(c)).ToList();\r\n    }\r\n    \r\n    // \u518d\u5e94\u7528\u6392\u5e8f\r\n    switch (sortModeIndex)\r\n    {\r\n        case 0: // \u7a00\u6709\u5ea6\u6392\u5e8f\r\n            cards.Sort(CompareByRarity);\r\n            break;\r\n        case 1: // \u661f\u7ea7\u6392\u5e8f\r\n            cards.Sort(CompareByStar);\r\n            break;\r\n        case 2: // \u7b49\u7ea7\u6392\u5e8f\r\n            cards.Sort(CompareByLevel);\r\n            break;\r\n    }\r\n    \r\n    return cards;\r\n}\r\n\r\nprivate int CompareByRarity(CardInfoStatic a, CardInfoStatic b)\r\n{\r\n    return CompareCards(a, b, (dynA, dynB, infoA, infoB) =>\r\n    {\r\n        // \u54c1\u8d28\u4f18\u5148 (S > A > B)\r\n        int tierCmp = infoA.tier.CompareTo(infoB.tier);\r\n        if (tierCmp != 0) return tierCmp;\r\n        \r\n        // \u661f\u7ea7\u6b21\u4e4b (\u9ad8\u661f\u4f18\u5148)\r\n        int starCmp = (dynB?.star ?? -1).CompareTo(dynA?.star ?? -1);\r\n        if (starCmp != 0) return starCmp;\r\n        \r\n        // \u7b49\u7ea7\u6700\u540e (\u9ad8\u7b49\u7ea7\u4f18\u5148)\r\n        return (dynB?.level ?? -1).CompareTo(dynA?.level ?? -1);\r\n    });\r\n}\r\n\r\nprivate int CompareCards(CardInfoStatic a, CardInfoStatic b, \r\n    Func<PlayerCard, PlayerCard, CardInfoStatic, CardInfoStatic, int> comparison)\r\n{\r\n    var dynA = PlayerCardBank.I.Get(a.id);\r\n    var dynB = PlayerCardBank.I.Get(b.id);\r\n    \r\n    // \u5df2\u62e5\u6709\u7684\u5361\u724c\u6392\u5728\u524d\u9762\r\n    bool ownedA = dynA != null;\r\n    bool ownedB = dynB != null;\r\n    if (ownedA && !ownedB) return -1;\r\n    if (!ownedA && ownedB) return 1;\r\n    \r\n    return comparison(dynA, dynB, a, b);\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7f51\u683c\u5e03\u5c40",children:"\u7f51\u683c\u5e03\u5c40"}),"\n",(0,t.jsx)(n.h3,{id:"\u52a8\u6001\u5217\u6570\u8ba1\u7b97",children:"\u52a8\u6001\u5217\u6570\u8ba1\u7b97"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"private int CalculateColumns(float containerWidth)\r\n{\r\n    if (containerWidth <= 0) return 4; // \u9ed8\u8ba4\u503c\r\n    \r\n    var settings = config?.layoutSettings;\r\n    if (settings == null) return 4;\r\n    \r\n    // \u4f7f\u7528\u914d\u7f6e\u7684\u56fa\u5b9a\u5217\u6570\r\n    if (settings.columns > 0)\r\n    {\r\n        return settings.columns;\r\n    }\r\n    \r\n    // \u52a8\u6001\u8ba1\u7b97\u5217\u6570\r\n    float availableWidth = containerWidth - 40; // \u51cf\u53bb\u5185\u8fb9\u8ddd\r\n    float cardWithGap = settings.cardWidth + settings.colGap;\r\n    \r\n    // \u8ba1\u7b97\u80fd\u653e\u7f6e\u7684\u6700\u5927\u5217\u6570\r\n    int maxColumns = Mathf.Max(1, Mathf.FloorToInt((availableWidth + settings.colGap) / cardWithGap));\r\n    \r\n    // \u5e94\u7528\u5217\u6570\u4f7f\u7528\u7387\r\n    int adjustedColumns = Mathf.Max(settings.minColumns, \r\n        Mathf.FloorToInt(maxColumns * settings.columnUtilization));\r\n    \r\n    return Mathf.Max(settings.minColumns, adjustedColumns);\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u7f51\u683c\u6784\u5efa",children:"\u7f51\u683c\u6784\u5efa"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'private void BuildGrid(List<CardInfoStatic> cards)\r\n{\r\n    if (cards == null) return;\r\n    \r\n    var containerWidth = scrollView.contentContainer.resolvedStyle.width;\r\n    if (float.IsNaN(containerWidth) || containerWidth <= 0)\r\n    {\r\n        // \u5ef6\u8fdf\u6267\u884c\u76f4\u5230\u5bb9\u5668\u5bbd\u5ea6\u5c31\u7eea\r\n        scrollView.schedule.Execute(() =>\r\n        {\r\n            BuildGrid(cards);\r\n        }).ExecuteLater(10);\r\n        return;\r\n    }\r\n    \r\n    currentColumns = CalculateColumns(containerWidth);\r\n    \r\n    // \u6e05\u7a7a\u73b0\u6709\u7f51\u683c\r\n    gridRoot.Clear();\r\n    cardElements.Clear();\r\n    cardBtnMap.Clear();\r\n    \r\n    // \u5206\u7ec4\u6210\u884c\r\n    var rows = GroupIntoRows(cards, currentColumns);\r\n    \r\n    // \u521b\u5efa\u884c\u5bb9\u5668\r\n    foreach (var (row, rowIndex) in rows.Select((r, i) => (r, i)))\r\n    {\r\n        var rowContainer = CreateRowContainer(rowIndex);\r\n        \r\n        foreach (var card in row)\r\n        {\r\n            var cardContainer = CreateCardContainer(card);\r\n            rowContainer.Add(cardContainer);\r\n            cardElements[card.id] = cardContainer;\r\n        }\r\n        \r\n        gridRoot.Add(rowContainer);\r\n    }\r\n    \r\n    ScheduleVhSizerApply();\r\n}\r\n\r\nprivate VisualElement CreateCardContainer(CardInfoStatic info)\r\n{\r\n    var container = config.cardTemplate.Instantiate();\r\n    var btn = container.Q<Button>("CardSlot");\r\n    \r\n    // \u8bbe\u7f6e\u5361\u7247\u6570\u636e\r\n    var pCard = PlayerCardBank.I.Get(info.id);\r\n    bool isOwned = pCard != null;\r\n    \r\n    // \u8bbe\u7f6e\u56fe\u6807\r\n    var icon = btn.Q<VisualElement>("Icon");\r\n    if (icon != null && info.iconSprite != null)\r\n    {\r\n        icon.style.backgroundImage = new StyleBackground(info.iconSprite);\r\n    }\r\n    \r\n    // \u8bbe\u7f6e\u54c1\u8d28\u8fb9\u6846\u989c\u8272\r\n    var tierColor = GetTierColor(info.tier);\r\n    btn.style.borderTopColor = tierColor;\r\n    btn.style.borderRightColor = tierColor;\r\n    btn.style.borderBottomColor = tierColor;\r\n    btn.style.borderLeftColor = tierColor;\r\n    \r\n    // \u8bbe\u7f6e\u661f\u7ea7\r\n    var starPanel = btn.Q<VisualElement>("StarPanel");\r\n    if (starPanel != null && pCard != null)\r\n    {\r\n        FillStars(starPanel, pCard.star);\r\n    }\r\n    \r\n    // \u8bbe\u7f6e\u672a\u62e5\u6709\u7684\u906e\u7f69\r\n    if (!isOwned)\r\n    {\r\n        btn.style.unityBackgroundImageTintColor = new Color(0.3f, 0.3f, 0.3f, 0.5f);\r\n    }\r\n    \r\n    // \u8a3b\u518c\u70b9\u51fb\u4e8b\u4ef6\r\n    btn.clicked += () => OnCardClicked(info, btn);\r\n    cardBtnMap[info.id] = btn;\r\n    \r\n    return container;\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u9009\u4e2d\u72b6\u6001\u7ba1\u7406",children:"\u9009\u4e2d\u72b6\u6001\u7ba1\u7406"}),"\n",(0,t.jsx)(n.h3,{id:"\u5361\u7247\u9009\u4e2d",children:"\u5361\u7247\u9009\u4e2d"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'private void OnCardClicked(CardInfoStatic info, Button btn)\r\n{\r\n    if (info == null || btn == null) return;\r\n    \r\n    selectedCardId = info.id;\r\n    var container = btn.parent;\r\n    \r\n    // \u6e05\u9664\u4e4b\u524d\u7684\u9009\u4e2d\u72b6\u6001\r\n    if (currentSelectedContainer != null)\r\n    {\r\n        SetCardSelectedVisual(currentSelectedContainer, null, false);\r\n    }\r\n    \r\n    // \u8bbe\u7f6e\u65b0\u7684\u9009\u4e2d\u72b6\u6001\r\n    currentSelectedContainer = container;\r\n    SetCardSelectedVisual(container, info, true);\r\n    \r\n    // \u663e\u793a\u9009\u4e2d\u5361\u7247\u4fe1\u606f\r\n    ShowSelected(info, PlayerCardBank.I.Get(info.id));\r\n    \r\n    // \u89e6\u53d1\u9009\u4e2d\u4e8b\u4ef6\r\n    OnCardClicked?.Invoke(info, PlayerCardBank.I.Get(info.id));\r\n    \r\n    // \u5237\u65b0\u88c5\u5907\u69fd\u663e\u793a\r\n    RefreshEquipSlots(PlayerCardBank.I.Get(info.id), container);\r\n}\r\n\r\nprivate void SetCardSelectedVisual(VisualElement container, CardInfoStatic info, bool isSelected)\r\n{\r\n    if (container == null) return;\r\n    \r\n    var btn = container.Q<Button>("CardSlot");\r\n    if (btn == null) return;\r\n    \r\n    if (isSelected)\r\n    {\r\n        // \u6dfb\u52a0\u767d\u8272\u8fb9\u6846\u8868\u793a\u9009\u4e2d\r\n        btn.style.borderTopColor = Color.white;\r\n        btn.style.borderRightColor = Color.white;\r\n        btn.style.borderBottomColor = Color.white;\r\n        btn.style.borderLeftColor = Color.white;\r\n        btn.style.borderTopWidth = 8;\r\n        btn.style.borderRightWidth = 8;\r\n        btn.style.borderBottomWidth = 8;\r\n        btn.style.borderLeftWidth = 8;\r\n    }\r\n    else\r\n    {\r\n        // \u6062\u590d\u539f\u672c\u7684\u54c1\u8d28\u8fb9\u6846\r\n        if (info != null)\r\n        {\r\n            var tierColor = GetTierColor(info.tier);\r\n            btn.style.borderTopColor = tierColor;\r\n            btn.style.borderRightColor = tierColor;\r\n            btn.style.borderBottomColor = tierColor;\r\n            btn.style.borderLeftColor = tierColor;\r\n        }\r\n        btn.style.borderTopWidth = 2;\r\n        btn.style.borderRightWidth = 2;\r\n        btn.style.borderBottomWidth = 2;\r\n        btn.style.borderLeftWidth = 2;\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u5de6\u4fa7\u8be6\u60c5\u663e\u793a",children:"\u5de6\u4fa7\u8be6\u60c5\u663e\u793a"}),"\n",(0,t.jsx)(n.h3,{id:"\u663e\u793a\u9009\u4e2d\u5361\u7247",children:"\u663e\u793a\u9009\u4e2d\u5361\u7247"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"private void ShowSelected(CardInfoStatic info, PlayerCard dyn)\r\n{\r\n    if (info == null) return;\r\n    \r\n    // \u5904\u7406\u5e7b\u5f71\u5361\uff1a\u83b7\u53d6\u5b9e\u9645\u663e\u793a\u7684\u6570\u636e\r\n    var (displayStatic, displayDynamic) = GetDisplayCardData(info, dyn);\r\n    \r\n    // \u66f4\u65b0\u540d\u79f0\r\n    if (cardNameLabel != null)\r\n    {\r\n        cardNameLabel.text = displayStatic.displayName;\r\n        cardNameLabel.style.color = GetTierColor(displayStatic.tier);\r\n    }\r\n    \r\n    // \u66f4\u65b0\u7acb\u7ed8\r\n    if (selectedCardVE != null && displayStatic.fullBodySprite != null)\r\n    {\r\n        selectedCardVE.style.backgroundImage = new StyleBackground(displayStatic.fullBodySprite);\r\n    }\r\n    \r\n    // \u66f4\u65b0\u54c1\u8d28\u663e\u793a\r\n    if (tierDisplay != null)\r\n    {\r\n        UpdateTierDisplay(displayStatic.tier);\r\n    }\r\n    \r\n    // \u66f4\u65b0\u661f\u7ea7\u663e\u793a\r\n    if (starPanelDisplay != null && displayDynamic != null)\r\n    {\r\n        UpdateStarDisplay(displayDynamic.star);\r\n    }\r\n}\r\n\r\nprivate (CardInfoStatic, PlayerCard) GetDisplayCardData(CardInfoStatic info, PlayerCard dyn)\r\n{\r\n    // \u5982\u679c\u662f\u5e7b\u5f71\u5361\uff0c\u663e\u793a\u590d\u5236\u76ee\u6807\u7684\u6570\u636e\r\n    if (dyn?.isPhantom == true && !string.IsNullOrEmpty(dyn.cloneOn))\r\n    {\r\n        var targetCard = PlayerCardBank.I.Get(dyn.cloneOn);\r\n        if (targetCard != null)\r\n        {\r\n            var targetStatic = config.cardDatabase.GetCard(targetCard.id);\r\n            if (targetStatic != null)\r\n            {\r\n                return (targetStatic, targetCard);\r\n            }\r\n        }\r\n    }\r\n    \r\n    return (info, dyn);\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5b9e\u65f6\u66f4\u65b0",children:"\u5b9e\u65f6\u66f4\u65b0"}),"\n",(0,t.jsx)(n.h3,{id:"\u5361\u7247\u6570\u636e\u66f4\u65b0",children:"\u5361\u7247\u6570\u636e\u66f4\u65b0"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'private void OnCardUpdated(string id)\r\n{\r\n    RefreshCard(id);\r\n    \r\n    // \u5982\u679c\u66f4\u65b0\u7684\u662f\u5f53\u524d\u9009\u4e2d\u7684\u5361\u7247\uff0c\u66f4\u65b0\u5de6\u4fa7\u663e\u793a\r\n    if (selectedCardId == id)\r\n    {\r\n        var pCard = PlayerCardBank.I.Get(id);\r\n        var info = config.cardDatabase.Get(id);\r\n        if (info != null && pCard != null)\r\n        {\r\n            ShowSelected(info, pCard);\r\n        }\r\n    }\r\n    \r\n    // \u5982\u679c\u9009\u4e2d\u7684\u662f\u5e7b\u5f71\u5361\uff0c\u4e14\u66f4\u65b0\u7684\u662f\u5176\u590d\u5236\u76ee\u6807\uff0c\u4e5f\u9700\u8981\u66f4\u65b0\u663e\u793a\r\n    if (!string.IsNullOrEmpty(selectedCardId))\r\n    {\r\n        var selectedCard = PlayerCardBank.I.Get(selectedCardId);\r\n        if (selectedCard != null && selectedCard.isPhantom && selectedCard.cloneOn == id)\r\n        {\r\n            var selectedInfo = config.cardDatabase.Get(selectedCardId);\r\n            if (selectedInfo != null)\r\n            {\r\n                ShowSelected(selectedInfo, selectedCard);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nprivate void RefreshCard(string cardId)\r\n{\r\n    if (cardBtnMap.TryGetValue(cardId, out var btn))\r\n    {\r\n        var info = config.cardDatabase.Get(cardId);\r\n        var pCard = PlayerCardBank.I.Get(cardId);\r\n        \r\n        if (info != null)\r\n        {\r\n            // \u66f4\u65b0\u661f\u7ea7\r\n            var starPanel = btn.Q<VisualElement>("StarPanel");\r\n            if (starPanel != null)\r\n            {\r\n                FillStars(starPanel, pCard?.star ?? 0);\r\n            }\r\n            \r\n            // \u66f4\u65b0\u88c5\u5907\u69fd\r\n            RefreshEquipSlots(pCard, btn.parent);\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u516c\u5171\u65b9\u6cd5",children:"\u516c\u5171\u65b9\u6cd5"}),"\n",(0,t.jsx)(n.h3,{id:"\u5bfc\u822a\u652f\u6301",children:"\u5bfc\u822a\u652f\u6301"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"/// <summary>\r\n/// \u83b7\u53d6\u5f53\u524d\u6392\u5e8f\u548c\u7b5b\u9009\u540e\u7684\u5361\u7247\u5217\u8868\r\n/// </summary>\r\npublic List<CardInfoStatic> GetCurrentSortedCards()\r\n{\r\n    if (!isDataLoaded) return new List<CardInfoStatic>();\r\n    return GetSortedCards();\r\n}\r\n\r\n/// <summary>\r\n/// \u9009\u62e9\u6307\u5b9a\u7684\u5361\u7247\r\n/// </summary>\r\npublic void SelectCard(string cardId)\r\n{\r\n    selectedCardId = cardId;\r\n    RestoreSelection();\r\n}\r\n\r\n/// <summary>\r\n/// \u6eda\u52a8\u5230\u6307\u5b9a\u7684\u5361\u7247\r\n/// </summary>\r\npublic void ScrollToCard(string cardId)\r\n{\r\n    if (string.IsNullOrEmpty(cardId) || scrollView == null) return;\r\n    \r\n    if (!cardElements.TryGetValue(cardId, out var cardElement))\r\n    {\r\n        return;\r\n    }\r\n    \r\n    scrollView.schedule.Execute(() =>\r\n    {\r\n        var rowContainer = cardElement.parent;\r\n        if (rowContainer == null) return;\r\n        \r\n        // \u4f7f\u7528 ScrollViewPro \u7684\u6eda\u52a8\u529f\u80fd\r\n        scrollView.ScrollTo(rowContainer);\r\n    }).ExecuteLater(50);\r\n}\r\n\r\n/// <summary>\r\n/// \u5bfc\u822a\u5230\u76f8\u90bb\u7684\u5361\u7247\r\n/// </summary>\r\npublic void NavigateCard(int direction)\r\n{\r\n    var cards = GetSortedCards();\r\n    if (cards.Count <= 1) return;\r\n    \r\n    int currentIndex = GetSelectedCardIndex();\r\n    if (currentIndex == -1) currentIndex = 0;\r\n    \r\n    // \u8ba1\u7b97\u65b0\u7d22\u5f15\uff08\u5faa\u73af\uff09\r\n    int newIndex = currentIndex + direction;\r\n    if (newIndex < 0)\r\n        newIndex = cards.Count - 1;\r\n    else if (newIndex >= cards.Count)\r\n        newIndex = 0;\r\n    \r\n    SelectCardByIndex(newIndex);\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,t.jsx)(n.h3,{id:"\u865a\u62df\u5316\u6eda\u52a8",children:"\u865a\u62df\u5316\u6eda\u52a8"}),"\n",(0,t.jsx)(n.p,{children:"\u7cfb\u7edf\u4f7f\u7528 ScrollViewPro \u5b9e\u73b0\u865a\u62df\u5316\u6eda\u52a8\uff0c\u53ea\u6e32\u67d3\u53ef\u89c1\u533a\u57df\u7684\u5361\u7247\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'// ScrollViewPro \u914d\u7f6e\r\n<Kamgam.UIToolkitScrollViewPro.ScrollViewPro \r\n    name="CardScrollView"\r\n    snap-edge-clamp-y="true"\r\n    touch-scroll-type="Elastic"\r\n    scroller-buttons="false"\r\n    vertical-scroller-visibility="Hidden">\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u7f13\u5b58\u7b56\u7565",children:"\u7f13\u5b58\u7b56\u7565"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"// \u7f13\u5b58\u5361\u7247\u5143\u7d20\u548c\u6309\u94ae\u5f15\u7528\r\nprivate readonly Dictionary<string, VisualElement> cardElements = new();\r\nprivate readonly Dictionary<string, Button> cardBtnMap = new();\r\n\r\n// \u91cd\u7528\u73b0\u6709\u5143\u7d20\u800c\u975e\u91cd\u5efa\r\nprivate void ReorderGrid(List<CardInfoStatic> cards)\r\n{\r\n    // \u91cd\u65b0\u6392\u5e8f\u800c\u975e\u91cd\u5efa\u6574\u4e2a\u7f51\u683c\r\n    var orderedElements = cards\r\n        .Select(c => cardElements.TryGetValue(c.id, out var el) ? el : null)\r\n        .Where(el => el != null)\r\n        .ToList();\r\n    \r\n    // \u91cd\u65b0\u7ec4\u7ec7\u6210\u884c...\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u914d\u7f6e\u6587\u4ef6",children:"\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,t.jsx)(n.h3,{id:"cardsystemconfig",children:"CardSystemConfig"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'[CreateAssetMenu(fileName = "CardSystemConfig", menuName = "Card/System Config")]\r\npublic class CardSystemConfig : ScriptableObject\r\n{\r\n    [Header("\u5e03\u5c40\u8bbe\u7f6e")]\r\n    public LayoutSettings layoutSettings;\r\n    \r\n    [Header("\u6a21\u677f")]\r\n    public VisualTreeAsset cardTemplate;\r\n    \r\n    [Header("\u6570\u636e\u5e93")]\r\n    public CardDatabaseStatic cardDatabase;\r\n}\r\n\r\n[Serializable]\r\npublic class LayoutSettings\r\n{\r\n    [Header("\u5361\u7247\u5c3a\u5bf8")]\r\n    public float cardWidth = 280f;\r\n    public float cardHeight = 380f;\r\n    \r\n    [Header("\u95f4\u8ddd")]\r\n    public float colGap = 25f;\r\n    public float rowGap = 30f;\r\n    \r\n    [Header("\u5217\u6570\u8bbe\u7f6e")]\r\n    public int columns = 0;        // 0=\u81ea\u52a8\u8ba1\u7b97\r\n    public int minColumns = 3;     // \u6700\u5c0f\u5217\u6570\r\n    public float columnUtilization = 0.9f; // \u5217\u6570\u4f7f\u7528\u7387\r\n    \r\n    [Header("\u6392\u5e8f")]\r\n    public string[] sortModeNames = { \r\n        "<u>\u7a00\u6709\u5ea6</u>\u6392\u5e8f", \r\n        "<u>\u661f\u7ea7</u>\u6392\u5e8f", \r\n        "<u>\u7b49\u7ea7</u>\u6392\u5e8f" \r\n    };\r\n    public int defaultSortMode = 0;\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u521d\u59cb\u5316\u65f6\u673a"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5fc5\u987b\u7b49\u5f85 CardService \u6570\u636e\u5c31\u7eea"}),"\n",(0,t.jsx)(n.li,{children:"\u5ef6\u8fdf\u6267\u884c\u5e03\u5c40\u8ba1\u7b97\u786e\u4fdd\u5bb9\u5668\u5bbd\u5ea6\u5c31\u7eea"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u5e7b\u5f71\u5361\u5904\u7406"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u663e\u793a\u65f6\u4f7f\u7528\u590d\u5236\u76ee\u6807\u7684\u6570\u636e"}),"\n",(0,t.jsx)(n.li,{children:"\u66f4\u65b0\u65f6\u9700\u8981\u540c\u6b65\u5237\u65b0\u76f8\u5173\u5361\u7247"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u6027\u80fd\u8003\u8651"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4f7f\u7528\u865a\u62df\u5316\u6eda\u52a8\u51cf\u5c11\u6e32\u67d3\u538b\u529b"}),"\n",(0,t.jsx)(n.li,{children:"\u7f13\u5b58\u5143\u7d20\u5f15\u7528\u907f\u514d\u91cd\u590d\u67e5\u627e"}),"\n",(0,t.jsx)(n.li,{children:"\u6279\u91cf\u66f4\u65b0\u65f6\u4f7f\u7528\u91cd\u6392\u5e8f\u800c\u975e\u91cd\u5efa"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u54cd\u5e94\u5f0f\u5e03\u5c40"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u52a8\u6001\u8ba1\u7b97\u5217\u6570\u9002\u5e94\u4e0d\u540c\u5c4f\u5e55"}),"\n",(0,t.jsx)(n.li,{children:"\u76d1\u542c\u5bb9\u5668\u5c3a\u5bf8\u53d8\u5316\u91cd\u65b0\u5e03\u5c40"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u4e8b\u4ef6\u5904\u7406"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6b63\u786e\u8ba2\u9605\u548c\u53d6\u6d88\u8ba2\u9605\u4e8b\u4ef6"}),"\n",(0,t.jsx)(n.li,{children:"\u907f\u514d\u5185\u5b58\u6cc4\u6f0f"}),"\n"]}),"\n"]}),"\n"]})]})}function u(r={}){const{wrapper:n}={...(0,i.R)(),...r.components};return n?(0,t.jsx)(n,{...r,children:(0,t.jsx)(c,{...r})}):c(r)}},8453:(r,n,e)=>{e.d(n,{R:()=>l,x:()=>d});var a=e(6540);const t={},i=a.createContext(t);function l(r){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof r?r(n):{...n,...r}},[n,r])}function d(r){let n;return n=r.disableParentContext?"function"==typeof r.components?r.components(t):r.components||t:l(r.components),a.createElement(i.Provider,{value:n},r.children)}}}]);