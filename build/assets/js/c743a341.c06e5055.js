"use strict";(self.webpackChunkgame_docs=self.webpackChunkgame_docs||[]).push([[787],{916:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"\u5361\u724c/card-star-system","title":"\u5361\u724c\u5347\u661f\u7cfb\u7edf","description":"\u7cfb\u7edf\u6982\u8ff0","source":"@site/docs/\u5361\u724c/card-star-system.md","sourceDirName":"\u5361\u724c","slug":"/\u5361\u724c/card-star-system","permalink":"/ROL_Docs/docs/\u5361\u724c/card-star-system","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"card-star-system","title":"\u5361\u724c\u5347\u661f\u7cfb\u7edf","sidebar_label":"\u5347\u661f\u7cfb\u7edf","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"\u5c01\u8d4f\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/card-gift-system"},"next":{"title":"\u5e7b\u5f71\u5361\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/phantom-card-system"}}');var d=n(4848),s=n(8453);const t={id:"card-star-system",title:"\u5361\u724c\u5347\u661f\u7cfb\u7edf",sidebar_label:"\u5347\u661f\u7cfb\u7edf",sidebar_position:4},i="\u5361\u724c\u5347\u661f\u7cfb\u7edf",a={},c=[{value:"\u7cfb\u7edf\u6982\u8ff0",id:"\u7cfb\u7edf\u6982\u8ff0",level:2},{value:"\u5347\u661f\u89c4\u5219",id:"\u5347\u661f\u89c4\u5219",level:2},{value:"StarUpgradeRule - \u914d\u7f6e\u7ed3\u6784",id:"starupgraderule---\u914d\u7f6e\u7ed3\u6784",level:3},{value:"\u661f\u7ea7\u914d\u7f6e\u8868",id:"\u661f\u7ea7\u914d\u7f6e\u8868",level:3},{value:"\u788e\u7247\u7cfb\u7edf",id:"\u788e\u7247\u7cfb\u7edf",level:2},{value:"\u788e\u7247\u7c7b\u578b",id:"\u788e\u7247\u7c7b\u578b",level:3},{value:"\u788e\u7247\u4f7f\u7528\u903b\u8f91",id:"\u788e\u7247\u4f7f\u7528\u903b\u8f91",level:3},{value:"UI\u5b9e\u73b0",id:"ui\u5b9e\u73b0",level:2},{value:"UptierPanel - \u5347\u661f\u9762\u677f",id:"uptierpanel---\u5347\u661f\u9762\u677f",level:3},{value:"\u5347\u661f\u6d41\u7a0b",id:"\u5347\u661f\u6d41\u7a0b",level:3},{value:"\u54cd\u5e94\u5904\u7406",id:"\u54cd\u5e94\u5904\u7406",level:3},{value:"\u788e\u7247\u83b7\u53d6",id:"\u788e\u7247\u83b7\u53d6",level:2},{value:"\u83b7\u53d6\u4e13\u5c5e\u788e\u7247\u6570\u91cf",id:"\u83b7\u53d6\u4e13\u5c5e\u788e\u7247\u6570\u91cf",level:3},{value:"\u83b7\u53d6\u901a\u7528\u788e\u7247\u6570\u91cf",id:"\u83b7\u53d6\u901a\u7528\u788e\u7247\u6570\u91cf",level:3},{value:"\u6280\u80fd\u7b49\u7ea7\u63d0\u5347",id:"\u6280\u80fd\u7b49\u7ea7\u63d0\u5347",level:2},{value:"\u6280\u80fd\u7b49\u7ea7\u4e0e\u661f\u7ea7\u5173\u8054",id:"\u6280\u80fd\u7b49\u7ea7\u4e0e\u661f\u7ea7\u5173\u8054",level:3},{value:"\u4ece\u661f\u7ea7\u83b7\u53d6\u6280\u80fd\u7b49\u7ea7",id:"\u4ece\u661f\u7ea7\u83b7\u53d6\u6280\u80fd\u7b49\u7ea7",level:3},{value:"\u6280\u80fd\u7b49\u7ea7\u89c4\u5219\u8bf4\u660e",id:"\u6280\u80fd\u7b49\u7ea7\u89c4\u5219\u8bf4\u660e",level:3},{value:"\u661f\u7ea7\u663e\u793a",id:"\u661f\u7ea7\u663e\u793a",level:2},{value:"\u661f\u661fUI\u66f4\u65b0",id:"\u661f\u661fui\u66f4\u65b0",level:3},{value:"\u8fb9\u6846\u989c\u8272\u53d8\u5316",id:"\u8fb9\u6846\u989c\u8272\u53d8\u5316",level:3},{value:"\u7279\u6b8a\u89c4\u5219",id:"\u7279\u6b8a\u89c4\u5219",level:2},{value:"\u5e7b\u5f71\u5361\u9650\u5236",id:"\u5e7b\u5f71\u5361\u9650\u5236",level:3},{value:"\u6ee1\u661f\u5904\u7406",id:"\u6ee1\u661f\u5904\u7406",level:3},{value:"\u7f51\u7edc\u534f\u8bae",id:"\u7f51\u7edc\u534f\u8bae",level:2},{value:"\u5347\u661f\u8bf7\u6c42",id:"\u5347\u661f\u8bf7\u6c42",level:3},{value:"\u5347\u661f\u54cd\u5e94",id:"\u5347\u661f\u54cd\u5e94",level:3},{value:"\u9519\u8bef\u54cd\u5e94",id:"\u9519\u8bef\u54cd\u5e94",level:3},{value:"\u788e\u7247\u6765\u6e90",id:"\u788e\u7247\u6765\u6e90",level:2},{value:"\u6d4b\u8bd5\u83b7\u53d6\u788e\u7247\uff08\u4ec5\u5f00\u53d1\u73af\u5883\uff09",id:"\u6d4b\u8bd5\u83b7\u53d6\u788e\u7247\u4ec5\u5f00\u53d1\u73af\u5883",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function h(r){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...r.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.header,{children:(0,d.jsx)(e.h1,{id:"\u5361\u724c\u5347\u661f\u7cfb\u7edf",children:"\u5361\u724c\u5347\u661f\u7cfb\u7edf"})}),"\n",(0,d.jsx)(e.h2,{id:"\u7cfb\u7edf\u6982\u8ff0",children:"\u7cfb\u7edf\u6982\u8ff0"}),"\n",(0,d.jsx)(e.p,{children:"\u5347\u661f\u7cfb\u7edf\u901a\u8fc7\u6d88\u8017\u5361\u724c\u788e\u7247\u63d0\u5347\u5361\u724c\u661f\u7ea7\uff080-15\u661f\uff09\uff0c\u6bcf\u6b21\u5347\u661f\u90fd\u4f1a\u63d0\u5347\u6280\u80fd\u7b49\u7ea7\u548c\u6218\u529b\u52a0\u6210\u3002\u7cfb\u7edf\u652f\u6301\u4e13\u5c5e\u788e\u7247\u548c\u901a\u7528\u788e\u7247\u4e24\u79cd\u6750\u6599\u3002"}),"\n",(0,d.jsx)(e.h2,{id:"\u5347\u661f\u89c4\u5219",children:"\u5347\u661f\u89c4\u5219"}),"\n",(0,d.jsx)(e.h3,{id:"starupgraderule---\u914d\u7f6e\u7ed3\u6784",children:"StarUpgradeRule - \u914d\u7f6e\u7ed3\u6784"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class StarUpgradeRule\r\n{\r\n    public int starLevel;          // \u76ee\u6807\u661f\u7ea7 (1-15)\r\n    public int shardsRequired;     // \u6240\u9700\u788e\u7247\u6570\u91cf\r\n    public int battlePowerAdd;     // \u6218\u529b\u52a0\u6210\u503c\r\n    public int[] skillLvGain;      // \u6280\u80fd\u7b49\u7ea7 [\u4e3b\u52a8,\u88ab\u52a81,\u88ab\u52a82]\r\n    public string frameColor;      // \u8fb9\u6846\u989c\u8272 (blue/purple/gold)\r\n    public int starsInFrame;       // UI\u663e\u793a\u7b2c\u51e0\u9897\u661f\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u661f\u7ea7\u914d\u7f6e\u8868",children:"\u661f\u7ea7\u914d\u7f6e\u8868"}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u661f\u7ea7"}),(0,d.jsx)(e.th,{children:"\u6240\u9700\u788e\u7247"}),(0,d.jsx)(e.th,{children:"\u6218\u529b\u52a0\u6210"}),(0,d.jsx)(e.th,{children:"\u6280\u80fd\u7b49\u7ea7"}),(0,d.jsx)(e.th,{children:"\u8fb9\u6846\u989c\u8272"}),(0,d.jsx)(e.th,{children:"\u8fb9\u6846\u5185\u661f\u6570"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"0\u21921"}),(0,d.jsx)(e.td,{children:"100"}),(0,d.jsx)(e.td,{children:"0"}),(0,d.jsx)(e.td,{children:"[1,0,0]"}),(0,d.jsx)(e.td,{children:"blue"}),(0,d.jsx)(e.td,{children:"1"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"1\u21922"}),(0,d.jsx)(e.td,{children:"100"}),(0,d.jsx)(e.td,{children:"100"}),(0,d.jsx)(e.td,{children:"[1,1,0]"}),(0,d.jsx)(e.td,{children:"blue"}),(0,d.jsx)(e.td,{children:"2"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"2\u21923"}),(0,d.jsx)(e.td,{children:"200"}),(0,d.jsx)(e.td,{children:"1000"}),(0,d.jsx)(e.td,{children:"[1,1,1]"}),(0,d.jsx)(e.td,{children:"blue"}),(0,d.jsx)(e.td,{children:"3"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"3\u21924"}),(0,d.jsx)(e.td,{children:"200"}),(0,d.jsx)(e.td,{children:"2000"}),(0,d.jsx)(e.td,{children:"[1,1,1]"}),(0,d.jsx)(e.td,{children:"blue"}),(0,d.jsx)(e.td,{children:"4"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"4\u21925"}),(0,d.jsx)(e.td,{children:"400"}),(0,d.jsx)(e.td,{children:"3000"}),(0,d.jsx)(e.td,{children:"[2,1,1]"}),(0,d.jsx)(e.td,{children:"blue"}),(0,d.jsx)(e.td,{children:"5"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"5\u21926"}),(0,d.jsx)(e.td,{children:"600"}),(0,d.jsx)(e.td,{children:"5000"}),(0,d.jsx)(e.td,{children:"[2,2,1]"}),(0,d.jsx)(e.td,{children:"purple"}),(0,d.jsx)(e.td,{children:"1"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"6\u21927"}),(0,d.jsx)(e.td,{children:"800"}),(0,d.jsx)(e.td,{children:"8000"}),(0,d.jsx)(e.td,{children:"[2,2,2]"}),(0,d.jsx)(e.td,{children:"purple"}),(0,d.jsx)(e.td,{children:"2"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"7\u21928"}),(0,d.jsx)(e.td,{children:"800"}),(0,d.jsx)(e.td,{children:"13000"}),(0,d.jsx)(e.td,{children:"[3,2,2]"}),(0,d.jsx)(e.td,{children:"purple"}),(0,d.jsx)(e.td,{children:"3"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"8\u21929"}),(0,d.jsx)(e.td,{children:"1000"}),(0,d.jsx)(e.td,{children:"19000"}),(0,d.jsx)(e.td,{children:"[3,3,2]"}),(0,d.jsx)(e.td,{children:"purple"}),(0,d.jsx)(e.td,{children:"4"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"9\u219210"}),(0,d.jsx)(e.td,{children:"1000"}),(0,d.jsx)(e.td,{children:"20000"}),(0,d.jsx)(e.td,{children:"[3,3,3]"}),(0,d.jsx)(e.td,{children:"purple"}),(0,d.jsx)(e.td,{children:"5"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"10\u219211"}),(0,d.jsx)(e.td,{children:"1200"}),(0,d.jsx)(e.td,{children:"21000"}),(0,d.jsx)(e.td,{children:"[4,3,3]"}),(0,d.jsx)(e.td,{children:"gold"}),(0,d.jsx)(e.td,{children:"1"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"11\u219212"}),(0,d.jsx)(e.td,{children:"1200"}),(0,d.jsx)(e.td,{children:"23000"}),(0,d.jsx)(e.td,{children:"[4,4,3]"}),(0,d.jsx)(e.td,{children:"gold"}),(0,d.jsx)(e.td,{children:"2"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"12\u219213"}),(0,d.jsx)(e.td,{children:"1200"}),(0,d.jsx)(e.td,{children:"25000"}),(0,d.jsx)(e.td,{children:"[4,4,4]"}),(0,d.jsx)(e.td,{children:"gold"}),(0,d.jsx)(e.td,{children:"3"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"13\u219214"}),(0,d.jsx)(e.td,{children:"1200"}),(0,d.jsx)(e.td,{children:"35000"}),(0,d.jsx)(e.td,{children:"[4,4,4]"}),(0,d.jsx)(e.td,{children:"gold"}),(0,d.jsx)(e.td,{children:"4"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"14\u219215"}),(0,d.jsx)(e.td,{children:"0"}),(0,d.jsx)(e.td,{children:"45000"}),(0,d.jsx)(e.td,{children:"[4,4,4]"}),(0,d.jsx)(e.td,{children:"gold"}),(0,d.jsx)(e.td,{children:"5"})]})]})]}),"\n",(0,d.jsx)(e.h2,{id:"\u788e\u7247\u7cfb\u7edf",children:"\u788e\u7247\u7cfb\u7edf"}),"\n",(0,d.jsx)(e.h3,{id:"\u788e\u7247\u7c7b\u578b",children:"\u788e\u7247\u7c7b\u578b"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'// \u788e\u7247ID\u683c\u5f0f\r\n"HeroCrest_S1"        // S1\u4e13\u5c5e\u788e\u7247\r\n"HeroCrest_A1"        // A1\u4e13\u5c5e\u788e\u7247\r\n"HeroCrest_SGeneral"  // S\u7ea7\u901a\u7528\u788e\u7247\r\n"HeroCrest_AGeneral"  // A\u7ea7\u901a\u7528\u788e\u7247\r\n"HeroCrest_BGeneral"  // B\u7ea7\u901a\u7528\u788e\u7247\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u788e\u7247\u4f7f\u7528\u903b\u8f91",children:"\u788e\u7247\u4f7f\u7528\u903b\u8f91"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"// \u8ba1\u7b97\u788e\u7247\u4f7f\u7528\r\nvoid CalculateShardUsage(string cardId, Tier tier, bool useGeneral)\r\n{\r\n    // \u83b7\u53d6\u5f53\u524d\u661f\u7ea7\u7684\u5347\u661f\u89c4\u5219\uff08\u6ce8\u610f\u662f\u5f53\u524d\u661f\u7ea7\uff0c\u4e0d\u662f+1\uff09\r\n    var rule = CardDatabaseStatic.Instance.GetStar(card.star);\r\n    if (rule == null) return;  // \u5df2\u6ee1\u661f\u6216\u65e0\u89c4\u5219\r\n    \r\n    int needShards = rule.shardsRequired;\r\n    \r\n    // \u83b7\u53d6\u788e\u7247\u6570\u91cf\uff08\u4eceInventoryService\uff09\r\n    int specificShards = GetSpecificShardCount(cardId);\r\n    int generalShards = GetGeneralShardCount(tier);\r\n    \r\n    // \u4f18\u5148\u4f7f\u7528\u4e13\u5c5e\u788e\u7247\r\n    int specUse = Mathf.Min(specificShards, needShards);\r\n    int gap = needShards - specUse;\r\n    \r\n    // \u4e0d\u8db3\u90e8\u5206\u7528\u901a\u7528\u788e\u7247\uff08\u9700\u8981\u52fe\u9009\uff09\r\n    int genUse = (useGeneral && gap > 0) ? Mathf.Min(generalShards, gap) : 0;\r\n    \r\n    // \u68c0\u67e5\u662f\u5426\u8db3\u591f\r\n    bool canUpgrade = (specUse + genUse) >= needShards;\r\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"ui\u5b9e\u73b0",children:"UI\u5b9e\u73b0"}),"\n",(0,d.jsx)(e.h3,{id:"uptierpanel---\u5347\u661f\u9762\u677f",children:"UptierPanel - \u5347\u661f\u9762\u677f"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"public class UptierPanelUI : MonoBehaviour\r\n{\r\n    // UI\u5143\u7d20\r\n    Button rankUpBtn;              // \u5347\u661f\u6309\u94ae\r\n    Toggle useGeneralTgl;          // \u4f7f\u7528\u901a\u7528\u788e\u7247\u5f00\u5173\r\n    \r\n    // \u6750\u6599\u663e\u793a\r\n    Label playerMaterial1Num;      // \u4e13\u5c5e\u788e\u7247\u6570\u91cf\r\n    Label material1NeedLbl;        // \u4e13\u5c5e\u788e\u7247\u9700\u6c42\r\n    Label playerMaterial2Num;      // \u901a\u7528\u788e\u7247\u6570\u91cf\r\n    Label material2NeedLbl;        // \u901a\u7528\u788e\u7247\u9700\u6c42\r\n    \r\n    // \u661f\u7ea7\u663e\u793a\r\n    VisualElement[] curStars;      // \u5f53\u524d\u661f\u661f\r\n    VisualElement[] nextStars;     // \u5347\u7ea7\u540e\u661f\u661f\r\n    \r\n    // \u6280\u80fd\u7b49\u7ea7\u663e\u793a\r\n    Label[] lblBeforeLv;           // \u5347\u7ea7\u524d\u6280\u80fd\u7b49\u7ea7\r\n    Label[] lblAfterLv;            // \u5347\u7ea7\u540e\u6280\u80fd\u7b49\u7ea7\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u5347\u661f\u6d41\u7a0b",children:"\u5347\u661f\u6d41\u7a0b"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'void OnRankUpClicked()\r\n{\r\n    // 1. \u83b7\u53d6\u5f53\u524d\u661f\u7ea7\u7684\u5347\u661f\u89c4\u5219\uff08\u6ce8\u610f\u662f\u5f53\u524d\u661f\u7ea7\uff0c\u4e0d\u662fstar+1\uff09\r\n    var rule = CardDatabaseStatic.Instance.GetStar(dyn.star);\r\n    if (rule == null)\r\n    {\r\n        PopupManager.Show("\u65e0\u6cd5\u5347\u661f");\r\n        return;\r\n    }\r\n    \r\n    // 2. \u68c0\u67e5\u6750\u6599\r\n    int need = rule.shardsRequired;\r\n    int specOwn = GetSpecificShardCount(dyn.id);  // \u4eceInventoryService\u83b7\u53d6\r\n    int genOwn = GetGeneralShardCount(info.tier);  // \u4eceInventoryService\u83b7\u53d6\r\n    bool useGen = useGeneralTgl?.value == true;    // \u68c0\u67e5\u662f\u5426\u52fe\u9009\u4f7f\u7528\u901a\u7528\r\n    \r\n    if (specOwn + (useGen ? genOwn : 0) < need)\r\n    {\r\n        PopupManager.Show("\u6750\u6599\u4e0d\u8db3", "\u788e\u7247\u6570\u91cf\u4e0d\u8db3\uff0c\u65e0\u6cd5\u5347\u661f");\r\n        return;\r\n    }\r\n    \r\n    // 3. \u53d1\u9001\u8bf7\u6c42\r\n    DoUpgradeStar();\r\n}\r\n\r\nvoid DoUpgradeStar()\r\n{\r\n    var request = new CardUpgradeStarRequest\r\n    {\r\n        card_id = dyn.id,\r\n        use_general_crest = useGeneralTgl?.value == true ? 1 : 0\r\n    };\r\n    \r\n    MessageHub.I.Request("card/upgrade_star", request, OnResponse, 10f);\r\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u54cd\u5e94\u5904\u7406",children:"\u54cd\u5e94\u5904\u7406"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"void OnUpgradeStarResponse(MessageHub.Response resp)\r\n{\r\n    if (resp.code != 0)\r\n    {\r\n        HandleError(resp);\r\n        return;\r\n    }\r\n    \r\n    var data = JsonConvert.DeserializeObject<CardUpgradeStarResponse>(resp.dataJson);\r\n    \r\n    // \u66f4\u65b0\u5361\u7247\u661f\u7ea7\r\n    if (data.new_card_star != null)\r\n    {\r\n        foreach (var kvp in data.new_card_star)\r\n        {\r\n            var card = PlayerCardBank.I.Get(kvp.Key);\r\n            if (card != null)\r\n            {\r\n                card.star = kvp.Value;\r\n                PlayerCardBankMgr.I.BroadcastCardUpdated(kvp.Key);\r\n            }\r\n        }\r\n    }\r\n    \r\n    // \u66f4\u65b0\u788e\u7247\u4f59\u989d\r\n    if (data.current_balance != null)\r\n    {\r\n        foreach (var kvp in data.current_balance)\r\n        {\r\n            InventoryService.I?.UpdateItem(kvp.Key, kvp.Value);\r\n        }\r\n    }\r\n    \r\n    RefreshUI();\r\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u788e\u7247\u83b7\u53d6",children:"\u788e\u7247\u83b7\u53d6"}),"\n",(0,d.jsx)(e.h3,{id:"\u83b7\u53d6\u4e13\u5c5e\u788e\u7247\u6570\u91cf",children:"\u83b7\u53d6\u4e13\u5c5e\u788e\u7247\u6570\u91cf"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'int GetSpecificShardCount(string cardId)\r\n{\r\n    if (string.IsNullOrEmpty(cardId)) return 0;\r\n    \r\n    // \u4e13\u5c5e\u788e\u7247ID\u683c\u5f0f\uff1aHeroCrest_S1, HeroCrest_A1 \u7b49\r\n    string shardId = $"HeroCrest_{cardId}";\r\n    \r\n    // \u4eceInventoryService\u7684Shards\u5b57\u5178\u83b7\u53d6\r\n    if (InventoryService.I?.Shards != null && \r\n        InventoryService.I.Shards.TryGetValue(shardId, out long count))\r\n    {\r\n        return (int)count;\r\n    }\r\n    \r\n    return 0;\r\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u83b7\u53d6\u901a\u7528\u788e\u7247\u6570\u91cf",children:"\u83b7\u53d6\u901a\u7528\u788e\u7247\u6570\u91cf"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'int GetGeneralShardCount(Tier tier)\r\n{\r\n    if (InventoryService.I == null || !InventoryService.I.IsInited)\r\n    {\r\n        return 0;\r\n    }\r\n    \r\n    string shardId = tier switch\r\n    {\r\n        Tier.S => "HeroCrest_SGeneral",\r\n        Tier.A => "HeroCrest_AGeneral",\r\n        Tier.B => "HeroCrest_BGeneral",\r\n        _ => null\r\n    };\r\n    \r\n    if (string.IsNullOrEmpty(shardId)) return 0;\r\n    \r\n    // \u901a\u7528\u788e\u7247\u53ef\u80fd\u5728Bag\u6216Shards\u4e2d\r\n    long count = 0;\r\n    \r\n    // \u5148\u68c0\u67e5Bag\r\n    if (InventoryService.I.Bag.TryGetValue(shardId, out long bagCount))\r\n    {\r\n        count = bagCount;\r\n    }\r\n    // \u518d\u68c0\u67e5Shards\r\n    else if (InventoryService.I.Shards.TryGetValue(shardId, out long shardCount))\r\n    {\r\n        count = shardCount;\r\n    }\r\n    \r\n    return (int)count;\r\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"\u6280\u80fd\u7b49\u7ea7\u63d0\u5347",children:"\u6280\u80fd\u7b49\u7ea7\u63d0\u5347"}),"\n",(0,d.jsx)(e.h3,{id:"\u6280\u80fd\u7b49\u7ea7\u4e0e\u661f\u7ea7\u5173\u8054",children:"\u6280\u80fd\u7b49\u7ea7\u4e0e\u661f\u7ea7\u5173\u8054"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'void UpdateSkillLevelDisplay(int currentStar, int nextStar)\r\n{\r\n    // \u83b7\u53d6\u5f53\u524d\u661f\u7ea7\u7684\u6280\u80fd\u7b49\u7ea7\r\n    var currentRule = CardDatabaseStatic.Instance.GetStar(currentStar);\r\n    if (currentRule != null && currentRule.skillLvGain != null && currentRule.skillLvGain.Length >= 3)\r\n    {\r\n        lblBeforeLv[0].text = $"Lv.{currentRule.skillLvGain[0]}";  // \u4e3b\u52a8\r\n        lblBeforeLv[1].text = $"Lv.{currentRule.skillLvGain[1]}";  // \u88ab\u52a81\r\n        lblBeforeLv[2].text = $"Lv.{currentRule.skillLvGain[2]}";  // \u88ab\u52a82\r\n    }\r\n    \r\n    // \u83b7\u53d6\u5347\u7ea7\u540e\u6280\u80fd\u7b49\u7ea7\r\n    var nextRule = CardDatabaseStatic.Instance.GetStar(nextStar);\r\n    if (nextRule != null && nextRule.skillLvGain != null && nextRule.skillLvGain.Length >= 3)\r\n    {\r\n        lblAfterLv[0].text = $"Lv.{nextRule.skillLvGain[0]}";\r\n        lblAfterLv[1].text = $"Lv.{nextRule.skillLvGain[1]}";\r\n        lblAfterLv[2].text = $"Lv.{nextRule.skillLvGain[2]}";\r\n    }\r\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u4ece\u661f\u7ea7\u83b7\u53d6\u6280\u80fd\u7b49\u7ea7",children:"\u4ece\u661f\u7ea7\u83b7\u53d6\u6280\u80fd\u7b49\u7ea7"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"int GetSkillLevelFromStar(int star, int skillIndex)\r\n{\r\n    if (star <= 0) return 0;  // 0\u661f\u9ed8\u8ba40\u7ea7\r\n    \r\n    var rule = CardDatabaseStatic.Instance.GetStar(star);\r\n    if (rule?.skillLvGain != null && skillIndex < rule.skillLvGain.Length)\r\n    {\r\n        return rule.skillLvGain[skillIndex];\r\n    }\r\n    \r\n    return 0;\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u6280\u80fd\u7b49\u7ea7\u89c4\u5219\u8bf4\u660e",children:"\u6280\u80fd\u7b49\u7ea7\u89c4\u5219\u8bf4\u660e"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"skillLvGain\u662f\u4e00\u4e2aint[]\u6570\u7ec4\uff0c\u5305\u542b3\u4e2a\u503c\uff1a[\u4e3b\u52a8\u6280\u80fd\u7b49\u7ea7, \u88ab\u52a81\u7b49\u7ea7, \u88ab\u52a82\u7b49\u7ea7]"}),"\n",(0,d.jsx)(e.li,{children:"0\u661f\u65f6\u6240\u6709\u6280\u80fd\u7b49\u7ea7\u4e3a0"}),"\n",(0,d.jsx)(e.li,{children:"\u968f\u7740\u661f\u7ea7\u63d0\u5347\uff0c\u6280\u80fd\u7b49\u7ea7\u9010\u6b65\u63d0\u9ad8"}),"\n",(0,d.jsx)(e.li,{children:"15\u661f\u65f6\u6280\u80fd\u8fbe\u5230\u6700\u9ad8\u7b49\u7ea7[4,4,4]"}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"\u661f\u7ea7\u663e\u793a",children:"\u661f\u7ea7\u663e\u793a"}),"\n",(0,d.jsx)(e.h3,{id:"\u661f\u661fui\u66f4\u65b0",children:"\u661f\u661fUI\u66f4\u65b0"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"void UpdateStarRows(int curStar, int nextStar)\r\n{\r\n    // \u5f53\u524d\u661f\u7ea7\u663e\u793a\r\n    for (int i = 0; i < 5; i++)\r\n    {\r\n        if (curStars[i] == null) continue;\r\n        \r\n        bool filled = (curStar % 5) > i || (curStar % 5 == 0 && curStar > 0);\r\n        curStars[i].style.opacity = filled ? 1f : 0.3f;\r\n    }\r\n    \r\n    // \u4e0b\u4e00\u661f\u7ea7\u663e\u793a\r\n    for (int i = 0; i < 5; i++)\r\n    {\r\n        if (nextStars[i] == null) continue;\r\n        \r\n        bool filled = (nextStar % 5) > i || (nextStar % 5 == 0);\r\n        nextStars[i].style.opacity = filled ? 1f : 0.3f;\r\n    }\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u8fb9\u6846\u989c\u8272\u53d8\u5316",children:"\u8fb9\u6846\u989c\u8272\u53d8\u5316"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'void UpdateFrameColor(int star)\r\n{\r\n    var rule = CardDatabaseStatic.Instance.GetStar(star);\r\n    if (rule == null) return;\r\n    \r\n    Color frameColor = rule.frameColor switch\r\n    {\r\n        "blue" => new Color(0.2f, 0.4f, 0.8f),\r\n        "purple" => new Color(0.6f, 0.2f, 0.8f),\r\n        "gold" => new Color(0.9f, 0.7f, 0.2f),\r\n        _ => Color.white\r\n    };\r\n    \r\n    cardFrame.style.borderTopColor = frameColor;\r\n    cardFrame.style.borderBottomColor = frameColor;\r\n    cardFrame.style.borderLeftColor = frameColor;\r\n    cardFrame.style.borderRightColor = frameColor;\r\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"\u7279\u6b8a\u89c4\u5219",children:"\u7279\u6b8a\u89c4\u5219"}),"\n",(0,d.jsx)(e.h3,{id:"\u5e7b\u5f71\u5361\u9650\u5236",children:"\u5e7b\u5f71\u5361\u9650\u5236"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'public void AddStar(string id, int delta)\r\n{\r\n    var card = PlayerCardBank.I.Get(id);\r\n    \r\n    // \u5e7b\u5f71\u5361\u4e0d\u80fd\u5347\u661f\r\n    if (card.isPhantom)\r\n    {\r\n        Debug.LogWarning($"Cannot star up phantom card {id}");\r\n        return;\r\n    }\r\n    \r\n    card.star = Mathf.Clamp(card.star + delta, 0, 15);\r\n    SyncPhantomsForCard(id);  // \u540c\u6b65\u5e7b\u5f71\u5361\r\n}\n'})}),"\n",(0,d.jsx)(e.h3,{id:"\u6ee1\u661f\u5904\u7406",children:"\u6ee1\u661f\u5904\u7406"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'void CheckMaxStar()\r\n{\r\n    if (dyn.star >= 15)\r\n    {\r\n        rankUpBtn.SetEnabled(false);\r\n        rankUpBtn.text = "\u5df2\u6ee1\u661f";\r\n        \r\n        // \u9690\u85cf\u6750\u6599\u9700\u6c42\u663e\u793a\r\n        costSelLbl.text = "\u5df2\u6ee1\u7ea7";\r\n        playerMaterial1Num.text = "-";\r\n        material1NeedLbl.text = "-";\r\n        playerMaterial2Num.text = "-";\r\n        material2NeedLbl.text = "-";\r\n        genMatRow.style.display = DisplayStyle.None;\r\n        plusLbl.style.display = DisplayStyle.None;\r\n        useGeneralTgl.style.display = DisplayStyle.None;\r\n        \r\n        return;\r\n    }\r\n    \r\n    // \u68c0\u67e5\u5347\u661f\u89c4\u5219\u662f\u5426\u5b58\u5728\r\n    var starRule = CardDatabaseStatic.Instance.GetStar(dyn.star);\r\n    if (starRule == null || starRule.shardsRequired == 0)\r\n    {\r\n        // \u6ca1\u6709\u89c4\u5219\u6216\u4e0d\u9700\u8981\u788e\u7247\uff08\u5df2\u6ee1\u661f\uff09\r\n        rankUpBtn.SetEnabled(false);\r\n        rankUpBtn.text = "\u65e0\u6cd5\u5347\u661f";\r\n    }\r\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"\u7f51\u7edc\u534f\u8bae",children:"\u7f51\u7edc\u534f\u8bae"}),"\n",(0,d.jsx)(e.h3,{id:"\u5347\u661f\u8bf7\u6c42",children:"\u5347\u661f\u8bf7\u6c42"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class CardUpgradeStarRequest\r\n{\r\n    public string card_id;         // \u5361\u724cID\r\n    public int use_general_crest;  // 0=\u4e0d\u4f7f\u7528, 1=\u4f7f\u7528\u901a\u7528\u788e\u7247\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u5347\u661f\u54cd\u5e94",children:"\u5347\u661f\u54cd\u5e94"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class CardUpgradeStarResponse\r\n{\r\n    public Dictionary<string, int> new_card_star;      // \u65b0\u661f\u7ea7\r\n    public Dictionary<string, long> current_balance;   // \u788e\u7247\u4f59\u989d\r\n}\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u9519\u8bef\u54cd\u5e94",children:"\u9519\u8bef\u54cd\u5e94"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:"[Serializable]\r\npublic class CardUpgradeStarErrorData\r\n{\r\n    public int required_HeroCrest;    // \u9700\u8981\u7684\u788e\u7247\u6570\r\n    public int current_specific;      // \u5f53\u524d\u4e13\u5c5e\u788e\u7247\r\n    public int current_general;       // \u5f53\u524d\u901a\u7528\u788e\u7247\r\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u788e\u7247\u6765\u6e90",children:"\u788e\u7247\u6765\u6e90"}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u6765\u6e90"}),(0,d.jsx)(e.th,{children:"\u83b7\u5f97\u65b9\u5f0f"}),(0,d.jsx)(e.th,{children:"\u788e\u7247\u7c7b\u578b"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.strong,{children:"\u62bd\u5361\u91cd\u590d"})}),(0,d.jsx)(e.td,{children:"\u62bd\u5230\u5df2\u6709\u5361\u724c\u8f6c\u6362\u4e3a\u788e\u7247"}),(0,d.jsx)(e.td,{children:"\u4e13\u5c5e\u788e\u7247"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.strong,{children:"\u6d4b\u8bd5\u83b7\u53d6"})}),(0,d.jsx)(e.td,{children:"test/GetItem\u63a5\u53e3\uff08\u8c03\u8bd5\u7528\uff09"}),(0,d.jsx)(e.td,{children:"\u4e13\u5c5e/\u901a\u7528"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:(0,d.jsx)(e.strong,{children:"\u670d\u52a1\u5668\u5956\u52b1"})}),(0,d.jsx)(e.td,{children:"\u670d\u52a1\u5668\u8fd4\u56de\u7684current_balance"}),(0,d.jsx)(e.td,{children:"\u4e13\u5c5e/\u901a\u7528"})]})]})]}),"\n",(0,d.jsx)(e.h3,{id:"\u6d4b\u8bd5\u83b7\u53d6\u788e\u7247\u4ec5\u5f00\u53d1\u73af\u5883",children:"\u6d4b\u8bd5\u83b7\u53d6\u788e\u7247\uff08\u4ec5\u5f00\u53d1\u73af\u5883\uff09"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-csharp",children:'// GachaPanelController\u4e2d\u7684\u6d4b\u8bd5\u4ee3\u7801\r\nvar req = new GetItemInput\r\n{\r\n    all = 0,\r\n    item_id = new List<string> { \r\n        // S\u7ea7\u788e\u7247\r\n        "HeroCrest_SGeneral",   // S\u7ea7\u901a\u7528\u788e\u7247\r\n        "HeroCrest_S1",         // S1\u4e13\u5c5e\u788e\u7247\r\n        \r\n        // A\u7ea7\u788e\u7247\r\n        "HeroCrest_AGeneral",   // A\u7ea7\u901a\u7528\u788e\u7247\r\n        "HeroCrest_A1",         // A1\u4e13\u5c5e\u788e\u7247\r\n        \r\n        // B\u7ea7\u788e\u7247\r\n        "HeroCrest_BGeneral",   // B\u7ea7\u901a\u7528\u788e\u7247\r\n        "HeroCrest_B1"          // B1\u4e13\u5c5e\u788e\u7247\r\n    },\r\n    amount = 10000\r\n};\r\nMessageHub.I.Request("test/GetItem", req, OnGetItemResp, 8f);\n'})}),"\n",(0,d.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u788e\u7247\u4f18\u5148\u7ea7"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4f18\u5148\u6d88\u8017\u4e13\u5c5e\u788e\u7247"}),"\n",(0,d.jsx)(e.li,{children:"\u901a\u7528\u788e\u7247\u9700\u624b\u52a8\u5f00\u542f\uff08\u901a\u8fc7Toggle\u63a7\u4ef6\uff09"}),"\n",(0,d.jsx)(e.li,{children:"\u4e0d\u540c\u54c1\u8d28\u788e\u7247\u4e0d\u53ef\u6df7\u7528"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6280\u80fd\u7b49\u7ea7"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u4e0e\u661f\u7ea7\u4e25\u683c\u5bf9\u5e94\uff0c\u5b58\u50a8\u5728StarUpgradeRule\u7684skillLvGain\u6570\u7ec4\u4e2d"}),"\n",(0,d.jsx)(e.li,{children:"\u4e0d\u53ef\u72ec\u7acb\u5347\u7ea7"}),"\n",(0,d.jsx)(e.li,{children:"15\u661f\u65f6\u8fbe\u5230\u6700\u9ad8\u7b49\u7ea7[4,4,4]"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"UI\u5237\u65b0"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u5347\u661f\u6210\u529f\u540e\u5237\u65b0\u6240\u6709\u76f8\u5173UI"}),"\n",(0,d.jsx)(e.li,{children:"\u540c\u6b65\u66f4\u65b0\u5e7b\u5f71\u5361\u663e\u793a"}),"\n",(0,d.jsx)(e.li,{children:"\u5e7f\u64adonCardUpdated\u4e8b\u4ef6"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u6570\u636e\u540c\u6b65"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u788e\u7247\u6570\u91cf\u5b58\u50a8\u5728InventoryService\u7684Bag\u6216Shards\u5b57\u5178\u4e2d"}),"\n",(0,d.jsx)(e.li,{children:"\u661f\u7ea7\u5b58\u50a8\u5728PlayerCard"}),"\n",(0,d.jsx)(e.li,{children:"\u670d\u52a1\u5668\u8fd4\u56decurrent_balance\u66f4\u65b0\u788e\u7247\u4f59\u989d"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u5347\u661f\u89c4\u5219\u83b7\u53d6"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\u4f7f\u7528",(0,d.jsx)(e.code,{children:"GetStar(currentStar)"}),"\u83b7\u53d6\u5f53\u524d\u661f\u7ea7\u7684\u89c4\u5219\uff0c\u800c\u4e0d\u662f",(0,d.jsx)(e.code,{children:"GetStar(star+1)"})]}),"\n",(0,d.jsx)(e.li,{children:"15\u661f\u65f6shardsRequired\u4e3a0\uff0c\u8868\u793a\u5df2\u6ee1\u661f"}),"\n"]}),"\n"]}),"\n"]})]})}function u(r={}){const{wrapper:e}={...(0,s.R)(),...r.components};return e?(0,d.jsx)(e,{...r,children:(0,d.jsx)(h,{...r})}):h(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>t,x:()=>i});var l=n(6540);const d={},s=l.createContext(d);function t(r){const e=l.useContext(s);return l.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function i(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(d):r.components||d:t(r.components),l.createElement(s.Provider,{value:e},r.children)}}}]);