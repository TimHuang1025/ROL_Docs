"use strict";(self.webpackChunkgame_docs=self.webpackChunkgame_docs||[]).push([[877],{8402:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"\u5361\u724c/card-gift-system","title":"\u5c01\u8d4f\u7cfb\u7edf","description":"\u7cfb\u7edf\u6982\u8ff0","source":"@site/docs/\u5361\u724c/card-gift-system.md","sourceDirName":"\u5361\u724c","slug":"/\u5361\u724c/card-gift-system","permalink":"/ROL_Docs/docs/\u5361\u724c/card-gift-system","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"card-gift-system","title":"\u5c01\u8d4f\u7cfb\u7edf","sidebar_label":"\u5c01\u8d4f\u7cfb\u7edf","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"\u5347\u7ea7\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/card-upgrade-system"},"next":{"title":"\u5347\u661f\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u5361\u724c/card-star-system"}}');var l=e(4848),t=e(8453);const d={id:"card-gift-system",title:"\u5c01\u8d4f\u7cfb\u7edf",sidebar_label:"\u5c01\u8d4f\u7cfb\u7edf",sidebar_position:4},s="\u5c01\u8d4f\u7cfb\u7edf",a={},c=[{value:"\u7cfb\u7edf\u6982\u8ff0",id:"\u7cfb\u7edf\u6982\u8ff0",level:2},{value:"\u5c01\u8d4f\u7b49\u7ea7",id:"\u5c01\u8d4f\u7b49\u7ea7",level:2},{value:"\u7b49\u7ea7\u5b9a\u4e49",id:"\u7b49\u7ea7\u5b9a\u4e49",level:3},{value:"\u6570\u636e\u7ed3\u6784",id:"\u6570\u636e\u7ed3\u6784",level:3},{value:"\u793c\u7269\u7cfb\u7edf",id:"\u793c\u7269\u7cfb\u7edf",level:2},{value:"\u793c\u7269\u7c7b\u578b\u4e0e\u7ecf\u9a8c\u503c",id:"\u793c\u7269\u7c7b\u578b\u4e0e\u7ecf\u9a8c\u503c",level:3},{value:"\u793c\u7269\u83b7\u53d6\u9014\u5f84",id:"\u793c\u7269\u83b7\u53d6\u9014\u5f84",level:3},{value:"\u88c5\u5907\u69fd\u89e3\u9501\u673a\u5236",id:"\u88c5\u5907\u69fd\u89e3\u9501\u673a\u5236",level:2},{value:"EquipStatus - \u88c5\u5907\u72b6\u6001",id:"equipstatus---\u88c5\u5907\u72b6\u6001",level:3},{value:"\u89e3\u9501\u89c4\u5219",id:"\u89e3\u9501\u89c4\u5219",level:3},{value:"GiftPanel UI\u5b9e\u73b0",id:"giftpanel-ui\u5b9e\u73b0",level:2},{value:"UI\u7ed3\u6784",id:"ui\u7ed3\u6784",level:3},{value:"GiftPanelController - \u4e3b\u63a7\u5236\u5668",id:"giftpanelcontroller---\u4e3b\u63a7\u5236\u5668",level:3},{value:"\u793c\u7269\u9009\u62e9\u903b\u8f91",id:"\u793c\u7269\u9009\u62e9\u903b\u8f91",level:3},{value:"\u8d60\u9001\u6d41\u7a0b",id:"\u8d60\u9001\u6d41\u7a0b",level:3},{value:"UnitGiftLevel - \u7b49\u7ea7\u663e\u793a\u7ec4\u4ef6",id:"unitgiftlevel---\u7b49\u7ea7\u663e\u793a\u7ec4\u4ef6",level:3},{value:"\u7f51\u7edc\u534f\u8bae",id:"\u7f51\u7edc\u534f\u8bae",level:2},{value:"\u8d60\u9001\u793c\u7269\u8bf7\u6c42",id:"\u8d60\u9001\u793c\u7269\u8bf7\u6c42",level:3},{value:"\u8d60\u9001\u793c\u7269\u54cd\u5e94",id:"\u8d60\u9001\u793c\u7269\u54cd\u5e94",level:3},{value:"\u9519\u8bef\u7801",id:"\u9519\u8bef\u7801",level:3},{value:"\u6570\u636e\u540c\u6b65",id:"\u6570\u636e\u540c\u6b65",level:2},{value:"\u670d\u52a1\u5668\u6570\u636e\u66f4\u65b0",id:"\u670d\u52a1\u5668\u6570\u636e\u66f4\u65b0",level:3},{value:"\u7279\u6b8a\u89c4\u5219",id:"\u7279\u6b8a\u89c4\u5219",level:2},{value:"1. \u5e7b\u5f71\u5361\u9650\u5236",id:"1-\u5e7b\u5f71\u5361\u9650\u5236",level:3},{value:"2. \u5e7b\u5f71\u5361\u540c\u6b65",id:"2-\u5e7b\u5f71\u5361\u540c\u6b65",level:3},{value:"3. \u6ee1\u7ea7\u5904\u7406",id:"3-\u6ee1\u7ea7\u5904\u7406",level:3},{value:"UI\u6837\u5f0f",id:"ui\u6837\u5f0f",level:2},{value:"\u88c5\u5907\u69fd\u6837\u5f0f",id:"\u88c5\u5907\u69fd\u6837\u5f0f",level:3},{value:"\u793c\u7269\u5e93\u5b58\u7ba1\u7406",id:"\u793c\u7269\u5e93\u5b58\u7ba1\u7406",level:2},{value:"\u4eceInventoryService\u83b7\u53d6\u793c\u7269",id:"\u4eceinventoryservice\u83b7\u53d6\u793c\u7269",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function o(n){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.header,{children:(0,l.jsx)(r.h1,{id:"\u5c01\u8d4f\u7cfb\u7edf",children:"\u5c01\u8d4f\u7cfb\u7edf"})}),"\n",(0,l.jsx)(r.h2,{id:"\u7cfb\u7edf\u6982\u8ff0",children:"\u7cfb\u7edf\u6982\u8ff0"}),"\n",(0,l.jsx)(r.p,{children:"\u5c01\u8d4f\u7cfb\u7edf\u662f\u5361\u724c\u517b\u6210\u7684\u91cd\u8981\u7ef4\u5ea6\uff0c\u901a\u8fc7\u8d60\u9001\u793c\u7269\u63d0\u5347\u5361\u724c\u7684\u5c01\u8d4f\u7b49\u7ea7\uff080-3\u7ea7\uff09\uff0c\u6bcf\u4e2a\u7b49\u7ea7\u89e3\u9501\u5bf9\u5e94\u7684\u88c5\u5907\u69fd\u4f4d\u3002\u7cfb\u7edf\u652f\u6301\u591a\u79cd\u793c\u7269\u7c7b\u578b\uff0c\u6bcf\u79cd\u793c\u7269\u63d0\u4f9b\u4e0d\u540c\u7684\u7ecf\u9a8c\u503c\u3002"}),"\n",(0,l.jsx)(r.h2,{id:"\u5c01\u8d4f\u7b49\u7ea7",children:"\u5c01\u8d4f\u7b49\u7ea7"}),"\n",(0,l.jsx)(r.h3,{id:"\u7b49\u7ea7\u5b9a\u4e49",children:"\u7b49\u7ea7\u5b9a\u4e49"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"\u7b49\u7ea7"}),(0,l.jsx)(r.th,{children:"\u540d\u79f0"}),(0,l.jsx)(r.th,{children:"\u7d2f\u8ba1\u7ecf\u9a8c\u9608\u503c"}),(0,l.jsx)(r.th,{children:"\u89e3\u9501\u5185\u5bb9"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"0"}),(0,l.jsx)(r.td,{children:"\u672a\u5c01\u8d4f"}),(0,l.jsx)(r.td,{children:"0"}),(0,l.jsx)(r.td,{children:"-"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"1"}),(0,l.jsx)(r.td,{children:"\u62dc\u5c06"}),(0,l.jsx)(r.td,{children:"500"}),(0,l.jsx)(r.td,{children:"\u6b66\u5668\u69fd"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"2"}),(0,l.jsx)(r.td,{children:"\u6388\u7532"}),(0,l.jsx)(r.td,{children:"5500"}),(0,l.jsx)(r.td,{children:"\u62a4\u7532\u69fd"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"3"}),(0,l.jsx)(r.td,{children:"\u8d50\u9a91"}),(0,l.jsx)(r.td,{children:"20500"}),(0,l.jsx)(r.td,{children:"\u5750\u9a91\u69fd"})]})]})]}),"\n",(0,l.jsx)(r.h3,{id:"\u6570\u636e\u7ed3\u6784",children:"\u6570\u636e\u7ed3\u6784"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'// PlayerCard.cs\r\npublic class PlayerCard\r\n{\r\n    // \u5c01\u8d4f\u7cfb\u7edf\r\n    public int giftLv = 0;      // \u5c01\u8d4f\u7b49\u7ea7 0-3\r\n    public int giftExp = 0;     // \u7d2f\u8ba1\u5c01\u8d4f\u7ecf\u9a8c\u503c\r\n    \r\n    // \u88c5\u5907\u69fd\u4f4d\r\n    public EquipStatus equip = new();\r\n    \r\n    // \u8f85\u52a9\u5c5e\u6027\r\n    public string GiftLevelName\r\n    {\r\n        get\r\n        {\r\n            switch (giftLv)\r\n            {\r\n                case 0: return "\u672a\u5c01\u8d4f";\r\n                case 1: return "\u62dc\u5c06";\r\n                case 2: return "\u6388\u7532";\r\n                case 3: return "\u8d50\u9a91";\r\n                default: return "\u5c01\u4faf";\r\n            }\r\n        }\r\n    }\r\n    \r\n    public bool IsMaxGiftLevel => giftLv >= 3;\r\n}\n'})}),"\n",(0,l.jsx)(r.h2,{id:"\u793c\u7269\u7cfb\u7edf",children:"\u793c\u7269\u7cfb\u7edf"}),"\n",(0,l.jsx)(r.h3,{id:"\u793c\u7269\u7c7b\u578b\u4e0e\u7ecf\u9a8c\u503c",children:"\u793c\u7269\u7c7b\u578b\u4e0e\u7ecf\u9a8c\u503c"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'// GiftPanelUI.cs\r\nprivate static readonly Dictionary<string, int> GIFT_VALUES = new Dictionary<string, int>\r\n{\r\n    { "Gift_dessert", 50 },      // \u7cd5\u70b9\r\n    { "Gift_wine", 100 },         // \u7f8e\u9152\r\n    { "Gift_silk", 200 },         // \u4e1d\u7ef8\r\n    { "Gift_sword", 500 },        // \u4f69\u5200\r\n    { "Gift_painting", 1000 },    // \u5b57\u753b\r\n    { "Gift_jade", 1500 },        // \u7389\u77f3\r\n    { "Gift_porcelain", 2000 },   // \u74f7\u5668\r\n    { "Gift_pearl", 2500 },       // \u73cd\u73e0\uff08\u5982\u679c\u6709\uff09\r\n    { "Gift_field", 3000 },       // \u826f\u7530\uff08\u5982\u679c\u6709\uff09\r\n    { "Gift_house", 5000 },       // \u4f4f\u5b85\uff08\u5982\u679c\u6709\uff09\r\n};\n'})}),"\n",(0,l.jsx)(r.h3,{id:"\u793c\u7269\u83b7\u53d6\u9014\u5f84",children:"\u793c\u7269\u83b7\u53d6\u9014\u5f84"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"\u6765\u6e90"}),(0,l.jsx)(r.th,{children:"\u8bf4\u660e"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"\u5546\u5e97\u8d2d\u4e70"})}),(0,l.jsx)(r.td,{children:"\u4f7f\u7528\u8d44\u6e90\u8d2d\u4e70\u793c\u7269"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"\u4efb\u52a1\u5956\u52b1"})}),(0,l.jsx)(r.td,{children:"\u5b8c\u6210\u4efb\u52a1\u83b7\u5f97"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"\u6d3b\u52a8\u5956\u52b1"})}),(0,l.jsx)(r.td,{children:"\u53c2\u4e0e\u6d3b\u52a8\u83b7\u5f97"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"\u6d4b\u8bd5\u83b7\u53d6"})}),(0,l.jsx)(r.td,{children:"test/GetItem\u63a5\u53e3\uff08\u4ec5\u5f00\u53d1\u73af\u5883\uff09"})]})]})]}),"\n",(0,l.jsx)(r.h2,{id:"\u88c5\u5907\u69fd\u89e3\u9501\u673a\u5236",children:"\u88c5\u5907\u69fd\u89e3\u9501\u673a\u5236"}),"\n",(0,l.jsx)(r.h3,{id:"equipstatus---\u88c5\u5907\u72b6\u6001",children:"EquipStatus - \u88c5\u5907\u72b6\u6001"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'[Serializable]\r\npublic class EquipStatus\r\n{\r\n    // \u88c5\u5907UUID\r\n    public string weaponUuid = "";      // \u6b66\u5668\u7684UUID\r\n    public string armorUuid = "";       // \u62a4\u7532\u7684UUID\r\n    public string accessoryUuid = "";   // \u5750\u9a91\u7684UUID\r\n    \r\n    // \u69fd\u4f4d\u89e3\u9501\u72b6\u6001\r\n    public bool weaponUnlocked = false;   // \u6b66\u5668\u69fd\u662f\u5426\u89e3\u9501\uff08\u5c01\u8d4f1\u7ea7\uff09\r\n    public bool armorUnlocked = false;    // \u62a4\u7532\u69fd\u662f\u5426\u89e3\u9501\uff08\u5c01\u8d4f2\u7ea7\uff09\r\n    public bool mountUnlocked = false;    // \u5750\u9a91\u69fd\u662f\u5426\u89e3\u9501\uff08\u5c01\u8d4f3\u7ea7\uff09\r\n    \r\n    // \u6839\u636e\u5c01\u8d4f\u7b49\u7ea7\u66f4\u65b0\u69fd\u4f4d\u89e3\u9501\u72b6\u6001\r\n    public void UpdateUnlockStatus(int giftLevel)\r\n    {\r\n        weaponUnlocked = giftLevel >= 1;\r\n        armorUnlocked = giftLevel >= 2;\r\n        mountUnlocked = giftLevel >= 3;\r\n    }\r\n}\n'})}),"\n",(0,l.jsx)(r.h3,{id:"\u89e3\u9501\u89c4\u5219",children:"\u89e3\u9501\u89c4\u5219"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'// PlayerCardBankMgr.cs\r\npublic void AddGiftExp(string id, int exp)\r\n{\r\n    var pc = PlayerCardBank.I.Get(id);\r\n    if (pc == null || exp <= 0) return;\r\n    \r\n    // \u5e7b\u5f71\u5361\u4e0d\u80fd\u5347\u7ea7\u793c\u7269\r\n    if (pc.isPhantom)\r\n    {\r\n        Debug.LogWarning($"Cannot add gift exp to phantom card {id}");\r\n        return;\r\n    }\r\n    \r\n    // \u6dfb\u52a0\u7ecf\u9a8c\u503c\uff08\u7d2f\u52a0\u5230\u603b\u8fdb\u5ea6\uff09\r\n    int oldExp = pc.giftExp;\r\n    pc.giftExp += exp;\r\n    \r\n    // \u6839\u636e\u603b\u8fdb\u5ea6\u8ba1\u7b97\u65b0\u7b49\u7ea7\r\n    int oldLevel = pc.giftLv;\r\n    pc.giftLv = CalculateGiftLevelFromProgress(pc.giftExp);\r\n    \r\n    // \u9650\u5236\u6700\u9ad8\u7b49\u7ea7\r\n    if (pc.giftLv > 3) pc.giftLv = 3;\r\n    \r\n    // \u5982\u679c\u7b49\u7ea7\u63d0\u5347\u4e86\uff0c\u66f4\u65b0\u88c5\u5907\u69fd\u89e3\u9501\u72b6\u6001\r\n    if (pc.giftLv != oldLevel)\r\n    {\r\n        pc.equip.weaponUnlocked = pc.giftLv >= 1;  // 1\u7ea7\u89e3\u9501\u6b66\u5668\r\n        pc.equip.armorUnlocked = pc.giftLv >= 2;   // 2\u7ea7\u89e3\u9501\u62a4\u7532\r\n        pc.equip.mountUnlocked = pc.giftLv >= 3;   // 3\u7ea7\u89e3\u9501\u5750\u9a91\r\n    }\r\n    \r\n    // \u89e6\u53d1\u66f4\u65b0\u4e8b\u4ef6\r\n    NotifyUpdated(id);\r\n}\r\n\r\n// \u6839\u636e\u603b\u8fdb\u5ea6\u8ba1\u7b97\u7b49\u7ea7\r\nprivate int CalculateGiftLevelFromProgress(int totalProgress)\r\n{\r\n    if (totalProgress >= 20500) return 3;\r\n    if (totalProgress >= 5500) return 2;\r\n    if (totalProgress >= 500) return 1;\r\n    return 0;\r\n}\n'})}),"\n",(0,l.jsx)(r.h2,{id:"giftpanel-ui\u5b9e\u73b0",children:"GiftPanel UI\u5b9e\u73b0"}),"\n",(0,l.jsx)(r.h3,{id:"ui\u7ed3\u6784",children:"UI\u7ed3\u6784"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:'GiftPanel/\r\n\u251c\u2500\u2500 GiftTitle              # \u6807\u9898\u680f\r\n\u2502   \u251c\u2500\u2500 ClosePanel        # \u5173\u95ed\u6309\u94ae\r\n\u2502   \u2514\u2500\u2500 Title             # "\u8d4f\u8d50"\u6807\u9898\r\n\u251c\u2500\u2500 HeroGiftInfo          # \u82f1\u96c4\u793c\u7269\u4fe1\u606f\r\n\u2502   \u251c\u2500\u2500 HeroGiftLv        # \u5f53\u524d\u7b49\u7ea7\u663e\u793a\r\n\u2502   \u2514\u2500\u2500 HeroGiftProgress  # \u7ecf\u9a8c\u8fdb\u5ea6\u6761\r\n\u251c\u2500\u2500 GiftList              # \u793c\u7269\u5217\u8868\uff08ScrollViewPro\uff09\r\n\u2502   \u2514\u2500\u2500 GiftOption[]      # \u793c\u7269\u9009\u9879\r\n\u2502       \u251c\u2500\u2500 GiftIcon      # \u793c\u7269\u56fe\u6807\r\n\u2502       \u251c\u2500\u2500 GiftName      # \u793c\u7269\u540d\u79f0\r\n\u2502       \u251c\u2500\u2500 GiftValue     # \u7ecf\u9a8c\u503c\r\n\u2502       \u2514\u2500\u2500 GiftStock     # \u5e93\u5b58\u6570\u91cf\r\n\u251c\u2500\u2500 EquipSlots            # \u88c5\u5907\u69fd\u4f4d\u663e\u793a\r\n\u2502   \u251c\u2500\u2500 weaponslot        # \u6b66\u5668\u69fd\r\n\u2502   \u251c\u2500\u2500 armorslot         # \u62a4\u7532\u69fd\r\n\u2502   \u2514\u2500\u2500 horseslot         # \u5750\u9a91\u69fd\r\n\u2514\u2500\u2500 SendGiftBtn           # \u8d60\u9001\u6309\u94ae\n'})}),"\n",(0,l.jsx)(r.h3,{id:"giftpanelcontroller---\u4e3b\u63a7\u5236\u5668",children:"GiftPanelController - \u4e3b\u63a7\u5236\u5668"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'public class GiftPanelController : MonoBehaviour, IUIPanelController\r\n{\r\n    // \u6570\u636e\u5f15\u7528\r\n    CardInfoStatic info;      // \u9759\u6001\u4fe1\u606f\r\n    PlayerCard dyn;           // \u52a8\u6001\u4fe1\u606f\r\n    \r\n    // UI\u7ec4\u4ef6\r\n    [SerializeField] private UnitGiftLevel giftLevelUI;\r\n    [SerializeField] private VisualTreeAsset giftOptionTpl;\r\n    [SerializeField] private string optionContainerName = "GiftList";\r\n    \r\n    // \u8fd0\u884c\u65f6\u72b6\u6001\r\n    private ScrollViewPro optionContainer;\r\n    private readonly List<Entry> entries = new();\r\n    private Entry selectedEntry;\r\n    private int sendCount = 1;\r\n    \r\n    // \u6392\u5e8f\u6a21\u5f0f\r\n    private enum SortMode { StockDesc, ValueDesc }\r\n    private SortMode currentSort = SortMode.StockDesc;\r\n}\n'})}),"\n",(0,l.jsx)(r.h3,{id:"\u793c\u7269\u9009\u62e9\u903b\u8f91",children:"\u793c\u7269\u9009\u62e9\u903b\u8f91"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'void OnSelectGift(Entry e)\r\n{\r\n    if (e == selectedEntry) return;\r\n    \r\n    // \u53d6\u6d88\u4e4b\u524d\u7684\u9009\u4e2d\r\n    if (selectedEntry != null)\r\n    {\r\n        selectedEntry.root.RemoveFromClassList("item-slot-selected");\r\n        selectedEntry.root.style.backgroundColor = new Color(201/255f, 184/255f, 162/255f, 1f);\r\n        selectedEntry.root.style.borderLeftWidth = 0;\r\n    }\r\n    \r\n    // \u8bbe\u7f6e\u65b0\u7684\u9009\u4e2d\r\n    selectedEntry = e;\r\n    sendCount = 1;\r\n    \r\n    // \u6dfb\u52a0\u9009\u4e2d\u6837\u5f0f\r\n    e.root.AddToClassList("item-slot-selected");\r\n    e.root.style.backgroundColor = new Color(185/255f, 168/255f, 146/255f, 1f);\r\n    e.root.style.borderLeftWidth = 10;\r\n    e.root.style.borderLeftColor = new Color(139/255f, 111/255f, 78/255f, 1f);\r\n}\n'})}),"\n",(0,l.jsx)(r.h3,{id:"\u8d60\u9001\u6d41\u7a0b",children:"\u8d60\u9001\u6d41\u7a0b"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'void OnConfirmGift()\r\n{\r\n    // 1. \u68c0\u67e5\u6761\u4ef6\r\n    if (selectedEntry == null || selectedEntry.data.stock < sendCount)\r\n    {\r\n        PopupManager.Show("\u63d0\u793a", "\u8bf7\u9009\u62e9\u793c\u7269\u6216\u5e93\u5b58\u4e0d\u8db3");\r\n        return;\r\n    }\r\n    \r\n    // 2. \u68c0\u67e5\u5e7b\u5f71\u5361\r\n    if (dyn.isPhantom)\r\n    {\r\n        PopupManager.Show("\u63d0\u793a", "\u5e7b\u5f71\u5361\u65e0\u6cd5\u63a5\u53d7\u5c01\u8d4f");\r\n        return;\r\n    }\r\n    \r\n    // 3. \u6784\u5efa\u8bf7\u6c42\r\n    var requestData = new GiftRequest\r\n    {\r\n        card_id = dyn.id,\r\n        gift_item_id = selectedEntry.itemId,\r\n        amount = sendCount\r\n    };\r\n    \r\n    // 4. \u53d1\u9001\u8bf7\u6c42\r\n    MessageHub.I.Request("card/give_gift", requestData, OnGiftResponse, 10f);\r\n}\n'})}),"\n",(0,l.jsx)(r.h3,{id:"unitgiftlevel---\u7b49\u7ea7\u663e\u793a\u7ec4\u4ef6",children:"UnitGiftLevel - \u7b49\u7ea7\u663e\u793a\u7ec4\u4ef6"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'public class UnitGiftLevel : MonoBehaviour\r\n{\r\n    // \u6570\u636e\r\n    private CardInfoStatic info;\r\n    private PlayerCard dyn;\r\n    \r\n    // UI\u5143\u7d20\r\n    Label levelLabel;            // \u7b49\u7ea7\u6587\u5b57\r\n    ProgressBar expBar;          // \u7ecf\u9a8c\u6761\r\n    VisualElement weaponslot;    // \u6b66\u5668\u69fd\r\n    VisualElement armorslot;     // \u62a4\u7532\u69fd\r\n    VisualElement horseslot;     // \u5750\u9a91\u69fd\r\n    \r\n    // \u5e38\u91cf\u8868\r\n    public static readonly int[] Need = { 0, 500, 5500, 20500 };\r\n    public static readonly string[] LvTxt = { "", "\u62dc\u5c06", "\u6388\u7532", "\u8d50\u9a91", "\u5c01\u4faf" };\r\n    \r\n    public void RefreshUI()\r\n    {\r\n        int lv = dyn?.giftLv ?? 0;\r\n        int exp = dyn?.giftExp ?? 0;\r\n        \r\n        // \u7b49\u7ea7\u6587\u5b57\r\n        levelLabel.text = lv > 0 && lv < LvTxt.Length ? LvTxt[lv] : "\u672a\u5c01\u8d4f";\r\n        \r\n        // \u7ecf\u9a8c\u6761\u767e\u5206\u6bd4\u8ba1\u7b97\r\n        float pct = 0f;\r\n        if (lv >= 3)  // \u6ee1\u7ea7\r\n        {\r\n            pct = 1f;\r\n        }\r\n        else if (lv == 0)\r\n        {\r\n            pct = (float)exp / Need[1];\r\n        }\r\n        else\r\n        {\r\n            int prevThreshold = Need[lv];\r\n            int nextThreshold = Need[lv + 1];\r\n            int levelRange = nextThreshold - prevThreshold;\r\n            pct = (float)(exp - prevThreshold) / levelRange;\r\n        }\r\n        \r\n        expBar.value = pct * 100f;\r\n        expBar.title = lv >= 3 ? "MAX" : $"{exp - Need[lv]}/{Need[lv + 1] - Need[lv]}";\r\n        \r\n        // \u5237\u65b0\u88c5\u5907\u69fd\r\n        RefreshEquipSlots();\r\n    }\r\n    \r\n    public void RefreshEquipSlots()\r\n    {\r\n        int lv = dyn?.giftLv ?? 0;\r\n        \r\n        // \u5e7b\u5f71\u5361\u4f7f\u7528\u590d\u5236\u76ee\u6807\u7684\u5c01\u8d4f\u7b49\u7ea7\r\n        if (dyn.isPhantom && !string.IsNullOrEmpty(dyn.cloneOn))\r\n        {\r\n            var cloneTarget = PlayerCardBank.I.Get(dyn.cloneOn);\r\n            if (cloneTarget != null) lv = cloneTarget.giftLv;\r\n        }\r\n        \r\n        // \u6839\u636e\u7b49\u7ea7\u89e3\u9501\u69fd\u4f4d\r\n        SetSlotLocked(weaponslot, lv < 1);\r\n        SetSlotLocked(armorslot, lv < 2);\r\n        SetSlotLocked(horseslot, lv < 3);\r\n    }\r\n}\n'})}),"\n",(0,l.jsx)(r.h2,{id:"\u7f51\u7edc\u534f\u8bae",children:"\u7f51\u7edc\u534f\u8bae"}),"\n",(0,l.jsx)(r.h3,{id:"\u8d60\u9001\u793c\u7269\u8bf7\u6c42",children:"\u8d60\u9001\u793c\u7269\u8bf7\u6c42"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:"[Serializable]\r\npublic class GiftRequest\r\n{\r\n    public string card_id;        // \u5361\u724cID\r\n    public string gift_item_id;   // \u793c\u7269\u9053\u5177ID\r\n    public int amount;            // \u8d60\u9001\u6570\u91cf\r\n}\n"})}),"\n",(0,l.jsx)(r.h3,{id:"\u8d60\u9001\u793c\u7269\u54cd\u5e94",children:"\u8d60\u9001\u793c\u7269\u54cd\u5e94"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:"[Serializable]\r\npublic class GiftResponseData\r\n{\r\n    public Dictionary<string, int> card_gift_level;      // \u65b0\u7684\u5c01\u8d4f\u7b49\u7ea7\r\n    public Dictionary<string, int> card_gift_progress;   // \u65b0\u7684\u5c01\u8d4f\u8fdb\u5ea6\r\n    public Dictionary<string, long> current_balance;     // \u7269\u54c1\u4f59\u989d\u66f4\u65b0\r\n}\n"})}),"\n",(0,l.jsx)(r.h3,{id:"\u9519\u8bef\u7801",children:"\u9519\u8bef\u7801"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"\u9519\u8bef\u7801"}),(0,l.jsx)(r.th,{children:"\u8bf4\u660e"}),(0,l.jsx)(r.th,{children:"\u5904\u7406\u65b9\u5f0f"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"400"}),(0,l.jsx)(r.td,{children:"\u53c2\u6570\u9519\u8bef"}),(0,l.jsx)(r.td,{children:"\u663e\u793a\u9519\u8bef\u63d0\u793a"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"401"}),(0,l.jsx)(r.td,{children:"\u672a\u8ba4\u8bc1"}),(0,l.jsx)(r.td,{children:"\u63d0\u793a\u91cd\u65b0\u767b\u5f55"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"402"}),(0,l.jsx)(r.td,{children:"\u7269\u54c1\u4e0d\u8db3"}),(0,l.jsx)(r.td,{children:"\u663e\u793a\u6240\u9700\u548c\u5f53\u524d\u6570\u91cf"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"403"}),(0,l.jsx)(r.td,{children:"\u7b49\u7ea7\u5df2\u6ee1"}),(0,l.jsx)(r.td,{children:"\u63d0\u793a\u5c01\u8d4f\u7b49\u7ea7\u5df2\u8fbe\u4e0a\u9650"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"404"}),(0,l.jsx)(r.td,{children:"\u5361\u724c\u4e0d\u5b58\u5728\u6216\u662f\u5e7b\u5f71\u5361"}),(0,l.jsx)(r.td,{children:"\u63d0\u793a\u65e0\u6cd5\u8d60\u9001"})]})]})]}),"\n",(0,l.jsx)(r.h2,{id:"\u6570\u636e\u540c\u6b65",children:"\u6570\u636e\u540c\u6b65"}),"\n",(0,l.jsx)(r.h3,{id:"\u670d\u52a1\u5668\u6570\u636e\u66f4\u65b0",children:"\u670d\u52a1\u5668\u6570\u636e\u66f4\u65b0"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'void ProcessGiftSuccess(GiftResponseData data)\r\n{\r\n    // 1. \u66f4\u65b0\u5361\u7247\u7684\u5c01\u8d4f\u7b49\u7ea7\u548c\u8fdb\u5ea6\r\n    if (data.card_gift_level != null && data.card_gift_progress != null)\r\n    {\r\n        foreach (var kvp in data.card_gift_level)\r\n        {\r\n            string cardId = kvp.Key;\r\n            int newLevel = kvp.Value;\r\n            int newProgress = data.card_gift_progress.ContainsKey(cardId) \r\n                ? data.card_gift_progress[cardId] : 0;\r\n            \r\n            // \u4f7f\u7528CardService\u66f4\u65b0\r\n            if (CardService.I != null)\r\n            {\r\n                CardService.I.UpdateCardGiftLevel(cardId, newLevel, newProgress);\r\n            }\r\n            else\r\n            {\r\n                // \u76f4\u63a5\u66f4\u65b0PlayerCardBank\r\n                var card = PlayerCardBank.I?.Get(cardId);\r\n                if (card != null)\r\n                {\r\n                    card.giftLv = newLevel;\r\n                    card.giftExp = newProgress;\r\n                    \r\n                    // \u66f4\u65b0\u88c5\u5907\u69fd\u89e3\u9501\u72b6\u6001\r\n                    card.equip.weaponUnlocked = newLevel >= 1;\r\n                    card.equip.armorUnlocked = newLevel >= 2;\r\n                    card.equip.mountUnlocked = newLevel >= 3;\r\n                    \r\n                    PlayerCardBankMgr.I.BroadcastCardUpdated(cardId);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    // 2. \u66f4\u65b0\u7269\u54c1\u4f59\u989d\r\n    if (data.current_balance != null)\r\n    {\r\n        var updates = new Dictionary<string, long>();\r\n        foreach (var kvp in data.current_balance)\r\n        {\r\n            updates[kvp.Key] = kvp.Value;\r\n        }\r\n        InventoryService.I?.UpdateFromCurrentBalance(updates, "gift_given");\r\n    }\r\n}\n'})}),"\n",(0,l.jsx)(r.h2,{id:"\u7279\u6b8a\u89c4\u5219",children:"\u7279\u6b8a\u89c4\u5219"}),"\n",(0,l.jsx)(r.h3,{id:"1-\u5e7b\u5f71\u5361\u9650\u5236",children:"1. \u5e7b\u5f71\u5361\u9650\u5236"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'// \u5e7b\u5f71\u5361\u4e0d\u80fd\u63a5\u53d7\u5c01\u8d4f\r\nif (pc.isPhantom)\r\n{\r\n    Debug.LogWarning($"Cannot add gift exp to phantom card {id}");\r\n    return;\r\n}\n'})}),"\n",(0,l.jsx)(r.h3,{id:"2-\u5e7b\u5f71\u5361\u540c\u6b65",children:"2. \u5e7b\u5f71\u5361\u540c\u6b65"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:"// \u5982\u679c\u6709\u5e7b\u5f71\u5361\u590d\u5236\u4e86\u8fd9\u5f20\u5361\uff0c\u540c\u6b65\u66f4\u65b0\u5e7b\u5f71\u5361\r\nif (!string.IsNullOrEmpty(pc.clonedBy))\r\n{\r\n    var phantomCard = PlayerCardBank.I.Get(pc.clonedBy);\r\n    if (phantomCard != null && phantomCard.isPhantom)\r\n    {\r\n        phantomCard.giftLv = pc.giftLv;\r\n        phantomCard.giftExp = pc.giftExp;\r\n        phantomCard.equip.weaponUnlocked = pc.equip.weaponUnlocked;\r\n        phantomCard.equip.armorUnlocked = pc.equip.armorUnlocked;\r\n        phantomCard.equip.mountUnlocked = pc.equip.mountUnlocked;\r\n        \r\n        NotifyUpdated(pc.clonedBy);\r\n    }\r\n}\n"})}),"\n",(0,l.jsx)(r.h3,{id:"3-\u6ee1\u7ea7\u5904\u7406",children:"3. \u6ee1\u7ea7\u5904\u7406"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:'void CheckMaxGiftLevel()\r\n{\r\n    if (dyn.giftLv >= 3)\r\n    {\r\n        // \u6ee1\u7ea7\u540e\u7684UI\u5904\u7406\r\n        confirmBtn.SetEnabled(false);\r\n        confirmBtn.text = "\u5df2\u6ee1\u7ea7";\r\n        expBar.title = "MAX";\r\n        expBar.value = 100f;\r\n    }\r\n}\n'})}),"\n",(0,l.jsx)(r.h2,{id:"ui\u6837\u5f0f",children:"UI\u6837\u5f0f"}),"\n",(0,l.jsx)(r.h3,{id:"\u88c5\u5907\u69fd\u6837\u5f0f",children:"\u88c5\u5907\u69fd\u6837\u5f0f"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-css",children:"/* \u672a\u89e3\u9501\u72b6\u6001 */\r\n.locked {\r\n    opacity: 0.3;\r\n    -unity-background-image-tint-color: rgba(100, 100, 100, 0.5);\r\n}\r\n\r\n/* \u5df2\u89e3\u9501\u72b6\u6001 */\r\n.unlocked {\r\n    opacity: 1;\r\n    -unity-background-image-tint-color: white;\r\n}\r\n\r\n/* \u9009\u4e2d\u7684\u793c\u7269\u9879 */\r\n.item-slot-selected {\r\n    background-color: rgba(185, 168, 146, 1);\r\n    border-left-width: 10px;\r\n    border-left-color: rgba(139, 111, 78, 1);\r\n}\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u793c\u7269\u5e93\u5b58\u7ba1\u7406",children:"\u793c\u7269\u5e93\u5b58\u7ba1\u7406"}),"\n",(0,l.jsx)(r.h3,{id:"\u4eceinventoryservice\u83b7\u53d6\u793c\u7269",children:"\u4eceInventoryService\u83b7\u53d6\u793c\u7269"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-csharp",children:"private List<GiftData> GetGiftItemsFromInventory()\r\n{\r\n    var giftItems = new List<GiftData>();\r\n    \r\n    var itemDB = Game.Data.ItemDatabaseStatic.Instance;\r\n    if (itemDB == null || InventoryService.I == null) return giftItems;\r\n    \r\n    foreach (var kvp in GIFT_VALUES)\r\n    {\r\n        string itemId = kvp.Key;\r\n        int value = kvp.Value;\r\n        \r\n        // \u4ece\u5e93\u5b58\u670d\u52a1\u83b7\u53d6\u6570\u91cf\r\n        long stock = InventoryService.I.GetItemCount(itemId);\r\n        \r\n        // \u4ece\u7269\u54c1\u6570\u636e\u5e93\u83b7\u53d6\u663e\u793a\u4fe1\u606f\r\n        var itemInfo = itemDB.Get(itemId);\r\n        if (itemInfo == null) continue;\r\n        \r\n        var giftData = new GiftData\r\n        {\r\n            name = itemInfo.itemName,\r\n            icon = itemInfo.icon,\r\n            value = value,\r\n            stock = (int)stock\r\n        };\r\n        \r\n        giftItems.Add(giftData);\r\n    }\r\n    \r\n    return giftItems;\r\n}\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"\u7ecf\u9a8c\u8ba1\u7b97"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f7f\u7528\u7d2f\u8ba1\u7ecf\u9a8c\u503c\uff0c\u800c\u975e\u5f53\u524d\u7b49\u7ea7\u7ecf\u9a8c"}),"\n",(0,l.jsx)(r.li,{children:"\u670d\u52a1\u5668\u8fd4\u56de\u7684\u662f\u603b\u8fdb\u5ea6\u503c\uff0c\u4e0d\u662f\u589e\u91cf"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"\u88c5\u5907\u69fd\u89e3\u9501"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5c01\u8d4f\u7b49\u7ea7\u63d0\u5347\u65f6\u81ea\u52a8\u89e3\u9501\u5bf9\u5e94\u69fd\u4f4d"}),"\n",(0,l.jsx)(r.li,{children:"\u5e7b\u5f71\u5361\u663e\u793a\u590d\u5236\u76ee\u6807\u7684\u89e3\u9501\u72b6\u6001"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"\u793c\u7269\u5e93\u5b58"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b9e\u65f6\u4eceInventoryService\u83b7\u53d6"}),"\n",(0,l.jsx)(r.li,{children:"\u5e93\u5b58\u4e0d\u8db3\u65f6\u6309\u94ae\u7981\u7528\u6216\u663e\u793a\u906e\u7f69"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"UI\u5237\u65b0\u65f6\u673a"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8d60\u9001\u6210\u529f\u540e\u7acb\u5373\u5237\u65b0"}),"\n",(0,l.jsx)(r.li,{children:"\u76d1\u542conCardUpdated\u4e8b\u4ef6"}),"\n",(0,l.jsx)(r.li,{children:"\u5207\u6362\u5361\u724c\u65f6\u91cd\u65b0\u52a0\u8f7d"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"\u9519\u8bef\u5904\u7406"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25\u91cd\u8bd5\u673a\u5236"}),"\n",(0,l.jsx)(r.li,{children:"\u8be6\u7ec6\u7684\u9519\u8bef\u7801\u5904\u7406"}),"\n",(0,l.jsx)(r.li,{children:"\u53cb\u597d\u7684\u9519\u8bef\u63d0\u793a"}),"\n"]}),"\n"]}),"\n"]})]})}function h(n={}){const{wrapper:r}={...(0,t.R)(),...n.components};return r?(0,l.jsx)(r,{...n,children:(0,l.jsx)(o,{...n})}):o(n)}},8453:(n,r,e)=>{e.d(r,{R:()=>d,x:()=>s});var i=e(6540);const l={},t=i.createContext(l);function d(n){const r=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function s(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:d(n.components),i.createElement(t.Provider,{value:r},n.children)}}}]);