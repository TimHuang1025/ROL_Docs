"use strict";(self.webpackChunkgame_docs=self.webpackChunkgame_docs||[]).push([[42],{1465:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>t,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"\u767b\u5f55/third-party-login","title":"\u7b2c\u4e09\u65b9\u767b\u5f55","description":"\u529f\u80fd\u6982\u8ff0","source":"@site/docs/\u767b\u5f55/third-party-login.md","sourceDirName":"\u767b\u5f55","slug":"/\u767b\u5f55/third-party-login","permalink":"/ROL_Docs/docs/\u767b\u5f55/third-party-login","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"third-party-login","title":"\u7b2c\u4e09\u65b9\u767b\u5f55","sidebar_label":"\u7b2c\u4e09\u65b9\u767b\u5f55","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"\u6e38\u5ba2\u767b\u5f55","permalink":"/ROL_Docs/docs/\u767b\u5f55/visitor-login"},"next":{"title":"\u90ae\u7bb1\u9a8c\u8bc1\u7cfb\u7edf","permalink":"/ROL_Docs/docs/\u767b\u5f55/email-verification"}}');var l=r(4848),s=r(8453);const o={id:"third-party-login",title:"\u7b2c\u4e09\u65b9\u767b\u5f55",sidebar_label:"\u7b2c\u4e09\u65b9\u767b\u5f55",sidebar_position:5},t="\u7b2c\u4e09\u65b9\u767b\u5f55",a={},d=[{value:"\u529f\u80fd\u6982\u8ff0",id:"\u529f\u80fd\u6982\u8ff0",level:2},{value:"Google\u767b\u5f55",id:"google\u767b\u5f55",level:2},{value:"\u5b9e\u73b0\u6587\u4ef6",id:"\u5b9e\u73b0\u6587\u4ef6",level:3},{value:"\u5b8c\u6574\u5b9e\u73b0\u4ee3\u7801",id:"\u5b8c\u6574\u5b9e\u73b0\u4ee3\u7801",level:3},{value:"Google\u767b\u5f55\u6d41\u7a0b",id:"google\u767b\u5f55\u6d41\u7a0b",level:3},{value:"API\u63a5\u53e3",id:"api\u63a5\u53e3",level:3},{value:"Apple\u767b\u5f55",id:"apple\u767b\u5f55",level:2},{value:"\u5b9e\u73b0\u6587\u4ef6",id:"\u5b9e\u73b0\u6587\u4ef6-1",level:3},{value:"\u5b8c\u6574\u5b9e\u73b0\u4ee3\u7801",id:"\u5b8c\u6574\u5b9e\u73b0\u4ee3\u7801-1",level:3},{value:"Apple\u767b\u5f55\u6d41\u7a0b",id:"apple\u767b\u5f55\u6d41\u7a0b",level:3},{value:"API\u63a5\u53e3",id:"api\u63a5\u53e3-1",level:3},{value:"UI\u96c6\u6210",id:"ui\u96c6\u6210",level:2},{value:"\u6309\u94ae\u6837\u5f0f",id:"\u6309\u94ae\u6837\u5f0f",level:3},{value:"UI\u67e5\u627e\u673a\u5236",id:"ui\u67e5\u627e\u673a\u5236",level:3},{value:"\u6280\u672f\u7ec6\u8282",id:"\u6280\u672f\u7ec6\u8282",level:2},{value:"Token\u63d0\u53d6\uff08Google\uff09",id:"token\u63d0\u53d6google",level:3},{value:"\u5e73\u53f0\u68c0\u67e5\uff08Apple\uff09",id:"\u5e73\u53f0\u68c0\u67e5apple",level:3},{value:"\u6309\u94ae\u72b6\u6001\u7ba1\u7406",id:"\u6309\u94ae\u72b6\u6001\u7ba1\u7406",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:2},{value:"Google\u9519\u8bef\u5904\u7406",id:"google\u9519\u8bef\u5904\u7406",level:3},{value:"\u9519\u8bef\u7c7b\u578b",id:"\u9519\u8bef\u7c7b\u578b",level:3},{value:"\u4f1a\u8bdd\u7ba1\u7406",id:"\u4f1a\u8bdd\u7ba1\u7406",level:2},{value:"\u670d\u52a1\u5668\u4ea4\u4e92",id:"\u670d\u52a1\u5668\u4ea4\u4e92",level:2},{value:"\u8bf7\u6c42\u683c\u5f0f",id:"\u8bf7\u6c42\u683c\u5f0f",level:3},{value:"\u54cd\u5e94\u683c\u5f0f",id:"\u54cd\u5e94\u683c\u5f0f",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"Google\u767b\u5f55",id:"google\u767b\u5f55-1",level:3},{value:"Apple\u767b\u5f55",id:"apple\u767b\u5f55-1",level:3},{value:"\u6d4b\u8bd5\u8981\u70b9",id:"\u6d4b\u8bd5\u8981\u70b9",level:2},{value:"\u529f\u80fd\u6d4b\u8bd5",id:"\u529f\u80fd\u6d4b\u8bd5",level:3},{value:"\u517c\u5bb9\u6027\u6d4b\u8bd5",id:"\u517c\u5bb9\u6027\u6d4b\u8bd5",level:3},{value:"\u6027\u80fd\u6d4b\u8bd5",id:"\u6027\u80fd\u6d4b\u8bd5",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"Q: \u4e3a\u4ec0\u4e48\u4f7f\u7528\u53cd\u5c04\u63d0\u53d6Token\uff1f",id:"q-\u4e3a\u4ec0\u4e48\u4f7f\u7528\u53cd\u5c04\u63d0\u53d6token",level:3},{value:"Q: Apple\u767b\u5f55\u4e3a\u4ec0\u4e48\u8981\u9690\u85cf\u5bb9\u5668\uff1f",id:"q-apple\u767b\u5f55\u4e3a\u4ec0\u4e48\u8981\u9690\u85cf\u5bb9\u5668",level:3},{value:"Q: \u4e3a\u4ec0\u4e48Google\u6bcf\u6b21\u90fd\u8981SignOut\uff1f",id:"q-\u4e3a\u4ec0\u4e48google\u6bcf\u6b21\u90fd\u8981signout",level:3}];function c(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"\u7b2c\u4e09\u65b9\u767b\u5f55",children:"\u7b2c\u4e09\u65b9\u767b\u5f55"})}),"\n",(0,l.jsx)(e.h2,{id:"\u529f\u80fd\u6982\u8ff0",children:"\u529f\u80fd\u6982\u8ff0"}),"\n",(0,l.jsx)(e.p,{children:"\u6e38\u620f\u652f\u6301Google\u548cApple\u4e24\u79cd\u7b2c\u4e09\u65b9\u767b\u5f55\u65b9\u5f0f\uff0c\u8ba9\u73a9\u5bb6\u53ef\u4ee5\u4f7f\u7528\u5df2\u6709\u8d26\u53f7\u5feb\u901f\u767b\u5f55\u6e38\u620f\u3002"}),"\n",(0,l.jsx)(e.h2,{id:"google\u767b\u5f55",children:"Google\u767b\u5f55"}),"\n",(0,l.jsx)(e.h3,{id:"\u5b9e\u73b0\u6587\u4ef6",children:"\u5b9e\u73b0\u6587\u4ef6"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Assets/Scripts/Network/LoginInScreen/\r\n\u251c\u2500\u2500 GoogleLoginRequest.cs    # Google\u767b\u5f55\u903b\u8f91\r\n\u2514\u2500\u2500 AuthAPI.cs              # API\u63a5\u53e3\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u5b8c\u6574\u5b9e\u73b0\u4ee3\u7801",children:"\u5b8c\u6574\u5b9e\u73b0\u4ee3\u7801"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",metastring:'title="GoogleLoginRequest.cs"',children:'/******************************************************\r\n * GoogleLoginRequest.cs \u2014 UI Toolkit \u7248 Google \u767b\u5f55\r\n *****************************************************/\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing System.Reflection;\r\nusing UnityEngine;\r\nusing UnityEngine.SceneManagement;\r\nusing UnityEngine.UIElements;\r\nusing Assets.SimpleSignIn.Google.Scripts;   // GoogleAuth\r\nusing Net.Core;                             // BattleServerBridge\r\nusing static AuthAPI;\r\n\r\n[RequireComponent(typeof(UIDocument))]\r\n[RequireComponent(typeof(AuthAPI))]\r\npublic sealed class GoogleLoginRequest : MonoBehaviour\r\n{\r\n    /*\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u4f9d\u8d56 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500*/\r\n    private AuthAPI      api;\r\n    private GoogleAuth   google;\r\n    private List<Button> btns;\r\n\r\n    void Awake()\r\n    {\r\n        api = GetComponent<AuthAPI>() ?? FindObjectOfType<AuthAPI>();\r\n        \r\n        google = new GoogleAuth();\r\n        google.SignOut(true);          // \u4fdd\u8bc1\u6bcf\u6b21\u70b9\u90fd\u8d70\u767b\u5f55\r\n    }\r\n\r\n    void OnEnable()\r\n    {\r\n        var root = GetComponent<UIDocument>().rootVisualElement;\r\n        btns = root.Query<Button>(className: "googlebtn").ToList();\r\n        if (btns.Count == 0 || api == null)\r\n        {\r\n            Debug.LogError("GoogleLoginRequest: \u7f3a\u6309\u94ae\u6216 AuthAPI");\r\n            enabled = false; return;\r\n        }\r\n        btns.ForEach(b => b.clicked += OnClicked);\r\n    }\r\n    \r\n    void OnDestroy() => btns?.ForEach(b => b.clicked -= OnClicked);\r\n\r\n    /*\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u70b9\u51fb \u2192 Google SDK \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500*/\r\n    private void OnClicked()\r\n    {\r\n        Toggle(false);\r\n        LoadingPanelManager.Instance.Show();\r\n        google.GetTokenResponse(OnGoogleToken);\r\n    }\r\n\r\n    private void OnGoogleToken(bool ok, string err, TokenResponse tk)\r\n    {\r\n        if (!ok)\r\n        {\r\n            Fail("Google SDK \u5931\u8d25\uff1a" + err);\r\n            return;\r\n        }\r\n        string idTok = ExtractIdToken(tk);\r\n        if (string.IsNullOrEmpty(idTok))\r\n        {\r\n            Fail("\u672a\u80fd\u89e3\u6790 id_token");\r\n            return;\r\n        }\r\n\r\n        api.GoogleLogin(\r\n            idTok,\r\n            ok : loginJson =>\r\n            {\r\n                SaveSession(loginJson);\r\n\r\n                BattleServerBridge.Connect(\r\n                    loginJson,\r\n                    onOk : _ => SceneManager.LoadScene("LoadingScene", LoadSceneMode.Single),\r\n                    onFail : e  => Fail("\u8fde\u63a5\u6218\u6597\u670d\u5931\u8d25\\n" + e)\r\n                );\r\n            },\r\n            fail : msg => Fail("\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\uff1a" + msg)\r\n        );\r\n    }\r\n\r\n    /*\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5de5\u5177 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500*/\r\n    private void Fail(string msg)\r\n    {\r\n        LoadingPanelManager.Instance.Hide();\r\n        Toggle(true);\r\n        PopupManager.Show("\u767b\u5f55\u5931\u8d25", msg);\r\n        Debug.LogError(msg);\r\n    }\r\n    \r\n    private void Toggle(bool state) => btns.ForEach(b => b.SetEnabled(state));\r\n\r\n    private void SaveSession(string json)\r\n    {\r\n        var d = JsonUtility.FromJson<ServerResp>(json);\r\n        PlayerData.I.SetSession(d.uid, d.user_token, d.cid, d.character_token,\r\n                                d.server_id, d.server_ip_address, d.server_port);\r\n        PlayerData.I.Dump();\r\n    }\r\n\r\n    private static string ExtractIdToken(TokenResponse tk)\r\n    {\r\n        if (tk == null) return null;\r\n        var t = tk.GetType();\r\n        foreach (var n in new[] { "id_token", "idToken", "IdToken" })\r\n        {\r\n            var f = t.GetField(n, BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic);\r\n            if (f?.FieldType == typeof(string)) return f.GetValue(tk) as string;\r\n            var p = t.GetProperty(n, BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic);\r\n            if (p?.PropertyType == typeof(string)) return p.GetValue(tk) as string;\r\n        }\r\n        return null;\r\n    }\r\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"google\u767b\u5f55\u6d41\u7a0b",children:"Google\u767b\u5f55\u6d41\u7a0b"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-mermaid",children:"graph TD\r\n    A[\u70b9\u51fbGoogle\u6309\u94ae] --\x3e B[\u7981\u7528\u6309\u94ae]\r\n    B --\x3e C[\u663e\u793aLoading]\r\n    C --\x3e D[\u8c03\u7528GoogleAuth SDK]\r\n    D --\x3e E{SDK\u8fd4\u56de}\r\n    E --\x3e|\u6210\u529f| F[\u63d0\u53d6ID Token]\r\n    E --\x3e|\u5931\u8d25| G[\u663e\u793a\u9519\u8bef]\r\n    F --\x3e H[\u53d1\u9001\u5230\u670d\u52a1\u5668\u9a8c\u8bc1]\r\n    H --\x3e I{\u670d\u52a1\u5668\u9a8c\u8bc1}\r\n    I --\x3e|\u6210\u529f| J[\u4fdd\u5b58\u4f1a\u8bdd]\r\n    J --\x3e K[\u8fde\u63a5\u6218\u6597\u670d]\r\n    K --\x3e L[\u8fdb\u5165\u6e38\u620f]\r\n    I --\x3e|\u5931\u8d25| M[\u663e\u793a\u9519\u8bef]\n"})}),"\n",(0,l.jsx)(e.h3,{id:"api\u63a5\u53e3",children:"API\u63a5\u53e3"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",metastring:'title="AuthAPI.cs - Google\u767b\u5f55\u63a5\u53e3"',children:'public Coroutine GoogleLogin(string idToken,\r\n                             Action<string> ok,\r\n                             Action<string> fail)\r\n{\r\n    string url = $"{host}/user/GoogleLogin";\r\n    string body = $"{{\\"id_token\\":\\"{idToken}\\"}}";\r\n    return StartCoroutine(PostJson(url, body, ok, fail));\r\n}\r\n\r\n// \u91cd\u8f7d\u7248\u672c\uff0c\u76f4\u63a5\u8fd4\u56deServerResp\r\npublic Coroutine GoogleLogin(string idToken,\r\n                             Action<ServerResp> ok,\r\n                             Action<string>     fail)\r\n{\r\n    return GoogleLogin(idToken,\r\n        json => ok?.Invoke(JsonUtility.FromJson<ServerResp>(json)),\r\n        fail);\r\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"apple\u767b\u5f55",children:"Apple\u767b\u5f55"}),"\n",(0,l.jsx)(e.h3,{id:"\u5b9e\u73b0\u6587\u4ef6-1",children:"\u5b9e\u73b0\u6587\u4ef6"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Assets/Scripts/Network/LoginInScreen/\r\n\u251c\u2500\u2500 AppleLogin.cs    # Apple\u767b\u5f55\u903b\u8f91\r\n\u2514\u2500\u2500 AuthAPI.cs       # API\u63a5\u53e3\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u5b8c\u6574\u5b9e\u73b0\u4ee3\u7801-1",children:"\u5b8c\u6574\u5b9e\u73b0\u4ee3\u7801"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",metastring:'title="AppleLogin.cs"',children:'/******************************************************\r\n * AppleLoginRequest.cs  \u2014  UI Toolkit \u7248 Apple \u767b\u5f55\r\n *****************************************************/\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing UnityEngine;\r\nusing UnityEngine.SceneManagement;\r\nusing UnityEngine.UIElements;\r\nusing AppleAuth;\r\nusing AppleAuth.Enums;\r\nusing AppleAuth.Interfaces;\r\nusing AppleAuth.Native;\r\nusing AppleAuth.Extensions;\r\nusing Net.Core;                    // BattleServerBridge\r\nusing static AuthAPI;\r\n\r\n[RequireComponent(typeof(UIDocument))]\r\n[RequireComponent(typeof(AuthAPI))]\r\npublic sealed class AppleLoginRequest : MonoBehaviour\r\n{\r\n    /*\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u4f9d\u8d56 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500*/\r\n    private IAppleAuthManager   appleAuthManager;\r\n    private AuthAPI             api;\r\n    private List<Button>        btns;\r\n    private List<VisualElement> containers;\r\n    private Label               tokenLabel;\r\n\r\n    /*\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u751f\u547d\u5468\u671f \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500*/\r\n    void Awake()\r\n    {\r\n        api = GetComponent<AuthAPI>() ?? FindObjectOfType<AuthAPI>();\r\n\r\n#if UNITY_IOS || UNITY_STANDALONE_OSX\r\n        if (AppleAuthManager.IsCurrentPlatformSupported)\r\n            appleAuthManager = new AppleAuthManager(new PayloadDeserializer());\r\n#endif\r\n    }\r\n    \r\n    void Update() => appleAuthManager?.Update();\r\n\r\n    void OnEnable()\r\n    {\r\n        var root = GetComponent<UIDocument>().rootVisualElement;\r\n        containers = root.Query<VisualElement>(className: "applecontainer").ToList();\r\n        btns       = root.Query<Button>(className: "applebtn").ToList();\r\n        tokenLabel = root.Q<Label>("token");\r\n\r\n        if (appleAuthManager == null || api == null)\r\n        {\r\n            containers.ForEach(c => c.style.display = DisplayStyle.None);\r\n            enabled = false;  \r\n            return;\r\n        }\r\n        btns.ForEach(b => b.clicked += OnAppleLoginClicked);\r\n    }\r\n    \r\n    void OnDestroy() => btns?.ForEach(b => b.clicked -= OnAppleLoginClicked);\r\n\r\n    /*\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u70b9\u51fb\u4e8b\u4ef6 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500*/\r\n    private void OnAppleLoginClicked()\r\n    {\r\n        ToggleInteract(false);\r\n        LoadingPanelManager.Instance.Show();\r\n        \r\n        // Apple\u767b\u5f55\u4ee3\u7801\uff08\u5b9e\u9645\u5b9e\u73b0\u88ab\u622a\u65ad\u4e86\uff09\r\n        // ...\r\n    }\r\n    \r\n    // ... \u5176\u4ed6\u65b9\u6cd5\r\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"apple\u767b\u5f55\u6d41\u7a0b",children:"Apple\u767b\u5f55\u6d41\u7a0b"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-mermaid",children:"graph TD\r\n    A[\u70b9\u51fbApple\u6309\u94ae] --\x3e B[\u68c0\u67e5\u5e73\u53f0\u652f\u6301]\r\n    B --\x3e|\u652f\u6301| C[\u663e\u793aLoading]\r\n    B --\x3e|\u4e0d\u652f\u6301| D[\u9690\u85cf\u6309\u94ae]\r\n    C --\x3e E[\u8c03\u7528AppleAuth SDK]\r\n    E --\x3e F{SDK\u8fd4\u56de}\r\n    F --\x3e|\u6210\u529f| G[\u83b7\u53d6Identity Token]\r\n    F --\x3e|\u5931\u8d25| H[\u663e\u793a\u9519\u8bef]\r\n    G --\x3e I[\u53d1\u9001\u5230\u670d\u52a1\u5668\u9a8c\u8bc1]\r\n    I --\x3e J{\u670d\u52a1\u5668\u9a8c\u8bc1}\r\n    J --\x3e|\u6210\u529f| K[\u4fdd\u5b58\u4f1a\u8bdd]\r\n    K --\x3e L[\u8fde\u63a5\u6218\u6597\u670d]\r\n    L --\x3e M[\u8fdb\u5165\u6e38\u620f]\r\n    J --\x3e|\u5931\u8d25| N[\u663e\u793a\u9519\u8bef]\n"})}),"\n",(0,l.jsx)(e.h3,{id:"api\u63a5\u53e3-1",children:"API\u63a5\u53e3"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",metastring:'title="AuthAPI.cs - Apple\u767b\u5f55\u63a5\u53e3"',children:'public Coroutine AppleLogin(string idToken,\r\n                            Action<string> ok,\r\n                            Action<string> fail)\r\n{\r\n    string url = $"{host}/user/AppleLogin";\r\n    string body = $"{{\\"id_token\\":\\"{idToken}\\"}}";\r\n    return StartCoroutine(PostJson(url, body, ok, fail));\r\n}\r\n\r\n// \u91cd\u8f7d\u7248\u672c\uff0c\u76f4\u63a5\u8fd4\u56deServerResp\r\npublic Coroutine AppleLogin(string idToken,\r\n                            Action<ServerResp> ok,\r\n                            Action<string>     fail)\r\n{\r\n    return AppleLogin(idToken,\r\n        json => ok?.Invoke(JsonUtility.FromJson<ServerResp>(json)),\r\n        fail);\r\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"ui\u96c6\u6210",children:"UI\u96c6\u6210"}),"\n",(0,l.jsx)(e.h3,{id:"\u6309\u94ae\u6837\u5f0f",children:"\u6309\u94ae\u6837\u5f0f"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-css",metastring:'title="LogInScreenStyle.uss"',children:".googlebtn {\r\n    /* Google\u6309\u94ae\u6837\u5f0f */\r\n}\r\n\r\n.applebtn {\r\n    /* Apple\u6309\u94ae\u6837\u5f0f */\r\n}\r\n\r\n.applecontainer {\r\n    /* Apple\u5bb9\u5668\uff0c\u7528\u4e8e\u63a7\u5236\u663e\u793a/\u9690\u85cf */\r\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"ui\u67e5\u627e\u673a\u5236",children:"UI\u67e5\u627e\u673a\u5236"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",metastring:'title="\u6309\u94ae\u67e5\u627e"',children:'// Google\u6309\u94ae\u67e5\u627e\r\nbtns = root.Query<Button>(className: "googlebtn").ToList();\r\n\r\n// Apple\u6309\u94ae\u67e5\u627e\r\nbtns = root.Query<Button>(className: "applebtn").ToList();\r\ncontainers = root.Query<VisualElement>(className: "applecontainer").ToList();\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u6280\u672f\u7ec6\u8282",children:"\u6280\u672f\u7ec6\u8282"}),"\n",(0,l.jsx)(e.h3,{id:"token\u63d0\u53d6google",children:"Token\u63d0\u53d6\uff08Google\uff09"}),"\n",(0,l.jsx)(e.p,{children:"\u4f7f\u7528\u53cd\u5c04\u63d0\u53d6ID Token\uff0c\u517c\u5bb9\u4e0d\u540c\u7248\u672c\u7684SDK\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",children:'private static string ExtractIdToken(TokenResponse tk)\r\n{\r\n    if (tk == null) return null;\r\n    var t = tk.GetType();\r\n    \r\n    // \u5c1d\u8bd5\u4e0d\u540c\u7684\u5b57\u6bb5\u540d\r\n    foreach (var n in new[] { "id_token", "idToken", "IdToken" })\r\n    {\r\n        // \u67e5\u627e\u5b57\u6bb5\r\n        var f = t.GetField(n, BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic);\r\n        if (f?.FieldType == typeof(string)) \r\n            return f.GetValue(tk) as string;\r\n            \r\n        // \u67e5\u627e\u5c5e\u6027\r\n        var p = t.GetProperty(n, BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic);\r\n        if (p?.PropertyType == typeof(string)) \r\n            return p.GetValue(tk) as string;\r\n    }\r\n    return null;\r\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u5e73\u53f0\u68c0\u67e5apple",children:"\u5e73\u53f0\u68c0\u67e5\uff08Apple\uff09"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",children:"#if UNITY_IOS || UNITY_STANDALONE_OSX\r\n    if (AppleAuthManager.IsCurrentPlatformSupported)\r\n        appleAuthManager = new AppleAuthManager(new PayloadDeserializer());\r\n#endif\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u6309\u94ae\u72b6\u6001\u7ba1\u7406",children:"\u6309\u94ae\u72b6\u6001\u7ba1\u7406"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",children:"// \u7981\u7528/\u542f\u7528\u6309\u94ae\r\nprivate void Toggle(bool state) => btns.ForEach(b => b.SetEnabled(state));\r\n\r\n// Apple\u7279\u6b8a\u5904\u7406\uff1a\u4e0d\u652f\u6301\u65f6\u9690\u85cf\u6574\u4e2a\u5bb9\u5668\r\nif (appleAuthManager == null || api == null)\r\n{\r\n    containers.ForEach(c => c.style.display = DisplayStyle.None);\r\n    enabled = false;\r\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,l.jsx)(e.h3,{id:"google\u9519\u8bef\u5904\u7406",children:"Google\u9519\u8bef\u5904\u7406"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",children:'private void Fail(string msg)\r\n{\r\n    LoadingPanelManager.Instance.Hide();\r\n    Toggle(true);  // \u6062\u590d\u6309\u94ae\r\n    PopupManager.Show("\u767b\u5f55\u5931\u8d25", msg);\r\n    Debug.LogError(msg);\r\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u9519\u8bef\u7c7b\u578b",children:"\u9519\u8bef\u7c7b\u578b"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u9519\u8bef\u573a\u666f"}),(0,l.jsx)(e.th,{children:"\u9519\u8bef\u4fe1\u606f"}),(0,l.jsx)(e.th,{children:"\u5904\u7406\u65b9\u5f0f"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SDK\u5931\u8d25"}),(0,l.jsx)(e.td,{children:'"Google SDK \u5931\u8d25\uff1a" + \u9519\u8bef\u8be6\u60c5'}),(0,l.jsx)(e.td,{children:"\u663e\u793a\u5f39\u7a97"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Token\u89e3\u6790\u5931\u8d25"}),(0,l.jsx)(e.td,{children:'"\u672a\u80fd\u89e3\u6790 id_token"'}),(0,l.jsx)(e.td,{children:"\u663e\u793a\u5f39\u7a97"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u670d\u52a1\u5668\u9a8c\u8bc1\u5931\u8d25"}),(0,l.jsx)(e.td,{children:'"\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\uff1a" + \u9519\u8bef\u4fe1\u606f'}),(0,l.jsx)(e.td,{children:"\u663e\u793a\u5f39\u7a97"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8fde\u63a5\u6218\u6597\u670d\u5931\u8d25"}),(0,l.jsx)(e.td,{children:'"\u8fde\u63a5\u6218\u6597\u670d\u5931\u8d25\\n" + \u9519\u8bef\u4fe1\u606f'}),(0,l.jsx)(e.td,{children:"\u663e\u793a\u5f39\u7a97"})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"\u4f1a\u8bdd\u7ba1\u7406",children:"\u4f1a\u8bdd\u7ba1\u7406"}),"\n",(0,l.jsx)(e.p,{children:"\u4e24\u79cd\u767b\u5f55\u65b9\u5f0f\u90fd\u4f7f\u7528\u76f8\u540c\u7684\u4f1a\u8bdd\u4fdd\u5b58\u903b\u8f91\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",children:"private void SaveSession(string json)\r\n{\r\n    var d = JsonUtility.FromJson<ServerResp>(json);\r\n    PlayerData.I.SetSession(\r\n        d.uid, \r\n        d.user_token, \r\n        d.cid, \r\n        d.character_token,\r\n        d.server_id, \r\n        d.server_ip_address, \r\n        d.server_port\r\n    );\r\n    PlayerData.I.Dump();  // \u8c03\u8bd5\u8f93\u51fa\r\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u670d\u52a1\u5668\u4ea4\u4e92",children:"\u670d\u52a1\u5668\u4ea4\u4e92"}),"\n",(0,l.jsx)(e.h3,{id:"\u8bf7\u6c42\u683c\u5f0f",children:"\u8bf7\u6c42\u683c\u5f0f"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-http",children:'POST /user/GoogleLogin\r\nContent-Type: application/json\r\n{\r\n    "id_token": "Google ID Token"\r\n}\r\n\r\nPOST /user/AppleLogin\r\nContent-Type: application/json\r\n{\r\n    "id_token": "Apple Identity Token"\r\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u54cd\u5e94\u683c\u5f0f",children:"\u54cd\u5e94\u683c\u5f0f"}),"\n",(0,l.jsx)(e.p,{children:"\u4e0e\u5176\u4ed6\u767b\u5f55\u65b9\u5f0f\u76f8\u540c\u7684ServerResp\u683c\u5f0f\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\r\n    "code": 0,\r\n    "message": "success",\r\n    "uid": "user_123",\r\n    "user_token": "token_xxx",\r\n    "cid": "character_456",\r\n    "character_token": "char_token_xxx",\r\n    "server_id": 1,\r\n    "server_ip_address": "192.168.1.100",\r\n    "server_port": 8000\r\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsx)(e.h3,{id:"google\u767b\u5f55-1",children:"Google\u767b\u5f55"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6bcf\u6b21\u5f3a\u5236\u767b\u5f55"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-csharp",children:"google.SignOut(true);  // \u4fdd\u8bc1\u6bcf\u6b21\u70b9\u90fd\u8d70\u767b\u5f55\n"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"SDK\u4f9d\u8d56"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u9700\u8981\u5bfc\u5165",(0,l.jsx)(e.code,{children:"Assets.SimpleSignIn.Google.Scripts"}),"\u5305"]}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u914d\u7f6eGoogle OAuth\u5ba2\u6237\u7aefID"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"apple\u767b\u5f55-1",children:"Apple\u767b\u5f55"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5e73\u53f0\u9650\u5236"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4ec5\u652f\u6301iOS\u548cmacOS\u5e73\u53f0"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u6761\u4ef6\u7f16\u8bd1\u6307\u4ee4"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"SDK\u66f4\u65b0"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u9700\u8981\u5728Update\u4e2d\u8c03\u7528",(0,l.jsx)(e.code,{children:"appleAuthManager?.Update()"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"UI\u81ea\u52a8\u9690\u85cf"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e0d\u652f\u6301\u7684\u5e73\u53f0\u81ea\u52a8\u9690\u85cfApple\u767b\u5f55\u5bb9\u5668"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u6d4b\u8bd5\u8981\u70b9",children:"\u6d4b\u8bd5\u8981\u70b9"}),"\n",(0,l.jsx)(e.h3,{id:"\u529f\u80fd\u6d4b\u8bd5",children:"\u529f\u80fd\u6d4b\u8bd5"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Google\u767b\u5f55\u6210\u529f\u6d41\u7a0b"}),"\n",(0,l.jsx)(e.li,{children:"Apple\u767b\u5f55\u6210\u529f\u6d41\u7a0b"}),"\n",(0,l.jsx)(e.li,{children:"SDK\u8c03\u7528\u5931\u8d25\u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"Token\u89e3\u6790\u5931\u8d25\u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u670d\u52a1\u5668\u9a8c\u8bc1\u5931\u8d25\u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u7f51\u7edc\u5f02\u5e38\u5904\u7406"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u517c\u5bb9\u6027\u6d4b\u8bd5",children:"\u517c\u5bb9\u6027\u6d4b\u8bd5"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e0d\u540c\u7248\u672cGoogle SDK\u517c\u5bb9\u6027"}),"\n",(0,l.jsx)(e.li,{children:"iOS\u4e0d\u540c\u7248\u672cApple\u767b\u5f55"}),"\n",(0,l.jsx)(e.li,{children:"\u6309\u94ae\u67e5\u627e\u5bb9\u9519"}),"\n",(0,l.jsx)(e.li,{children:"\u53cd\u5c04\u63d0\u53d6Token\u517c\u5bb9\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u6027\u80fd\u6d4b\u8bd5",children:"\u6027\u80fd\u6d4b\u8bd5"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"SDK\u521d\u59cb\u5316\u65f6\u95f4"}),"\n",(0,l.jsx)(e.li,{children:"Token\u83b7\u53d6\u54cd\u5e94\u65f6\u95f4"}),"\n",(0,l.jsx)(e.li,{children:"\u6574\u4f53\u767b\u5f55\u8017\u65f6"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,l.jsx)(e.h3,{id:"q-\u4e3a\u4ec0\u4e48\u4f7f\u7528\u53cd\u5c04\u63d0\u53d6token",children:"Q: \u4e3a\u4ec0\u4e48\u4f7f\u7528\u53cd\u5c04\u63d0\u53d6Token\uff1f"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"A:"})," \u4e0d\u540c\u7248\u672c\u7684SDK\u53ef\u80fd\u4f7f\u7528\u4e0d\u540c\u7684\u5b57\u6bb5\u540d\uff0c\u53cd\u5c04\u53ef\u4ee5\u63d0\u9ad8\u517c\u5bb9\u6027\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"q-apple\u767b\u5f55\u4e3a\u4ec0\u4e48\u8981\u9690\u85cf\u5bb9\u5668",children:"Q: Apple\u767b\u5f55\u4e3a\u4ec0\u4e48\u8981\u9690\u85cf\u5bb9\u5668\uff1f"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"A:"})," \u5728\u4e0d\u652f\u6301\u7684\u5e73\u53f0\u4e0a\u5b8c\u5168\u9690\u85cf\uff0c\u907f\u514d\u7528\u6237\u56f0\u60d1\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"q-\u4e3a\u4ec0\u4e48google\u6bcf\u6b21\u90fd\u8981signout",children:"Q: \u4e3a\u4ec0\u4e48Google\u6bcf\u6b21\u90fd\u8981SignOut\uff1f"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"A:"})," \u786e\u4fdd\u6bcf\u6b21\u90fd\u5f39\u51fa\u8d26\u53f7\u9009\u62e9\u754c\u9762\uff0c\u8ba9\u7528\u6237\u53ef\u4ee5\u5207\u6362\u8d26\u53f7\u3002"]})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(c,{...n})}):c(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>t});var i=r(6540);const l={},s=i.createContext(l);function o(n){const e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:o(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);