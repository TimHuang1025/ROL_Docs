<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-卡牌/card-equipment-system" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">装备系统 | 游戏项目文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://timhuang1025.github.io/ROL_Docs/docs/卡牌/card-equipment-system"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="装备系统 | 游戏项目文档"><meta data-rh="true" name="description" content="系统概述"><meta data-rh="true" property="og:description" content="系统概述"><link data-rh="true" rel="icon" href="/ROL_Docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://timhuang1025.github.io/ROL_Docs/docs/卡牌/card-equipment-system"><link data-rh="true" rel="alternate" href="https://timhuang1025.github.io/ROL_Docs/docs/卡牌/card-equipment-system" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://timhuang1025.github.io/ROL_Docs/docs/卡牌/card-equipment-system" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"装备系统","item":"https://timhuang1025.github.io/ROL_Docs/docs/卡牌/card-equipment-system"}]}</script><link rel="stylesheet" href="/ROL_Docs/assets/css/styles.014bc8ab.css">
<script src="/ROL_Docs/assets/js/runtime~main.43072571.js" defer="defer"></script>
<script src="/ROL_Docs/assets/js/main.5f1e566d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ROL_Docs/"><b class="navbar__title text--truncate">游戏文档</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ROL_Docs/docs/intro">API文档</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">系统文档</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/ROL_Docs/docs/卡牌">卡片系统</a></li><li><a class="dropdown__link" href="/ROL_Docs/docs/工会">工会系统</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/TimHuang1025/ROL_Docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ROL_Docs/docs/intro">游戏概述</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/ROL_Docs/docs/卡牌/card-overview">卡牌</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/card-overview">系统概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/card-data-model">数据模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/card-upgrade-system">升级系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/card-gift-system">封赏系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/card-star-system">升星系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/phantom-card-system">幻影卡系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ROL_Docs/docs/卡牌/card-equipment-system">装备系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/card-skill-system">技能系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/gacha-system">抽卡系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/card-inventory">卡牌库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/lord-card-system">主公卡系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ROL_Docs/docs/卡牌/card-service">CardService</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ROL_Docs/docs/工会/union-create">工会</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ROL_Docs/docs/登录/login-overview">登录</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/ROL_Docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">卡牌</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">装备系统</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>装备系统</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="系统概述">系统概述<a href="#系统概述" class="hash-link" aria-label="系统概述的直接链接" title="系统概述的直接链接">​</a></h2>
<p>装备系统允许卡牌穿戴武器、护甲和坐骑三种装备，提升战斗属性。装备槽位通过封赏等级解锁，每个装备都可以独立升级强化。系统使用UUID管理装备实例，支持装备在不同卡牌间切换。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="装备槽位">装备槽位<a href="#装备槽位" class="hash-link" aria-label="装备槽位的直接链接" title="装备槽位的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="槽位类型">槽位类型<a href="#槽位类型" class="hash-link" aria-label="槽位类型的直接链接" title="槽位类型的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public enum EquipSlotType </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Weapon,   // 武器槽（封赏1级解锁）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Armor,    // 护甲槽（封赏2级解锁）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mount     // 坐骑槽（封赏3级解锁）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="解锁机制">解锁机制<a href="#解锁机制" class="hash-link" aria-label="解锁机制的直接链接" title="解锁机制的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// EquipStatus.cs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class EquipStatus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 装备UUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string weaponUuid = &quot;&quot;;      // 武器的UUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string armorUuid = &quot;&quot;;       // 护甲的UUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string accessoryUuid = &quot;&quot;;   // 坐骑的UUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 槽位解锁状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool weaponUnlocked = false;   // 武器槽是否解锁（封赏1级）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool armorUnlocked = false;    // 护甲槽是否解锁（封赏2级）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool mountUnlocked = false;    // 坐骑槽是否解锁（封赏3级）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 根据封赏等级更新槽位解锁状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void UpdateUnlockStatus(int giftLevel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weaponUnlocked = giftLevel &gt;= 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        armorUnlocked = giftLevel &gt;= 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mountUnlocked = giftLevel &gt;= 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="装备数据模型">装备数据模型<a href="#装备数据模型" class="hash-link" aria-label="装备数据模型的直接链接" title="装备数据模型的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="武器护甲---playergear">武器/护甲 - PlayerGear<a href="#武器护甲---playergear" class="hash-link" aria-label="武器/护甲 - PlayerGear的直接链接" title="武器/护甲 - PlayerGear的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// GearDefinitions.cs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PlayerGear</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string uuid = &quot;&quot;;         // 唯一标识符（UUID格式）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string staticId;          // 静态配置ID（如&quot;weapon1&quot;）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int level = 1;            // 强化等级</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool unlocked = true;     // 是否已解锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string equippedById = &quot;&quot;; // 装备在哪个卡牌上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 生成UUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void EnsureUuid()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (string.IsNullOrEmpty(uuid))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            uuid = Guid.NewGuid().ToString(&quot;N&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取静态配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GearStatic Static =&gt; GearDatabaseStatic.Instance.Get(staticId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="坐骑---playerhorse">坐骑 - PlayerHorse<a href="#坐骑---playerhorse" class="hash-link" aria-label="坐骑 - PlayerHorse的直接链接" title="坐骑 - PlayerHorse的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PlayerHorse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string uuid = &quot;&quot;;         // 唯一标识符</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string staticId;          // 静态配置ID（如&quot;horse1&quot;）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int level = 1;            // 强化等级</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool unlocked = true;     // 是否已解锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string equippedById = &quot;&quot;; // 装备在哪个卡牌上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取静态配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public HorseStatic Static =&gt; HorseDatabaseStatic.Instance.Get(staticId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="静态配置---gearstatic">静态配置 - GearStatic<a href="#静态配置---gearstatic" class="hash-link" aria-label="静态配置 - GearStatic的直接链接" title="静态配置 - GearStatic的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class GearStatic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;标识&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string id;               // 装备ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string name;             // 装备名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GearKind kind;           // 类型（武器/护甲）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Tier tier;               // 品质等级（S/A/B）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;数值倍率 (Atk / Def)&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float[] valueMultiplier = new float[2];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;图标&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Sprite iconSprite;       // 装备图标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算当前等级的属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public (float atk, float def) CalcStats(int level)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float coe = DB.GetValueCoe(tier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float pow = DB.GetValuePow(tier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float statBase = coe * Mathf.Pow(level, pow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (statBase * valueMultiplier[0],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                statBase * valueMultiplier[1]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算升级材料需求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public (int iron, int fineWood, int steel) CalcUpgradeCost(int level)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float iron = DB.GetIronCostCoe(tier) * Mathf.Pow(level, DB.GetIronCostPow(tier));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float wood = level &gt;= 10 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ? DB.GetFineWoodCoe(tier) * Mathf.Pow(level, DB.GetFineWoodPow(tier))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            : 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float steel = level &gt;= 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ? DB.GetSteelCoe(tier) * Mathf.Pow(level, DB.GetSteelPow(tier))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            : 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (Mathf.CeilToInt(iron),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Mathf.CeilToInt(wood),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Mathf.CeilToInt(steel));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="静态配置---horsestatic">静态配置 - HorseStatic<a href="#静态配置---horsestatic" class="hash-link" aria-label="静态配置 - HorseStatic的直接链接" title="静态配置 - HorseStatic的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class HorseStatic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string id;               // 战马ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string name;             // 战马名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Tier tier;               // 品质等级</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Sprite iconSprite;       // 战马图标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Header(&quot;属性加成百分比&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float[] valueMultiplier = new float[4]; // [攻击%, 防御%, 智力%, 统率%]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 计算当前等级的属性加成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public (float atk, float def, float intel, float cmd) CalcStats(int level)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float coe = DB.GetValueCoe(tier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float pow = DB.GetValuePow(tier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float statBase = coe * Mathf.Pow(level, pow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (statBase * valueMultiplier[0],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                statBase * valueMultiplier[1],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                statBase * valueMultiplier[2],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                statBase * valueMultiplier[3]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="装备管理器">装备管理器<a href="#装备管理器" class="hash-link" aria-label="装备管理器的直接链接" title="装备管理器的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="playergearbank---装备仓库">PlayerGearBank - 装备仓库<a href="#playergearbank---装备仓库" class="hash-link" aria-label="PlayerGearBank - 装备仓库的直接链接" title="PlayerGearBank - 装备仓库的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class PlayerGearBank : SingletonMono&lt;PlayerGearBank&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 装备列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly List&lt;PlayerGear&gt; gears = new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Dictionary&lt;string, PlayerGear&gt; uuid2Gear;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 事件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Action&lt;string&gt; onGearChanged;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Action&lt;string&gt; onGearUpdated;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 核心方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PlayerGear Get(string uuid);              // 通过UUID获取</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PlayerGear GetByStatic(string staticId);  // 通过静态ID获取</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PlayerGear Add(string staticId, int level = 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PlayerGear AddWithUuid(string uuid, string staticId, int level = 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Remove(string uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void UpdateLevel(string uuid, int newLevel);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void MarkDirty(string uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public IEnumerable&lt;PlayerGear&gt; All =&gt; uuid2Gear?.Values ?? gears;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int Count =&gt; uuid2Gear?.Count ?? gears.Count;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="playerhorsebank---战马仓库">PlayerHorseBank - 战马仓库<a href="#playerhorsebank---战马仓库" class="hash-link" aria-label="PlayerHorseBank - 战马仓库的直接链接" title="PlayerHorseBank - 战马仓库的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class PlayerHorseBank : SingletonMono&lt;PlayerHorseBank&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly List&lt;PlayerHorse&gt; horses = new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Dictionary&lt;string, PlayerHorse&gt; uuid2Horse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 类似PlayerGearBank的接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PlayerHorse Get(string uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Add(PlayerHorse horse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Remove(string uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void MarkDirty(string uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public IEnumerable&lt;PlayerHorse&gt; All =&gt; horses;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="装备操作">装备操作<a href="#装备操作" class="hash-link" aria-label="装备操作的直接链接" title="装备操作的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="equipmentmanager---统一管理器">EquipmentManager - 统一管理器<a href="#equipmentmanager---统一管理器" class="hash-link" aria-label="EquipmentManager - 统一管理器的直接链接" title="EquipmentManager - 统一管理器的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public static class EquipmentManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 装备武器/护甲</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void Equip(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerCard hero,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerGear gear,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EquipSlotType slot,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerCardBank cardBank,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerGearBank gearBank)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (hero == null || gear == null) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 1. 如果装备在别人身上，先卸下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!string.IsNullOrEmpty(gear.equippedById) &amp;&amp; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gear.equippedById != hero.id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var oldHero = cardBank.Get(gear.equippedById);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (oldHero != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ClearSlot(oldHero, slot, gearBank);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 2. 卸下英雄当前装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClearSlot(hero, slot, gearBank);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 3. 穿上新装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        switch (slot)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case EquipSlotType.Weapon:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hero.equip.weaponUuid = gear.uuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case EquipSlotType.Armor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hero.equip.armorUuid = gear.uuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case EquipSlotType.Mount:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hero.equip.accessoryUuid = gear.uuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gear.equippedById = hero.id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 4. 触发更新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gearBank.MarkDirty(gear.uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerCardBankMgr.I?.RaiseCardUpdated(hero.id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 装备战马</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void Equip(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerCard hero,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerHorse horse,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EquipSlotType slot,  // 必须是Mount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerCardBank cardBank,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerHorseBank horseBank)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (hero == null || horse == null || slot != EquipSlotType.Mount) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 类似流程...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hero.equip.accessoryUuid = horse.uuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        horse.equippedById = hero.id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        horseBank.MarkDirty(horse.uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerCardBankMgr.I?.RaiseCardUpdated(hero.id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 卸下装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void ClearSlot(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerCard hero,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EquipSlotType slot,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerGearBank gearBank = null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (hero == null) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string oldUuid = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        switch (slot)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case EquipSlotType.Weapon:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                oldUuid = hero.equip.weaponUuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hero.equip.weaponUuid = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case EquipSlotType.Armor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                oldUuid = hero.equip.armorUuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hero.equip.armorUuid = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case EquipSlotType.Mount:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                oldUuid = hero.equip.accessoryUuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hero.equip.accessoryUuid = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (gearBank != null &amp;&amp; !string.IsNullOrEmpty(oldUuid))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var g = gearBank.Get(oldUuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (g != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                g.equippedById = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                gearBank.MarkDirty(oldUuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ui实现">UI实现<a href="#ui实现" class="hash-link" aria-label="UI实现的直接链接" title="UI实现的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cardequipmentmanager---卡牌装备管理ui">CardEquipmentManager - 卡牌装备管理UI<a href="#cardequipmentmanager---卡牌装备管理ui" class="hash-link" aria-label="CardEquipmentManager - 卡牌装备管理UI的直接链接" title="CardEquipmentManager - 卡牌装备管理UI的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CardEquipmentManager : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // UI元素</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Button weaponSlot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Button armorSlot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Button mountSlot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private CardInfoStatic currentStatic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private PlayerCard currentDynamic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 刷新装备显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void RefreshEquipment()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (currentDynamic == null) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取装备数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var weaponData = GetEquipmentData(currentDynamic.equip.weaponUuid, EquipSlotType.Weapon);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var armorData = GetEquipmentData(currentDynamic.equip.armorUuid, EquipSlotType.Armor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var mountData = GetEquipmentData(currentDynamic.equip.accessoryUuid, EquipSlotType.Mount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 更新槽位显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UpdateEquipSlotVisual(0, weaponData, currentDynamic.equip.weaponUnlocked);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UpdateEquipSlotVisual(1, armorData, currentDynamic.equip.armorUnlocked);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UpdateEquipSlotVisual(2, mountData, currentDynamic.equip.mountUnlocked);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 处理槽位点击</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void HandleSlotClick(EquipSlotType slot)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (currentDynamic == null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PopupManager.Show(&quot;提示&quot;, &quot;尚未拥有该武将&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 检查槽位是否解锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bool unlocked = IsSlotUnlocked(slot);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!unlocked)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PopupManager.Show(&quot;提示&quot;, &quot;该装备槽未解锁&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 打开装备选择面板</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (slot == EquipSlotType.Mount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            horsePanel?.Open(currentDynamic);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gearPanel?.Open(currentDynamic, slot);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="装备选择面板">装备选择面板<a href="#装备选择面板" class="hash-link" aria-label="装备选择面板的直接链接" title="装备选择面板的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class GearSelectionPanel : MonoBehaviour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 筛选可装备的装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;PlayerGear&gt; GetAvailableGears(EquipSlotType slot)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var allGears = PlayerGearBank.I.All;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var filtered = new List&lt;PlayerGear&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        foreach (var gear in allGears)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var gearStatic = gear.Static;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (gearStatic == null) continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 根据槽位筛选类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bool matchesSlot = slot switch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EquipSlotType.Weapon =&gt; gearStatic.kind == GearKind.Weapon,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EquipSlotType.Armor =&gt; gearStatic.kind == GearKind.Armor,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _ =&gt; false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (matchesSlot)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                filtered.Add(gear);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 排序：未装备的优先，品质高的优先</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filtered.Sort((a, b) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 未装备的排前面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bool aEquipped = !string.IsNullOrEmpty(a.equippedById);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bool bEquipped = !string.IsNullOrEmpty(b.equippedById);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (aEquipped != bEquipped)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return aEquipped ? 1 : -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 品质高的排前面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return b.Static.tier.CompareTo(a.Static.tier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return filtered;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="装备升级">装备升级<a href="#装备升级" class="hash-link" aria-label="装备升级的直接链接" title="装备升级的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级材料需求">升级材料需求<a href="#升级材料需求" class="hash-link" aria-label="升级材料需求的直接链接" title="升级材料需求的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 计算升级材料</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public (int iron, int fineWood, int steel) CalcUpgradeCost(int level)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 基础材料：铁（任何等级都需要）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float iron = DB.GetIronCostCoe(tier) * Mathf.Pow(level, DB.GetIronCostPow(tier));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 10级以上需要精木</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float wood = level &gt;= 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ? DB.GetFineWoodCoe(tier) * Mathf.Pow(level, DB.GetFineWoodPow(tier))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 20级以上需要精钢</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float steel = level &gt;= 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ? DB.GetSteelCoe(tier) * Mathf.Pow(level, DB.GetSteelPow(tier))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (Mathf.CeilToInt(iron),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Mathf.CeilToInt(wood),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Mathf.CeilToInt(steel));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级流程">升级流程<a href="#升级流程" class="hash-link" aria-label="升级流程的直接链接" title="升级流程的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void OnUpgradeClicked()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (selectedGear == null) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. 计算材料需求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var (iron, wood, steel) = selectedGear.Static.CalcUpgradeCost(selectedGear.level + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. 检查材料</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long currentIron = InventoryService.I.GetItemCount(&quot;RawIron&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long currentWood = InventoryService.I.GetItemCount(&quot;Firmwood&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long currentSteel = InventoryService.I.GetItemCount(&quot;IronIngot&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (currentIron &lt; iron || currentWood &lt; wood || currentSteel &lt; steel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PopupManager.Show(&quot;材料不足&quot;, &quot;升级所需材料不足&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. 发送升级请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var request = new UpgradeGearRequest(selectedGear.uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MessageHub.I.Request(&quot;gear/upgrade&quot;, request, OnUpgradeResponse, 10f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="网络同步">网络同步<a href="#网络同步" class="hash-link" aria-label="网络同步的直接链接" title="网络同步的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="装备卸载请求">装备/卸载请求<a href="#装备卸载请求" class="hash-link" aria-label="装备/卸载请求的直接链接" title="装备/卸载请求的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ChangeGearRequest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string gear_uuid;      // 装备UUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string equip_on_card;  // 目标卡牌ID（空字符串表示卸载）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int unload;           // 1=卸载，0=装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="装备卸载响应">装备/卸载响应<a href="#装备卸载响应" class="hash-link" aria-label="装备/卸载响应的直接链接" title="装备/卸载响应的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ChangeGearResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string target_gear_unequip_from;    // 装备从哪个卡牌卸下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string target_gear_equip_on;        // 装备到哪个卡牌</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string new_card_old_gear_removed;   // 新卡牌的旧装备UUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级请求">升级请求<a href="#升级请求" class="hash-link" aria-label="升级请求的直接链接" title="升级请求的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UpgradeGearRequest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string gear_uuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级响应">升级响应<a href="#升级响应" class="hash-link" aria-label="升级响应的直接链接" title="升级响应的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UpgradeResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GearInfo gear_info;                    // 装备新信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Dictionary&lt;string, long&gt; current_balance; // 材料余额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Serializable]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class GearInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string gear_uuid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int gear_level;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string on_card;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据同步服务">数据同步服务<a href="#数据同步服务" class="hash-link" aria-label="数据同步服务的直接链接" title="数据同步服务的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gearservice---装备数据服务">GearService - 装备数据服务<a href="#gearservice---装备数据服务" class="hash-link" aria-label="GearService - 装备数据服务的直接链接" title="GearService - 装备数据服务的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class GearService : SingletonMono&lt;GearService&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool IsInited { get; private set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Action OnGearDataReady;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 初始化获取所有装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Init()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MessageHub.I.Request(&quot;gear/get_gear&quot;, null, OnGetGearResp, 10f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 处理服务器数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void ProcessGearData(List&lt;GearItem&gt; gearList)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 清空现有数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerGearBank.I?.Clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PlayerHorseBank.I?.Clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 分类处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        foreach (var item in gearList)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (item.gear_id.StartsWith(&quot;horse&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 添加到战马库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var horse = new PlayerHorse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    uuid = item.gear_uuid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    staticId = item.gear_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    level = item.gear_level,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    equippedById = item.on_card</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PlayerHorseBank.I.Add(horse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else if (item.gear_id.StartsWith(&quot;weapon&quot;) || </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     item.gear_id.StartsWith(&quot;armor&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 添加到装备库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var gear = PlayerGearBank.I.AddWithUuid(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    item.gear_uuid, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    item.gear_id, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    item.gear_level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                gear.equippedById = item.on_card;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cardservice中的装备处理">CardService中的装备处理<a href="#cardservice中的装备处理" class="hash-link" aria-label="CardService中的装备处理的直接链接" title="CardService中的装备处理的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 从服务器卡牌数据转换装备UUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private string FindGearUuid(string gearId, string cardId, string gearType)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (string.IsNullOrEmpty(gearId)) return &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果已经是UUID格式，直接返回</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (gearId.Contains(&quot;-&quot;)) return gearId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 根据类型查找对应的装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (gearType == &quot;weapon&quot; || gearType == &quot;armor&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 查找装备在该卡牌上的装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var gear = PlayerGearBank.I?.All.FirstOrDefault(g =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            g.staticId == gearId &amp;&amp; g.equippedById == cardId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果找不到，尝试找未装备的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (gear == null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gear = PlayerGearBank.I?.All.FirstOrDefault(g =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                g.staticId == gearId &amp;&amp; string.IsNullOrEmpty(g.equippedById));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (gear != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 标记为已装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                gear.equippedById = cardId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PlayerGearBank.I?.MarkDirty(gear.uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return gear?.uuid ?? &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if (gearType == &quot;horse&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 类似处理战马</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var horse = PlayerHorseBank.I?.All.FirstOrDefault(h =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            h.staticId == gearId &amp;&amp; h.equippedById == cardId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return horse?.uuid ?? &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="特殊规则">特殊规则<a href="#特殊规则" class="hash-link" aria-label="特殊规则的直接链接" title="特殊规则的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-主公卡装备">1. 主公卡装备<a href="#1-主公卡装备" class="hash-link" aria-label="1. 主公卡装备的直接链接" title="1. 主公卡装备的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 主公卡的装备槽默认全部解锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (cardId == &quot;LORD&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lordCard.equip.weaponUnlocked = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lordCard.equip.armorUnlocked = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lordCard.equip.mountUnlocked = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-幻影卡限制">2. 幻影卡限制<a href="#2-幻影卡限制" class="hash-link" aria-label="2. 幻影卡限制的直接链接" title="2. 幻影卡限制的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 幻影卡不能装备道具</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (pc.isPhantom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.LogWarning($&quot;Cannot equip on phantom card {id}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-装备唯一性">3. 装备唯一性<a href="#3-装备唯一性" class="hash-link" aria-label="3. 装备唯一性的直接链接" title="3. 装备唯一性的直接链接">​</a></h3>
<ul>
<li>一件装备同时只能装备在一个卡牌上</li>
<li>切换装备时自动从原卡牌卸下</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-uuid管理">4. UUID管理<a href="#4-uuid管理" class="hash-link" aria-label="4. UUID管理的直接链接" title="4. UUID管理的直接链接">​</a></h3>
<ul>
<li>每件装备有唯一的UUID标识</li>
<li>服务器返回的装备使用UUID而非静态ID</li>
<li>本地缓存UUID与装备实例的映射关系</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="注意事项">注意事项<a href="#注意事项" class="hash-link" aria-label="注意事项的直接链接" title="注意事项的直接链接">​</a></h2>
<ol>
<li>
<p><strong>UUID转换</strong></p>
<ul>
<li>服务器可能返回静态ID或UUID</li>
<li>需要正确转换和查找对应装备实例</li>
</ul>
</li>
<li>
<p><strong>装备状态同步</strong></p>
<ul>
<li>装备/卸载操作需要同步到服务器</li>
<li>本地立即更新，服务器确认后最终生效</li>
</ul>
</li>
<li>
<p><strong>UI刷新</strong></p>
<ul>
<li>装备变化后触发onGearUpdated事件</li>
<li>卡牌装备变化触发onCardUpdated事件</li>
</ul>
</li>
<li>
<p><strong>材料消耗</strong></p>
<ul>
<li>升级材料从InventoryService获取</li>
<li>根据等级阶段需要不同材料</li>
</ul>
</li>
<li>
<p><strong>性能优化</strong></p>
<ul>
<li>使用Dictionary缓存UUID映射</li>
<li>批量更新减少UI刷新次数</li>
</ul>
</li>
</ol></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/ROL_Docs/docs/卡牌/phantom-card-system"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">幻影卡系统</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ROL_Docs/docs/卡牌/card-skill-system"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">技能系统</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#系统概述" class="table-of-contents__link toc-highlight">系统概述</a></li><li><a href="#装备槽位" class="table-of-contents__link toc-highlight">装备槽位</a><ul><li><a href="#槽位类型" class="table-of-contents__link toc-highlight">槽位类型</a></li><li><a href="#解锁机制" class="table-of-contents__link toc-highlight">解锁机制</a></li></ul></li><li><a href="#装备数据模型" class="table-of-contents__link toc-highlight">装备数据模型</a><ul><li><a href="#武器护甲---playergear" class="table-of-contents__link toc-highlight">武器/护甲 - PlayerGear</a></li><li><a href="#坐骑---playerhorse" class="table-of-contents__link toc-highlight">坐骑 - PlayerHorse</a></li><li><a href="#静态配置---gearstatic" class="table-of-contents__link toc-highlight">静态配置 - GearStatic</a></li><li><a href="#静态配置---horsestatic" class="table-of-contents__link toc-highlight">静态配置 - HorseStatic</a></li></ul></li><li><a href="#装备管理器" class="table-of-contents__link toc-highlight">装备管理器</a><ul><li><a href="#playergearbank---装备仓库" class="table-of-contents__link toc-highlight">PlayerGearBank - 装备仓库</a></li><li><a href="#playerhorsebank---战马仓库" class="table-of-contents__link toc-highlight">PlayerHorseBank - 战马仓库</a></li></ul></li><li><a href="#装备操作" class="table-of-contents__link toc-highlight">装备操作</a><ul><li><a href="#equipmentmanager---统一管理器" class="table-of-contents__link toc-highlight">EquipmentManager - 统一管理器</a></li></ul></li><li><a href="#ui实现" class="table-of-contents__link toc-highlight">UI实现</a><ul><li><a href="#cardequipmentmanager---卡牌装备管理ui" class="table-of-contents__link toc-highlight">CardEquipmentManager - 卡牌装备管理UI</a></li><li><a href="#装备选择面板" class="table-of-contents__link toc-highlight">装备选择面板</a></li></ul></li><li><a href="#装备升级" class="table-of-contents__link toc-highlight">装备升级</a><ul><li><a href="#升级材料需求" class="table-of-contents__link toc-highlight">升级材料需求</a></li><li><a href="#升级流程" class="table-of-contents__link toc-highlight">升级流程</a></li></ul></li><li><a href="#网络同步" class="table-of-contents__link toc-highlight">网络同步</a><ul><li><a href="#装备卸载请求" class="table-of-contents__link toc-highlight">装备/卸载请求</a></li><li><a href="#装备卸载响应" class="table-of-contents__link toc-highlight">装备/卸载响应</a></li><li><a href="#升级请求" class="table-of-contents__link toc-highlight">升级请求</a></li><li><a href="#升级响应" class="table-of-contents__link toc-highlight">升级响应</a></li></ul></li><li><a href="#数据同步服务" class="table-of-contents__link toc-highlight">数据同步服务</a><ul><li><a href="#gearservice---装备数据服务" class="table-of-contents__link toc-highlight">GearService - 装备数据服务</a></li><li><a href="#cardservice中的装备处理" class="table-of-contents__link toc-highlight">CardService中的装备处理</a></li></ul></li><li><a href="#特殊规则" class="table-of-contents__link toc-highlight">特殊规则</a><ul><li><a href="#1-主公卡装备" class="table-of-contents__link toc-highlight">1. 主公卡装备</a></li><li><a href="#2-幻影卡限制" class="table-of-contents__link toc-highlight">2. 幻影卡限制</a></li><li><a href="#3-装备唯一性" class="table-of-contents__link toc-highlight">3. 装备唯一性</a></li><li><a href="#4-uuid管理" class="table-of-contents__link toc-highlight">4. UUID管理</a></li></ul></li><li><a href="#注意事项" class="table-of-contents__link toc-highlight">注意事项</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 游戏项目文档</div></div></div></footer></div>
</body>
</html>